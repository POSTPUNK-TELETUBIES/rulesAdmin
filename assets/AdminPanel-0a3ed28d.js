import{j as e,ac as xe,ad as me,a4 as ge,aa as je,ae as fe,af as te,ag as pe,ah as be,ai as Ce,aj as ye,ak as ve}from"./@mui/icons-material-9178ae4b.js";import{s as _e,f as ne,u as ae,a as X,C as Q,b as Se,c as we,d as ke,e as P,m as Ie,g as Me,h as Te,i as Le,j as Fe,S as De,k as Re,l as Z}from"./index-88972f37.js";import{r as i,d as U}from"./vendor-b612640b.js";import{u as Pe}from"./@reactour/tour-e24be7d6.js";import{u as re}from"./@tanstack/react-query-7cfe65c4.js";import{F as T,n as L,s as F,M as p,p as W,t as Ee,v as Ae,w as Ne,x as Oe,y as Ye,z as Be,I as le,D as Ve,E as ie,G as O,H as v,S as g,d as j,a as Y,g as k,J as qe,l as G,K as He,N as ze,Q as Qe,R as Ge,U as C,V as y,W as ee,X as I,B as $e,L as oe,b as ce,Y as Ke}from"./@mui/material-b942f279.js";import{c as Ue,o as We}from"./use-debounce-6bf2a1da.js";import{d as Je,a as _}from"./dayjs-c0cd33fe.js";import{c as Xe}from"./react-draggable-60e91858.js";import"./@emotion/react-0d101b94.js";import"./@emotion/styled-6b07d811.js";import"./@supabase/supabase-js-711ba96a.js";import"./dexie-3976de5d.js";import"./dexie-react-hooks-0c2ddb12.js";import"./axios-760d4776.js";import"./@react-rxjs/utils-24ca515a.js";import"./@react-rxjs/core-1a0bb4f0.js";import"./react-hook-form-c6612ec3.js";import"./hotkeys-js-d20e5801.js";const Ze=()=>{const{setIsOpen:s,isOpen:n}=Pe(),{data:t,isLoading:r}=re({queryKey:["languages"],queryFn:()=>ne.getAllLanguages()}),c=i.useCallback(a=>{_e(a.target.value)},[]);return i.useEffect(()=>{localStorage.getItem("firstVisit")||(localStorage.setItem("firstVisit",new Date().toDateString()),s(!0))},[s]),i.useEffect(()=>{const a=document.querySelector("body");n?a.style.overflow="hidden":a.style.overflow="auto"},[n]),e.jsx(T,{sx:{width:200},className:"language",children:r?e.jsx(W,{}):e.jsxs(e.Fragment,{children:[e.jsx(L,{id:"language",children:"Lenguaje"}),e.jsx(F,{labelId:"language",label:"Lenguaje",onChange:c,sx:{width:200},defaultValue:"",displayEmpty:!0,children:t==null?void 0:t.map(({id:a,name:l})=>e.jsx(p,{value:a,children:l},a))})]})})},es=()=>{const s=ae(),n=i.useRef(null),{data:t,isFetching:r}=re({queryKey:["qualityprofile",s],queryFn:()=>ne.getQualityProfilesByLanguage(s),enabled:!!s});i.useEffect(()=>{var a;X(((a=n.current)==null?void 0:a.value)??"")},[s]);const c=i.useCallback(a=>{X(a.target.value)},[]);return r?e.jsx(W,{}):e.jsxs(T,{className:"mainFilters",sx:{width:200},children:[e.jsx(L,{id:"qualityprofile",children:"Quality Profile"}),e.jsx(F,{ref:n,onChange:c,label:"Quality Profile",labelId:"qualityprofile",defaultValue:"",displayEmpty:!0,children:t==null?void 0:t.map(({id:a,name:l})=>e.jsx(p,{value:a,children:l},a))})]})},ss=i.memo(function({body:n,header:t,footer:r,stickyHeader:c=!0}){return e.jsxs(Ee,{sx:{paddingY:4,background:"transparent"},children:[e.jsx(Ae,{sx:{maxHeight:"80vh"},children:e.jsxs(Ne,{stickyHeader:c,children:[e.jsx(Oe,{children:t}),e.jsx(Ye,{sx:{backgroundColor:({palette:a})=>a.mode===Q.DARK?a.grey[800]:a.grey[300]},children:n}),r&&n&&e.jsx(Be,{children:r})]})}),!n&&e.jsx("div",{children:"asdsadsadsda"})]})}),ts=({value:s,label:n,reactiveCb:t})=>{const r=i.useCallback(()=>{t(s)},[t,s]);return e.jsx(p,{onClick:r,children:n})},J=({filterConfig:s,reactiveCallback:n,isClosingRecursive:t})=>{const[r,c]=i.useState(null),[a,l]=i.useState(!0),d=i.useCallback(h=>{n(h),l(h==="all"),t&&c(null)},[t,n]),m=i.useCallback(()=>{c(null)},[]),u=i.useCallback(h=>{h.preventDefault(),c(h.currentTarget)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(le,{onClick:u,sx:{padding:"1px !important"},children:e.jsx(Ve,{variant:"dot",invisible:a,color:"secondary",children:e.jsx(xe,{sx:{color:"white"}})})}),e.jsx(ie,{anchorEl:r,onClose:m,open:!!r,children:s.map(({value:h,label:o})=>e.jsx(ts,{label:o,value:h,reactiveCb:d}))})]})};var de=(s=>(s.Blocker="BLOCKER",s.Critical="CRITICAL",s.Info="INFO",s.Major="MAJOR",s.Minor="MINOR",s))(de||{}),ue=(s=>(s.Bug="BUG",s.CodeSmell="CODE_SMELL",s.SecurityHotspot="SECURITY_HOTSPOT",s.Vulnerability="VULNERABILITY",s))(ue||{});const E=[{value:"all",label:"Todos"},...Object.values(ue).map(s=>({value:s,label:s}))],A=[{value:"all",label:"Todos"},...Object.values(de).map(s=>({value:s,label:s}))],N=[{value:"all",label:"Todos"},{value:"active",label:"Activo"},{value:"deactive",label:"Inactivo"}],ns=Object.freeze({all:null,active:!0,deactive:!1}),as=()=>{const s=i.useCallback(n=>{Se(ns[n])},[]);return e.jsx(J,{filterConfig:N,isClosingRecursive:!0,reactiveCallback:s})},rs=()=>{const s=i.useCallback(n=>{we(n)},[]);return e.jsx(J,{filterConfig:A,isClosingRecursive:!0,reactiveCallback:s})},ls=()=>{const s=i.useCallback(n=>ke(n),[]);return e.jsx(J,{filterConfig:E,isClosingRecursive:!0,reactiveCallback:s})},M=[{label:"Código",resource:"key",textAlign:"left"},{label:"Regla",resource:"name",textAlign:"left"},{label:"Tipo",resource:"type",filter:e.jsx(ls,{})},{label:"Severidad",resource:"severity",filter:e.jsx(rs,{})},{label:"Detalle",especialConfig:!0,resource:"htmlDesc"},{label:"Estado Actual",resource:"isActiveSonar",especialConfig:!0,className:"actualState",filter:e.jsx(as,{})},{label:"Estado Propuesto",resource:"isActive",especialConfig:!0,className:"proposedState"},{label:"Última Propuesta: ",resource:"updated_at",especialConfig:!0,icon:e.jsx(me,{sx:{color:s=>s.palette.common.white}})}],is=i.memo(({data:s})=>e.jsx(O,{children:s.map(({label:n,icon:t,className:r,filter:c})=>e.jsx(v,{variant:"head",className:r,sx:{background:a=>`${a.palette.grey[900]} !important`},children:e.jsxs(g,{direction:"row",gap:.5,alignItems:"center",justifyContent:"center",children:[t,e.jsx(j,{sx:{color:a=>a.palette.common.white},fontWeight:700,children:n}),c]})},n))}));var $={},os={get exports(){return $},set exports(s){$=s}};(function(s,n){(function(t,r){s.exports=r()})(U,function(){return function(t,r,c){c.updateLocale=function(a,l){var d=c.Ls[a];if(d)return(l?Object.keys(l):[]).forEach(function(m){d[m]=l[m]}),d}}})})(os);const cs=$;var K={},ds={get exports(){return K},set exports(s){K=s}};(function(s,n){(function(t,r){s.exports=r()})(U,function(){return function(t,r,c){t=t||{};var a=r.prototype,l={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function d(u,h,o,x){return a.fromToBase(u,h,o,x)}c.en.relativeTime=l,a.fromToBase=function(u,h,o,x,D){for(var S,R,B,V=o.$locale().relativeTime||l,q=t.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],he=q.length,w=0;w<he;w+=1){var f=q[w];f.d&&(S=x?c(u).diff(o,f.d,!0):o.diff(u,f.d,!0));var b=(t.rounding||Math.round)(Math.abs(S));if(B=S>0,b<=f.r||!f.r){b<=1&&w>0&&(f=q[w-1]);var H=V[f.l];D&&(b=D(""+b)),R=typeof H=="string"?H.replace("%d",b):H(b,h,f.l,B);break}}if(h)return R;var z=B?V.future:V.past;return typeof z=="function"?z(R):z.replace("%s",R)},a.to=function(u,h){return d(u,h,this,!0)},a.from=function(u,h){return d(u,h,this)};var m=function(u){return u.$u?c.utc():c()};a.toNow=function(u){return this.to(m(this),u)},a.fromNow=function(u){return this.from(m(this),u)}}})})(ds);const us=K;var se={},hs={get exports(){return se},set exports(s){se=s}};(function(s,n){(function(t,r){s.exports=r(Je)})(U,function(t){function r(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var c=r(t),a={name:"es",monthsShort:"ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),weekStart:1,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:function(l){return l+"º"}};return c.default.locale(a,null,!0),a})})(hs);_.extend(cs);_.locale("es");_.extend(us);_.updateLocale("es",{relativeTime:{future:"en %s",past:"hace %s",s:"1 s",m:"1 min",mm:"%d min",h:"1 h",hh:"%d h",d:"1 d",dd:"%d d",M:"1 M",MM:"%d M",y:"1 Y",yy:"%d Y"}});const xs=({date:s})=>e.jsx(j,{align:"left",children:_(s).from(new Date)});function ms(s){const{tags:n,isActive:t,dateSonar:r,ruleTitle:c,ruleDescription:a}=s;return e.jsxs(Y,{children:[e.jsxs(g,{padding:2,direction:"column",spacing:2,children:[e.jsxs(g,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:[e.jsx(k,{sx:{backgroundColor:({palette:l})=>l.mode===Q.DARK?l.grey[900]:l.grey[800],color:"white"},label:`Regla ${t?"activo":"inactivo"} desde:`}),e.jsx(k,{label:`${r??"Sin info"}`})]}),e.jsx(g,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:n.map(l=>e.jsx(k,{label:l},l))})]}),e.jsx(g,{direction:"row",justifyContent:"flex-start",alignItems:"center",padding:2,pb:0,children:e.jsx(qe,{title:c,children:e.jsx(k,{color:"secondary",label:e.jsx(j,{noWrap:!0,variant:"h5",children:c})})})}),e.jsxs(g,{direction:"column",justifyContent:"center",padding:2,children:[e.jsx(g,{direction:"row",justifyContent:"flex-start",children:e.jsx(k,{label:"Descripción de la Regla",sx:{backgroundColor:({palette:l})=>l.mode===Q.DARK?l.grey[900]:l.grey[800],color:"white"}})}),e.jsx(j,{dangerouslySetInnerHTML:{__html:a}})]})]})}function gs({initialStatus:s,result:n,id:t}){const[r,c]=i.useState(!1),[a,l]=i.useState(s);i.useEffect(()=>{l(s)},[s]),i.useEffect(()=>{P.rulesStatus.get(Number(t)).then(u=>c(!!u))},[t]);const d=n.isActiveSonar!==a,m=i.useCallback(async u=>{l(u.target.checked);const h=await P.rulesStatus.get(Number(t));await P.rulesStatus.put({...h,id:Number(t),newStatus:u.target.checked,updated_at:new Date,languageId:n.lang_id,qualityProfileId:Number(n.qualityProfile_id)}),c(!0)},[t,n.lang_id,n.qualityProfile_id]);return e.jsxs(g,{color:"red",direction:"row",children:[e.jsx(G,{onChange:m,checked:a}),r&&d?e.jsx(ge,{}):""]})}const js=({resource:s,value:n,result:t,secondaryValue:r})=>s==="isActiveSonar"?e.jsx(j,{children:n?"Activo":"Inactivo"}):s==="htmlDesc"?e.jsx(Ie,{icon:e.jsx(je,{}),popoverBody:e.jsx(ms,{tags:[t.severity,t.type],isActive:t.isActive,ruleTitle:t.name,ruleDescription:t.htmlDesc})}):s==="updated_at"?Math.abs(_(String(n)).diff(r,"hours"))>6?e.jsx(xs,{date:String(n)}):e.jsx(j,{align:"left",children:"--"}):e.jsx(gs,{initialStatus:!!n,result:t,id:t.id}),fs=({colSpan:s})=>e.jsx(v,{colSpan:s,children:e.jsx(Y,{display:"grid",sx:{placeContent:"center",minHeight:400},children:e.jsx(W,{})})}),ps=({icon:s,primaryText:n,secondaryText:t})=>e.jsxs(g,{direction:"column",justifyContent:"center",alignItems:"center",minHeight:"50vh",sx:{fontSize:100},gap:8,children:[s,e.jsxs(g,{direction:"column",gap:4,children:[e.jsx(j,{color:"GrayText",variant:"h3",children:n}),t&&e.jsx(j,{textAlign:"center",color:"GrayText",variant:"body1",children:t})]})]}),bs=({hasContent:s,children:n,colSpan:t})=>s?e.jsx(e.Fragment,{children:n}):e.jsx(O,{children:e.jsx(v,{colSpan:t,children:e.jsx(ps,{icon:e.jsx(fe,{color:"disabled",fontSize:"inherit"}),primaryText:"Sin datos",secondaryText:"Selecciona filtros"})})}),Cs=({children:s,collapseContent:n,colSpan:t})=>{const[r,c]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:{cursor:"pointer",":hover":{backgroundColor:({palette:a})=>a.grey[400]}},onClick:()=>{c(a=>!a)},children:s}),e.jsx(O,{children:e.jsx(v,{colSpan:t,padding:r?"normal":"none",children:e.jsx(ze,{in:r,sx:{"& .MuiCollapse-wrapperInner":{display:"flex"}},children:n})})})]})},ys=({title:s,result:n})=>{const t=Ue(async({target:r})=>await P.saveDescription(n,r.value),500);return e.jsx(Qe,{multiline:!0,fullWidth:!0,sx:{ml:12,mr:3,minHeight:"initial",height:"auto"},defaultValue:n.description,title:s,placeholder:"Ingresa el porqué del cambio",onChange:t})};function vs(){const[s,n,{data:t,isLoading:r,total:c,page:a,rowsPerPage:l}]=Me(),[d,m]=i.useState(null);i.useEffect(()=>{const o=Te().subscribeChanges(x=>m({...x}));return()=>{o.unsubscribe()}},[]),console.log(d);const u=i.useCallback((o,x)=>{o&&s(x+1)},[s]),h=i.useCallback(o=>{n(parseInt(o.target.value,10)),s(1)},[s,n]);return e.jsxs(e.Fragment,{children:[e.jsx(ss,{body:r?e.jsx(fs,{colSpan:M.length}):e.jsx(bs,{hasContent:!!(t!=null&&t.length),colSpan:M.length,children:r?[]:t==null?void 0:t.map(o=>e.jsx(Cs,{colSpan:M.length,collapseContent:e.jsx(ys,{result:{...o,...Number(d==null?void 0:d.new.id)!==Number(o.id)?{}:d==null?void 0:d.new},title:`${o.id}-comments`}),children:M.map(({resource:x,especialConfig:D,textAlign:S})=>D?e.jsx(v,{sx:{textAlign:"center"},children:e.jsx(js,{result:{...o,...Number(d==null?void 0:d.new.id)!==Number(o.id)?{}:d==null?void 0:d.new},resource:x,secondaryValue:o.created_at,value:{...o,...Number(d==null?void 0:d.new.id)!==Number(o.id)?{}:d==null?void 0:d.new}[x]??"--"})},x+o.id):e.jsx(v,{sx:{textAlign:S??"center"},children:String(o[x]??"--")},x+o.id))},o.id))}),header:e.jsx(is,{data:M})}),e.jsx(Y,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(He,{rowsPerPage:l,count:c??1e3,page:a-1,onPageChange:u,onRowsPerPageChange:h,labelRowsPerPage:"Filas por página"})})]})}const _s=({content:s})=>e.jsx("div",{style:{position:"sticky",bottom:20,left:20,display:"flex",justifyContent:"flex-end",zIndex:500},children:s}),Ss=({handleClose:s,isOpen:n})=>{const[t,r]=i.useState(!1),c=i.useRef(),a=i.useRef(),l=i.useRef(),d=()=>{r(!t)},m=o=>{c.current=o.target.value},u=o=>{a.current=o.target.value},h=o=>{l.current=o.target.value};return e.jsxs(Ge,{variant:"persistent",onClose:s,anchor:"right",open:n,sx:{minWidth:300},children:[e.jsx(C,{children:e.jsx(y,{children:e.jsx(ee,{control:e.jsx(G,{onClick:d}),label:"Filtros"})})}),e.jsx(I,{}),e.jsx(C,{children:e.jsx(y,{children:e.jsxs(T,{sx:{width:200},className:"type",onChange:m,children:[e.jsx(L,{id:"type",children:"Type"}),e.jsx(F,{labelId:"type",label:"Type",sx:{width:200},defaultValue:"",disabled:!t,displayEmpty:!0,children:E==null?void 0:E.map(({value:o,label:x})=>e.jsx(p,{value:o,children:o},x))})]})})}),e.jsx(I,{}),e.jsx(C,{children:e.jsx(y,{children:e.jsxs(T,{sx:{width:200},className:"severity",onChange:u,children:[e.jsx(L,{id:"severity",children:"Severity"}),e.jsx(F,{labelId:"severity",label:"Severity",sx:{width:200},defaultValue:"",disabled:!t,displayEmpty:!0,children:A==null?void 0:A.map(({value:o,label:x})=>e.jsx(p,{value:o,children:o},x))})]})})}),e.jsx(I,{}),e.jsx(C,{children:e.jsx(y,{children:e.jsxs(T,{sx:{width:200},className:"state",onChange:h,children:[e.jsx(L,{id:"state",children:"State"}),e.jsx(F,{labelId:"state",label:"State",sx:{width:200},defaultValue:"",disabled:!t,displayEmpty:!0,children:N==null?void 0:N.map(({value:o,label:x})=>e.jsx(p,{value:o,children:o},x))})]})})}),e.jsx(I,{}),e.jsx(C,{children:e.jsx(y,{children:e.jsx(ee,{control:e.jsx(G,{}),label:"Solo diferencias"})})}),e.jsx(I,{}),e.jsx(C,{children:e.jsx(y,{children:e.jsx($e,{variant:"contained",startIcon:e.jsx(te,{}),sx:{width:200},children:"Download"})})})]})},ws=()=>{const[s,n]=i.useState(!1),t=i.useCallback(()=>{n(!0)},[]),r=i.useCallback(()=>{n(!1)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(p,{onClick:t,children:[e.jsx(oe,{children:e.jsx(te,{})}),e.jsx(ce,{children:"Descarga Personalizada"})]}),e.jsx(Ss,{handleClose:r,isOpen:s})]})},ks=()=>{const[s]=Le();return e.jsxs(p,{onClick:s,children:[e.jsx(oe,{children:e.jsx(pe,{fontSize:"small"})}),e.jsx(ce,{children:"Restaurar"})]})},Is=()=>{const[s,n]=i.useState(null),t=i.useRef(null),r=Fe(),c=i.useCallback(()=>{n(null)},[]);i.useEffect(()=>{n(r?t.current:null)},[r]);const a=i.useCallback(({currentTarget:l})=>{n(l)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Xe,{children:e.jsx(le,{ref:t,onClick:a,sx:{background:({palette:l})=>l.secondary.main,zIndex:500},className:"dragableMenu",children:e.jsx(be,{fontSize:"large"})})}),e.jsxs(ie,{className:"menuDragable",anchorEl:s,open:!!s,onClose:c,children:[e.jsx(De,{}),e.jsx(ws,{}),e.jsx(ks,{})]})]})},Ms=()=>{const s=ae(),n=Re(),[t,r]=i.useState(),[c]=We(t,1e3),a=i.useMemo(()=>s&&n,[s,n]),l=i.useCallback(({target:d})=>{r(d.value)},[]);return i.useEffect(()=>{r(""),Z()},[s,n]),i.useEffect(()=>{Z(c)},[c]),e.jsx(Ke,{value:t,disabled:!a,onChange:l,startAdornment:e.jsx(Ce,{})})};function Ks(){return e.jsxs(e.Fragment,{children:[e.jsxs(g,{gap:3,children:[e.jsxs(j,{children:[e.jsx(ye,{})," Activa o desactiva los switches dependiendo si deseas habilitar la regla o no"]}),e.jsxs(j,{children:[e.jsx(ve,{})," Recuerda que los estados que propongas no se aplicarán de inmediato en SonarQube"]})]}),e.jsx(g,{direction:"column",gap:4,marginTop:4,children:e.jsxs(Y,{display:"flex",gap:4,children:[e.jsx(Ze,{}),e.jsx(es,{}),e.jsx(Ms,{})]})}),e.jsx(vs,{}),e.jsx(_s,{content:e.jsx(Is,{})})]})}export{Ks as default};
