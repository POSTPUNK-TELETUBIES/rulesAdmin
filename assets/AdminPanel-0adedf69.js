import{j as e,ad as ge,ae as me,a4 as fe,ab as pe,af as je,ag as U,ah as ye,ai as Ce,aj as be,ak as ve,al as _e}from"./@mui/icons-material-c2086071.js";import{r as i,d as H}from"./vendor-b612640b.js";import{f as J,s as Se,v as ke,D as Ie,u as X,a as V,b as Me,c as we,d as Pe,C as W,A as Z,e as k,m as Le,g as Fe,h as Te,p as Ae,i as De,j as Re,k as Ee,S as Oe,l as Be,n as G}from"./index-c773c5b2.js";import{u as Ye}from"./@reactour/tour-e24be7d6.js";import{u as ee}from"./@tanstack/react-query-7cfe65c4.js";import{F as P,I as L,x as F,M as f,y as qe,r as te,h as w,i as C,S as g,B as T,q as Ne,z as He,E as Qe,G as ze,s as Ve,H as M,J as $,L as ne,e as se,K as We}from"./@mui/material-a75857e6.js";import{D as A,s as ae,b as m,C as _,E as le,H as Ge,x as $e}from"./@mui/lab-cc97fd70.js";import{c as Ke,o as Ue}from"./use-debounce-6bf2a1da.js";import{d as Je,a as b}from"./dayjs-c0cd33fe.js";import{c as Xe}from"./react-draggable-cc2383fd.js";import{u as Ze}from"./react-hook-form-c6612ec3.js";import"./@emotion/react-0d101b94.js";import"./@emotion/styled-6b07d811.js";import"./@supabase/supabase-js-711ba96a.js";import"./dexie-3976de5d.js";import"./dexie-react-hooks-0c2ddb12.js";import"./axios-760d4776.js";import"./papaparse-e84842e1.js";import"./@react-rxjs/utils-24ca515a.js";import"./@react-rxjs/core-1a0bb4f0.js";import"./notistack-f220509a.js";import"./hotkeys-js-d20e5801.js";const et=()=>{const{data:t,isLoading:s}=ee({queryKey:["languages"],queryFn:()=>J.getAllLanguages()});return{data:t,isLoading:s}},re=t=>{const{data:s,isFetching:n}=ee({queryKey:["qualityprofile",t],queryFn:()=>J.getQualityProfilesByLanguage(t),enabled:!!t});return{data:s,isFetching:n}},ie=({className:t,handleChange:s,inputProps:n,includeAllOption:a,displayEmpty:o})=>{const{data:l,isLoading:r}=et();return e.jsx(P,{sx:{width:200},className:t,children:r?e.jsx(A,{}):e.jsxs(e.Fragment,{children:[e.jsx(L,{id:"language",children:"Lenguaje"}),e.jsxs(F,{inputProps:n,labelId:"language",label:"Lenguaje",onChange:s,sx:{width:200},defaultValue:a?"all":"",displayEmpty:o,children:[a&&e.jsx(f,{value:"all",children:"Todos"}),l==null?void 0:l.map(({id:h,name:u})=>e.jsx(f,{value:h,children:u},h))]})]})})},tt=()=>{const{setIsOpen:t,isOpen:s}=Ye(),n=i.useCallback(a=>{Se(a.target.value)},[]);return i.useEffect(()=>{const a=ke();t(a)},[t]),i.useEffect(()=>{Ie("body",s==null?void 0:s.valueOf())},[s]),e.jsx(ie,{className:"language",handleChange:n,displayEmpty:!0})},nt=()=>{const t=X(),s=i.useRef(null),{data:n,isFetching:a}=re(t);i.useEffect(()=>{var l;V(((l=s.current)==null?void 0:l.value)??"")},[t]);const o=i.useCallback(l=>{V(l.target.value)},[]);return a?e.jsx(A,{}):e.jsxs(P,{className:"mainFilters",sx:{width:200},children:[e.jsx(L,{id:"qualityprofile",children:"Quality Profile"}),e.jsx(F,{ref:s,onChange:o,label:"Quality Profile",labelId:"qualityprofile",defaultValue:"",displayEmpty:!0,children:n==null?void 0:n.map(({id:l,name:r})=>e.jsx(f,{value:l,children:r},l))})]})},st=({value:t,label:s,reactiveCb:n})=>{const a=i.useCallback(()=>{n(t)},[n,t]);return e.jsx(f,{onClick:a,children:s})},Q=({filterConfig:t,reactiveCallback:s,isClosingRecursive:n})=>{const[a,o]=i.useState(null),[l,r]=i.useState(!0),h=i.useCallback(d=>{s(d),r(d==="all"),n&&o(null)},[n,s]),u=i.useCallback(()=>{o(null)},[]),c=i.useCallback(d=>{d.preventDefault(),o(d.currentTarget)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{onClick:c,sx:{padding:"1px !important"},children:e.jsx(qe,{variant:"dot",invisible:l,color:"secondary",children:e.jsx(ge,{sx:{color:"#e4a010"}})})}),e.jsx(te,{anchorEl:a,onClose:u,open:!!a,children:t.map(({value:d,label:x})=>e.jsx(st,{label:x,value:d,reactiveCb:h}))})]})};var oe=(t=>(t.Blocker="BLOCKER",t.Critical="CRITICAL",t.Info="INFO",t.Major="MAJOR",t.Minor="MINOR",t))(oe||{}),ce=(t=>(t.Bug="BUG",t.CodeSmell="CODE_SMELL",t.SecurityHotspot="SECURITY_HOTSPOT",t.Vulnerability="VULNERABILITY",t))(ce||{});const de=[{value:"all",label:"Todos"},...Object.values(ce).map(t=>({value:t,label:t}))],ue=[{value:"all",label:"Todos"},...Object.values(oe).map(t=>({value:t,label:t}))],he=[{value:"all",label:"Todos"},{value:"active",label:"Activo"},{value:"deactive",label:"Inactivo"}],at=Object.freeze({all:null,active:!0,deactive:!1}),lt=()=>{const t=i.useCallback(s=>{Me(at[s])},[]);return e.jsx(Q,{filterConfig:he,isClosingRecursive:!0,reactiveCallback:t})},rt=()=>{const t=i.useCallback(s=>{we(s)},[]);return e.jsx(Q,{filterConfig:ue,isClosingRecursive:!0,reactiveCallback:t})},it=()=>{const t=i.useCallback(s=>Pe(s),[]);return e.jsx(Q,{filterConfig:de,isClosingRecursive:!0,reactiveCallback:t})},S=[{label:"",especialConfig:!0,resource:"htmlDesc"},{label:"Código",resource:"key",textAlign:"left"},{label:"Regla",resource:"name",textAlign:"left"},{label:"Tipo",resource:"type",filter:e.jsx(it,{}),textAlign:"left"},{label:"Severidad",resource:"severity",textAlign:"left",filter:e.jsx(rt,{})},{label:"E. Actual",resource:"isActiveSonar",especialConfig:!0,className:"actualState",textAlign:"left",filter:e.jsx(lt,{}),sxProps:{minWidth:100}},{label:"E. Propuesto",resource:"isActive",especialConfig:!0,className:"proposedState",sxProps:{minWidth:100}},{label:"Propuesta",resource:"updated_at",especialConfig:!0,icon:e.jsx(me,{sx:{color:t=>t.palette.common.white}})},{label:"Autor",resource:"user_email"}],ot=i.memo(({data:t})=>e.jsx(e.Fragment,{children:e.jsx(w,{children:t.map(({label:s,icon:n,filter:a,className:o,sxProps:l})=>e.jsx(C,{variant:"head",className:o,sx:{background:r=>`${r.palette.grey[900]} !important`,...l},children:e.jsxs(g,{direction:"row",gap:.5,alignItems:"center",justifyContent:"space-between",children:[e.jsx(m,{sx:{color:r=>r.palette.common.white},fontWeight:700,children:s}),n,a]})},s))})}));var q={},ct={get exports(){return q},set exports(t){q=t}};(function(t,s){(function(n,a){t.exports=a()})(H,function(){return function(n,a,o){o.updateLocale=function(l,r){var h=o.Ls[l];if(h)return(r?Object.keys(r):[]).forEach(function(u){h[u]=r[u]}),h}}})})(ct);const dt=q;var N={},ut={get exports(){return N},set exports(t){N=t}};(function(t,s){(function(n,a){t.exports=a()})(H,function(){return function(n,a,o){n=n||{};var l=a.prototype,r={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function h(c,d,x,j){return l.fromToBase(c,d,x,j)}o.en.relativeTime=r,l.fromToBase=function(c,d,x,j,z){for(var D,I,R,E=x.$locale().relativeTime||r,O=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],xe=O.length,v=0;v<xe;v+=1){var p=O[v];p.d&&(D=j?o(c).diff(x,p.d,!0):x.diff(c,p.d,!0));var y=(n.rounding||Math.round)(Math.abs(D));if(R=D>0,y<=p.r||!p.r){y<=1&&v>0&&(p=O[v-1]);var B=E[p.l];z&&(y=z(""+y)),I=typeof B=="string"?B.replace("%d",y):B(y,d,p.l,R);break}}if(d)return I;var Y=R?E.future:E.past;return typeof Y=="function"?Y(I):Y.replace("%s",I)},l.to=function(c,d){return h(c,d,this,!0)},l.from=function(c,d){return h(c,d,this)};var u=function(c){return c.$u?o.utc():o()};l.toNow=function(c){return this.to(u(this),c)},l.fromNow=function(c){return this.from(u(this),c)}}})})(ut);const ht=N;var K={},xt={get exports(){return K},set exports(t){K=t}};(function(t,s){(function(n,a){t.exports=a(Je)})(H,function(n){function a(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var o=a(n),l={name:"es",monthsShort:"ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),weekStart:1,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:function(r){return r+"º"}};return o.default.locale(l,null,!0),l})})(xt);b.extend(dt);b.locale("es");b.extend(ht);b.updateLocale("es",{relativeTime:{future:"en %s",past:"hace %s",s:"1 s",m:"1 min",mm:"%d min",h:"1 h",hh:"%d h",d:"1 d",dd:"%d d",M:"1 M",MM:"%d M",y:"1 Y",yy:"%d Y"}});const gt=({date:t})=>e.jsx(m,{align:"left",children:b(t).from(new Date)});function mt(t){const{tags:s,isActive:n,dateSonar:a,ruleTitle:o,ruleDescription:l}=t;return e.jsxs(T,{children:[e.jsxs(g,{padding:2,direction:"column",spacing:2,children:[e.jsxs(g,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:[e.jsx(_,{sx:{backgroundColor:({palette:r})=>r.mode===W.DARK?r.grey[900]:r.grey[800],color:"white"},label:`Regla ${n?"activo":"inactivo"} desde:`}),e.jsx(_,{label:`${a??"Sin info"}`})]}),e.jsx(g,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:s.map(r=>e.jsx(_,{label:r},r))})]}),e.jsx(g,{direction:"row",justifyContent:"flex-start",alignItems:"center",padding:2,pb:0,children:e.jsx(le,{title:o,children:e.jsx(_,{color:"secondary",label:e.jsx(m,{noWrap:!0,variant:"h5",children:o})})})}),e.jsxs(g,{direction:"column",justifyContent:"center",padding:2,children:[e.jsx(g,{direction:"row",justifyContent:"flex-start",children:e.jsx(_,{label:"Descripción de la Regla",sx:{backgroundColor:({palette:r})=>r.mode===W.DARK?r.grey[900]:r.grey[800],color:"white"}})}),e.jsx(m,{dangerouslySetInnerHTML:{__html:l}})]})]})}function ft({initialStatus:t,result:s,id:n}){const[a,o]=i.useState(!1),[l,r]=i.useState(t),{user:h}=i.useContext(Z);i.useEffect(()=>{r(t)},[t]),i.useEffect(()=>{k.rulesStatus.get(Number(n)).then(d=>o(!!d))},[n]);const u=s.isActiveOriginal!==l;i.useEffect(()=>{a&&s.isActiveOriginal===l&&k.rulesStatus.delete(Number(n))},[l,n,a,s.isActiveOriginal]);const c=i.useCallback(async d=>{r(d.target.checked);const x=await k.rulesStatus.get(Number(n));(!a||s.isActiveOriginal!==d.target.checked)&&await k.rulesStatus.put({...x,id:Number(n),newStatus:d.target.checked,updated_at:new Date,languageId:s.lang_id,qualityProfileId:Number(s.qualityProfile_id),user_email:h==null?void 0:h.email}),o(!0)},[n,a,s.isActiveOriginal,s.lang_id,s.qualityProfile_id,h==null?void 0:h.email]);return e.jsxs(g,{direction:"row",alignItems:"center",children:[e.jsx(m,{minWidth:60,children:l?"Activo":"Inactivo"}),e.jsx(Ne,{onChange:c,checked:l}),a&&u?e.jsx(fe,{}):""]})}const pt=({resource:t,value:s,result:n,secondaryValue:a})=>t==="isActiveSonar"?e.jsx(m,{children:s?"Activo":"Inactivo"}):t==="htmlDesc"?e.jsx(Le,{icon:e.jsx(pe,{}),popoverBody:e.jsx(mt,{tags:[n.severity,n.type],isActive:n.isActive,ruleTitle:n.name,ruleDescription:n.htmlDesc})}):t==="updated_at"?Math.abs(b(String(s)).diff(a,"hours"))>6?e.jsx(gt,{date:String(s)}):e.jsx(m,{align:"left",children:"--"}):e.jsx(ft,{initialStatus:!!s,result:n,id:n.id}),jt=({colSpan:t})=>e.jsx(C,{colSpan:t,children:e.jsx(T,{display:"grid",sx:{placeContent:"center",minHeight:400},children:e.jsx(A,{})})}),yt=({icon:t,primaryText:s,secondaryText:n})=>e.jsxs(g,{direction:"column",justifyContent:"center",alignItems:"center",minHeight:"50vh",sx:{fontSize:100},gap:8,children:[t,e.jsxs(g,{direction:"column",gap:4,children:[e.jsx(m,{color:"GrayText",variant:"h3",children:s}),n&&e.jsx(m,{textAlign:"center",color:"GrayText",variant:"body1",children:n})]})]}),Ct=({hasContent:t,children:s,colSpan:n})=>t?e.jsx(e.Fragment,{children:s}):e.jsx(w,{children:e.jsx(C,{colSpan:n,children:e.jsx(yt,{icon:e.jsx(je,{color:"disabled",fontSize:"inherit"}),primaryText:"Sin datos",secondaryText:"Selecciona filtros"})})}),bt=({children:t,collapseContent:s,colSpan:n})=>{const[a,o]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(w,{sx:{cursor:"pointer",":hover":{backgroundColor:({palette:l})=>l.grey[400]}},onClick:()=>{o(l=>!l)},children:t}),e.jsx(w,{children:e.jsx(C,{colSpan:n,padding:a?"normal":"none",children:e.jsx(Ge,{in:a,sx:{"& .MuiCollapse-wrapperInner":{display:"flex"}},children:s})})})]})},vt=({title:t,result:s})=>{const{user:n}=i.useContext(Z),a=Ke(async({target:o})=>await k.saveDescription({...s,user_email:n==null?void 0:n.email},o.value),500);return e.jsx(Qe,{multiline:!0,fullWidth:!0,sx:{ml:18,mr:15,minHeight:"initial",height:"auto"},defaultValue:s.description,title:t,InputProps:{style:{fontStyle:"italic",fontWeight:"normal"},startAdornment:e.jsx("span",{style:{fontWeight:"bold"},children:"Sustento de la Propuesta de Cambio:"})},placeholder:"Esta regla aún no ha tenido observaciones",onChange:a})};function _t(){const[t,s,{data:n,isFetching:a,total:o,page:l,rowsPerPage:r}]=Fe(),h=i.useCallback((c,d)=>{c&&t(d+1)},[t]),u=i.useCallback(c=>{s(parseInt(c.target.value,10)),t(1)},[t,s]);return e.jsxs(e.Fragment,{children:[e.jsx(Te,{body:a?e.jsx(jt,{colSpan:S.length}):e.jsx(Ct,{hasContent:!!(n!=null&&n.length),colSpan:S.length,children:a?[]:n==null?void 0:n.map(c=>e.jsx(bt,{colSpan:S.length,collapseContent:e.jsx(vt,{result:c,title:`${c.id}-comments`}),children:S.map(({resource:d,especialConfig:x,textAlign:j})=>x?e.jsx(C,{sx:{textAlign:j??"center"},children:e.jsx(pt,{result:c,resource:d,secondaryValue:c.created_at,value:c[d]??"--"})},d+c.id):e.jsx(C,{sx:{textAlign:j??"center",maxWidth:140},children:e.jsx(le,{title:String(c[d]??"--"),children:e.jsx(m,{noWrap:!0,sx:{...d==="key"?{width:60}:{}},children:Ae(String(c[d]??"--"),d==="key")})})},d+c.id))},c.id))}),header:e.jsx(ot,{data:S})}),e.jsx(T,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(He,{rowsPerPage:r,count:o??1e3,page:l-1,onPageChange:h,onRowsPerPageChange:u,labelRowsPerPage:"Filas por página"})})]})}const St=({content:t})=>e.jsx("div",{style:{position:"sticky",bottom:20,left:"90vw",width:40,display:"flex",justifyContent:"flex-end",zIndex:500},children:t}),kt=({input:t,id:s,label:n})=>e.jsxs(P,{sx:{width:200},children:[e.jsx(L,{id:s,children:n}),t]}),It=({label:t,labelId:s,inputProps:n,config:a})=>e.jsx(F,{labelId:s,label:t,sx:{width:200},defaultValue:"all",displayEmpty:!0,inputProps:n,children:a==null?void 0:a.map(({value:o,label:l})=>e.jsx(f,{value:o,children:l},l))}),Mt=[{id:"type-uncontrolled",label:"Type",registerField:"type",config:de},{id:"severity-uncontrolled",label:"Severity",registerField:"severity",config:ue},{id:"state-uncontrolled",label:"State",registerField:"state",config:he}],wt=({handleChanges:t,text:s,inputProps:n})=>{const{data:a,isFetching:o}=re(s==="all"?"":s);return o?e.jsx(A,{}):e.jsxs(P,{sx:{width:200},children:[e.jsx(L,{id:"qualityProfile-uncontrolled",children:"Quality Profile"}),e.jsxs(F,{inputProps:n,onChange:t,label:"Quality Profile",labelId:"qualityProfile-uncontrolled",defaultValue:"all",children:[e.jsx(f,{value:"all",children:"Todos"}),a==null?void 0:a.map(({id:l,name:r})=>e.jsx(f,{value:l,children:r},l))]})]})},Pt=({handleClose:t,isOpen:s})=>{const{register:n,handleSubmit:a}=Ze(),[o,l]=i.useState(),r=i.useCallback(async u=>await De().downloadReport({lang_id:u.language_id,qualityProfile_id:u.qualityProfile_id,severity:u.severity,type:u.type,isActiveSonar:u.state},u.showOnlyIsActiveDifferences),[]),h=i.useCallback(u=>{l(u.target.value)},[]);return e.jsx(ze,{variant:"persistent",onClose:t,anchor:"right",open:s,children:e.jsx(g,{sx:{minWidth:400},component:"form",onSubmit:a(r),children:e.jsxs(Ve,{children:[e.jsx(M,{children:e.jsx(ie,{includeAllOption:!0,inputProps:n("language_id"),className:"generic-filter-uncontrolled",handleChange:h})}),e.jsx(M,{children:e.jsx(wt,{text:o,inputProps:n("qualityProfile_id")})}),e.jsx($,{}),Mt.map(({id:u,label:c,registerField:d,config:x})=>e.jsx(M,{children:e.jsx(kt,{label:c,id:u,input:e.jsx(It,{config:x,label:c,labelId:u,inputProps:n(d)})})},u+c)),e.jsx($,{}),e.jsx(M,{children:e.jsx($e,{type:"submit",variant:"contained",startIcon:e.jsx(U,{}),sx:{width:"100%"},children:"Descargar"})})]})})})},Lt=()=>{const[t,s]=i.useState(!1),n=i.useCallback(()=>{s(!0)},[]),a=i.useCallback(()=>{s(!1)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(f,{onClick:n,children:[e.jsx(ne,{children:e.jsx(U,{})}),e.jsx(se,{children:"Descarga Personalizada"})]}),e.jsx(Pt,{handleClose:a,isOpen:t})]})},Ft=()=>{const[t]=Re();return e.jsxs(f,{onClick:t,children:[e.jsx(ne,{children:e.jsx(ye,{fontSize:"small"})}),e.jsx(se,{children:"Restaurar"})]})},Tt=()=>{const[t,s]=i.useState(null),n=i.useRef(null),a=Ee(),o=i.useCallback(()=>{s(null)},[]);i.useEffect(()=>{s(a?n.current:null)},[a]);const l=i.useCallback(({currentTarget:r})=>{s(r)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Xe,{children:e.jsx(ae,{ref:n,onClick:l,sx:{background:({palette:r})=>r.secondary.main,zIndex:500},className:"dragableMenu",children:e.jsx(Ce,{fontSize:"large"})})}),e.jsxs(te,{className:"menuDragable",anchorEl:t,open:!!t,onClose:o,children:[e.jsx(Oe,{}),e.jsx(Lt,{}),e.jsx(Ft,{})]})]})},At=()=>{const t=X(),s=Be(),[n,a]=i.useState(),[o]=Ue(n,1e3),l=i.useMemo(()=>t&&s,[t,s]),r=i.useCallback(({target:h})=>{a(h.value)},[]);return i.useEffect(()=>{a(""),G()},[t,s]),i.useEffect(()=>{G(o)},[o]),e.jsx(We,{value:n,disabled:!l,onChange:r,startAdornment:e.jsx(be,{})})};function nn(){return e.jsxs(e.Fragment,{children:[e.jsxs(g,{gap:3,children:[e.jsxs(m,{children:[e.jsx(ve,{})," Activa o desactiva los switches dependiendo si deseas habilitar la regla o no"]}),e.jsxs(m,{children:[e.jsx(_e,{})," Recuerda que los estados que propongas no se aplicarán de inmediato en SonarQube"]})]}),e.jsx(g,{direction:"column",gap:4,marginTop:4,children:e.jsxs(T,{display:"flex",gap:4,children:[e.jsx(tt,{}),e.jsx(nt,{}),e.jsx(At,{})]})}),e.jsx(_t,{}),e.jsx(St,{content:e.jsx(Tt,{})})]})}export{nn as default};
