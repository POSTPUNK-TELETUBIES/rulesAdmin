import{j as e,aa as ue,ab as he,a3 as xe,a9 as me,ac as ge,ad as te,ae as je,af as pe,ag as fe,ah as be,ai as ye}from"./@mui/icons-material-c62336cc.js";import{s as Ce,f as se,u as ve,a as X,C as z,b as _e,c as Se,d as we,e as F,m as Ie,g as ke,h as Me,i as Te,S as Le}from"./index-3be397fa.js";import{r as o,d as K}from"./vendor-b612640b.js";import{u as De}from"./@reactour/tour-e24be7d6.js";import{u as ne}from"./@tanstack/react-query-7cfe65c4.js";import{F as M,m as T,r as L,M as f,o as U,s as Fe,t as Re,v as Pe,w as Ee,x as Ae,y as Oe,I as ae,z as Be,D as re,E as A,G as v,S as m,d as j,a as O,g as w,H as Ye,l as G,J as Ne,K as Ve,N as qe,Q as He,R as y,U as C,V as Z,W as I,B as ze,L as le,b as ie}from"./@mui/material-b56fe79a.js";import{c as Ge}from"./use-debounce-b0ac4a1c.js";import{d as Qe,a as _}from"./dayjs-c0cd33fe.js";import{c as $e}from"./react-draggable-fc23873a.js";import"./@emotion/react-0d101b94.js";import"./@emotion/styled-6b07d811.js";import"./@supabase/supabase-js-711ba96a.js";import"./dexie-3976de5d.js";import"./dexie-react-hooks-0c2ddb12.js";import"./axios-760d4776.js";import"./@react-rxjs/utils-24ca515a.js";import"./@react-rxjs/core-1a0bb4f0.js";import"./react-hook-form-c6612ec3.js";import"./hotkeys-js-d20e5801.js";const Ke=()=>{const{setIsOpen:t,isOpen:n}=De(),{data:s,isLoading:r}=ne({queryKey:["languages"],queryFn:()=>se.getAllLanguages()}),c=o.useCallback(a=>{Ce(a.target.value)},[]);return o.useEffect(()=>{localStorage.getItem("firstVisit")||(localStorage.setItem("firstVisit",new Date().toDateString()),t(!0))},[t]),o.useEffect(()=>{const a=document.querySelector("body");n?a.style.overflow="hidden":a.style.overflow="auto"},[n]),e.jsx(M,{sx:{width:200},className:"language",children:r?e.jsx(U,{}):e.jsxs(e.Fragment,{children:[e.jsx(T,{id:"language",children:"Lenguaje"}),e.jsx(L,{labelId:"language",label:"Lenguaje",onChange:c,sx:{width:200},defaultValue:"",displayEmpty:!0,children:s==null?void 0:s.map(({id:a,name:l})=>e.jsx(f,{value:a,children:l},a))})]})})},Ue=()=>{const t=ve(),n=o.useRef(null),{data:s,isFetching:r}=ne({queryKey:["qualityprofile",t],queryFn:()=>se.getQualityProfilesByLanguage(t),enabled:!!t});o.useEffect(()=>{var a;X(((a=n.current)==null?void 0:a.value)??"")},[t]);const c=o.useCallback(a=>{X(a.target.value)},[]);return r?e.jsx(U,{}):e.jsxs(M,{className:"mainFilters",sx:{width:200},children:[e.jsx(T,{id:"qualityprofile",children:"Quality Profile"}),e.jsx(L,{ref:n,onChange:c,label:"Quality Profile",labelId:"qualityprofile",defaultValue:"",displayEmpty:!0,children:s==null?void 0:s.map(({id:a,name:l})=>e.jsx(f,{value:a,children:l},a))})]})},We=o.memo(function({body:n,header:s,footer:r,stickyHeader:c=!0}){return e.jsxs(Fe,{sx:{paddingY:4,background:"transparent"},children:[e.jsx(Re,{sx:{maxHeight:"80vh"},children:e.jsxs(Pe,{stickyHeader:c,children:[e.jsx(Ee,{children:s}),e.jsx(Ae,{sx:{backgroundColor:({palette:a})=>a.mode===z.DARK?a.grey[800]:a.grey[300]},children:n}),r&&n&&e.jsx(Oe,{children:r})]})}),!n&&e.jsx("div",{children:"asdsadsadsda"})]})}),Je=({value:t,label:n,reactiveCb:s})=>{const r=o.useCallback(()=>{s(t)},[s,t]);return e.jsx(f,{onClick:r,children:n})},W=({filterConfig:t,reactiveCallback:n,isClosingRecursive:s})=>{const[r,c]=o.useState(null),[a,l]=o.useState(!0),h=o.useCallback(d=>{n(d),l(d==="all"),s&&c(null)},[s,n]),x=o.useCallback(()=>{c(null)},[]),i=o.useCallback(d=>{d.preventDefault(),c(d.currentTarget)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{onClick:i,sx:{padding:"1px !important"},children:e.jsx(Be,{variant:"dot",invisible:a,color:"secondary",children:e.jsx(ue,{sx:{color:"white"}})})}),e.jsx(re,{anchorEl:r,onClose:x,open:!!r,children:t.map(({value:d,label:u})=>e.jsx(Je,{label:u,value:d,reactiveCb:h}))})]})};var oe=(t=>(t.Blocker="BLOCKER",t.Critical="CRITICAL",t.Info="INFO",t.Major="MAJOR",t.Minor="MINOR",t))(oe||{}),ce=(t=>(t.Bug="BUG",t.CodeSmell="CODE_SMELL",t.SecurityHotspot="SECURITY_HOTSPOT",t.Vulnerability="VULNERABILITY",t))(ce||{});const R=[{value:"all",label:"Todos"},...Object.values(ce).map(t=>({value:t,label:t}))],P=[{value:"all",label:"Todos"},...Object.values(oe).map(t=>({value:t,label:t}))],E=[{value:"all",label:"Todos"},{value:"active",label:"Activo"},{value:"deactive",label:"Inactivo"}],Xe=Object.freeze({all:null,active:!0,deactive:!1}),Ze=()=>{const t=o.useCallback(n=>{_e(Xe[n])},[]);return e.jsx(W,{filterConfig:E,isClosingRecursive:!0,reactiveCallback:t})},et=()=>{const t=o.useCallback(n=>{Se(n)},[]);return e.jsx(W,{filterConfig:P,isClosingRecursive:!0,reactiveCallback:t})},tt=()=>{const t=o.useCallback(n=>we(n),[]);return e.jsx(W,{filterConfig:R,isClosingRecursive:!0,reactiveCallback:t})},k=[{label:"Código",resource:"key",textAlign:"left"},{label:"Regla",resource:"name",textAlign:"left"},{label:"Tipo",resource:"type",filter:e.jsx(tt,{})},{label:"Severidad",resource:"severity",filter:e.jsx(et,{})},{label:"Detalle",especialConfig:!0,resource:"htmlDesc"},{label:"Estado Actual",resource:"isActiveSonar",especialConfig:!0,className:"actualState",filter:e.jsx(Ze,{})},{label:"Estado Propuesto",resource:"isActive",especialConfig:!0,className:"proposedState"},{label:"Última Propuesta: ",resource:"updated_at",especialConfig:!0,icon:e.jsx(he,{sx:{color:t=>t.palette.common.white}})}],st=o.memo(({data:t})=>e.jsx(A,{children:t.map(({label:n,icon:s,className:r,filter:c})=>e.jsx(v,{variant:"head",className:r,sx:{background:a=>`${a.palette.grey[900]} !important`},children:e.jsxs(m,{direction:"row",gap:.5,alignItems:"center",justifyContent:"center",children:[s,e.jsx(j,{sx:{color:a=>a.palette.common.white},fontWeight:700,children:n}),c]})},n))}));var Q={},nt={get exports(){return Q},set exports(t){Q=t}};(function(t,n){(function(s,r){t.exports=r()})(K,function(){return function(s,r,c){c.updateLocale=function(a,l){var h=c.Ls[a];if(h)return(l?Object.keys(l):[]).forEach(function(x){h[x]=l[x]}),h}}})})(nt);const at=Q;var $={},rt={get exports(){return $},set exports(t){$=t}};(function(t,n){(function(s,r){t.exports=r()})(K,function(){return function(s,r,c){s=s||{};var a=r.prototype,l={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function h(i,d,u,g){return a.fromToBase(i,d,u,g)}c.en.relativeTime=l,a.fromToBase=function(i,d,u,g,J){for(var B,D,Y,N=u.$locale().relativeTime||l,V=s.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],de=V.length,S=0;S<de;S+=1){var p=V[S];p.d&&(B=g?c(i).diff(u,p.d,!0):u.diff(i,p.d,!0));var b=(s.rounding||Math.round)(Math.abs(B));if(Y=B>0,b<=p.r||!p.r){b<=1&&S>0&&(p=V[S-1]);var q=N[p.l];J&&(b=J(""+b)),D=typeof q=="string"?q.replace("%d",b):q(b,d,p.l,Y);break}}if(d)return D;var H=Y?N.future:N.past;return typeof H=="function"?H(D):H.replace("%s",D)},a.to=function(i,d){return h(i,d,this,!0)},a.from=function(i,d){return h(i,d,this)};var x=function(i){return i.$u?c.utc():c()};a.toNow=function(i){return this.to(x(this),i)},a.fromNow=function(i){return this.from(x(this),i)}}})})(rt);const lt=$;var ee={},it={get exports(){return ee},set exports(t){ee=t}};(function(t,n){(function(s,r){t.exports=r(Qe)})(K,function(s){function r(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var c=r(s),a={name:"es",monthsShort:"ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),weekStart:1,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:function(l){return l+"º"}};return c.default.locale(a,null,!0),a})})(it);_.extend(at);_.locale("es");_.extend(lt);_.updateLocale("es",{relativeTime:{future:"en %s",past:"hace %s",s:"1 s",m:"1 min",mm:"%d min",h:"1 h",hh:"%d h",d:"1 d",dd:"%d d",M:"1 M",MM:"%d M",y:"1 Y",yy:"%d Y"}});const ot=({date:t})=>e.jsx(j,{align:"left",children:_(t).from(new Date)});function ct(t){const{tags:n,isActive:s,dateSonar:r,ruleTitle:c,ruleDescription:a}=t;return e.jsxs(O,{children:[e.jsxs(m,{padding:2,direction:"column",spacing:2,children:[e.jsxs(m,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:[e.jsx(w,{sx:{backgroundColor:({palette:l})=>l.mode===z.DARK?l.grey[900]:l.grey[800],color:"white"},label:`Regla ${s?"activo":"inactivo"} desde:`}),e.jsx(w,{label:`${r??"Sin info"}`})]}),e.jsx(m,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:n.map(l=>e.jsx(w,{label:l},l))})]}),e.jsx(m,{direction:"row",justifyContent:"flex-start",alignItems:"center",padding:2,pb:0,children:e.jsx(Ye,{title:c,children:e.jsx(w,{color:"secondary",label:e.jsx(j,{noWrap:!0,variant:"h5",children:c})})})}),e.jsxs(m,{direction:"column",justifyContent:"center",padding:2,children:[e.jsx(m,{direction:"row",justifyContent:"flex-start",children:e.jsx(w,{label:"Descripción de la Regla",sx:{backgroundColor:({palette:l})=>l.mode===z.DARK?l.grey[900]:l.grey[800],color:"white"}})}),e.jsx(j,{dangerouslySetInnerHTML:{__html:a}})]})]})}function dt({initialStatus:t,result:n,id:s}){const[r,c]=o.useState(!1),[a,l]=o.useState(t);o.useEffect(()=>{l(t)},[t]),o.useEffect(()=>{F.rulesStatus.get(Number(s)).then(i=>c(!!i))},[s]);const h=n.isActiveSonar!==a,x=o.useCallback(async i=>{l(i.target.checked);const d=await F.rulesStatus.get(Number(s));await F.rulesStatus.put({...d,id:Number(s),newStatus:i.target.checked,updated_at:new Date,languageId:n.lang_id,qualityProfileId:Number(n.qualityProfile_id)}),c(!0)},[s,n.lang_id,n.qualityProfile_id]);return e.jsxs(m,{color:"red",direction:"row",children:[e.jsx(G,{onChange:x,checked:a}),r&&h?e.jsx(xe,{}):""]})}const ut=({resource:t,value:n,result:s,secondaryValue:r})=>t==="isActiveSonar"?e.jsx(j,{children:n?"Activo":"Inactivo"}):t==="htmlDesc"?e.jsx(Ie,{icon:e.jsx(me,{}),popoverBody:e.jsx(ct,{tags:[s.severity,s.type],isActive:s.isActive,ruleTitle:s.name,ruleDescription:s.htmlDesc})}):t==="updated_at"?Math.abs(_(String(n)).diff(r,"hours"))>6?e.jsx(ot,{date:String(n)}):e.jsx(j,{align:"left",children:"--"}):e.jsx(dt,{initialStatus:!!n,result:s,id:s.id}),ht=({colSpan:t})=>e.jsx(v,{colSpan:t,children:e.jsx(O,{display:"grid",sx:{placeContent:"center",minHeight:400},children:e.jsx(U,{})})}),xt=({icon:t,primaryText:n,secondaryText:s})=>e.jsxs(m,{direction:"column",justifyContent:"center",alignItems:"center",minHeight:"50vh",sx:{fontSize:100},gap:8,children:[t,e.jsxs(m,{direction:"column",gap:4,children:[e.jsx(j,{color:"GrayText",variant:"h3",children:n}),s&&e.jsx(j,{textAlign:"center",color:"GrayText",variant:"body1",children:s})]})]}),mt=({hasContent:t,children:n,colSpan:s})=>t?e.jsx(e.Fragment,{children:n}):e.jsx(A,{children:e.jsx(v,{colSpan:s,children:e.jsx(xt,{icon:e.jsx(ge,{color:"disabled",fontSize:"inherit"}),primaryText:"Sin datos",secondaryText:"Selecciona filtros"})})}),gt=({children:t,collapseContent:n,colSpan:s})=>{const[r,c]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(A,{sx:{cursor:"pointer",":hover":{backgroundColor:({palette:a})=>a.grey[400]}},onClick:()=>{c(a=>!a)},children:t}),e.jsx(A,{children:e.jsx(v,{colSpan:s,padding:r?"normal":"none",children:e.jsx(Ve,{in:r,sx:{"& .MuiCollapse-wrapperInner":{display:"flex"}},children:n})})})]})},jt=({title:t,result:n})=>{const s=Ge(async({target:r})=>await F.saveDescription(n,r.value),500);return e.jsx(qe,{multiline:!0,fullWidth:!0,sx:{ml:12,mr:3,minHeight:"initial",height:"auto"},defaultValue:n.description,title:t,placeholder:"Ingresa el porqué del cambio",onChange:s})};function pt(){const[t,n,{data:s,isLoading:r,total:c,page:a,rowsPerPage:l}]=ke(),h=o.useCallback((i,d)=>{i&&t(d+1)},[t]),x=o.useCallback(i=>{n(parseInt(i.target.value,10)),t(1)},[t,n]);return e.jsxs(e.Fragment,{children:[e.jsx(We,{body:r?e.jsx(ht,{colSpan:k.length}):e.jsx(mt,{hasContent:!!(s!=null&&s.length),colSpan:k.length,children:r?[]:s==null?void 0:s.map(i=>e.jsx(gt,{colSpan:k.length,collapseContent:e.jsx(jt,{result:i,title:`${i.id}-comments`}),children:k.map(({resource:d,especialConfig:u,textAlign:g})=>u?e.jsx(v,{sx:{textAlign:"center"},children:e.jsx(ut,{result:i,resource:d,secondaryValue:i.created_at,value:i[d]??"--"})},d+i.id):e.jsx(v,{sx:{textAlign:g??"center"},children:String(i[d]??"--")},d+i.id))},i.id))}),header:e.jsx(st,{data:k})}),e.jsx(O,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(Ne,{rowsPerPage:l,count:c??1e3,page:a-1,onPageChange:h,onRowsPerPageChange:x,labelRowsPerPage:"Filas por página"})})]})}const ft=({content:t})=>e.jsx("div",{style:{position:"sticky",bottom:20,left:20,display:"flex",justifyContent:"flex-end",zIndex:500},children:t}),bt=({handleClose:t,isOpen:n})=>{const[s,r]=o.useState(!1),c=o.useRef(),a=o.useRef(),l=o.useRef(),h=()=>{r(!s)},x=u=>{c.current=u.target.value},i=u=>{a.current=u.target.value},d=u=>{l.current=u.target.value};return e.jsxs(He,{variant:"persistent",onClose:t,anchor:"right",open:n,sx:{minWidth:300},children:[e.jsx(y,{children:e.jsx(C,{children:e.jsx(Z,{control:e.jsx(G,{onClick:h}),label:"Filtros"})})}),e.jsx(I,{}),e.jsx(y,{children:e.jsx(C,{children:e.jsxs(M,{sx:{width:200},className:"type",onChange:x,children:[e.jsx(T,{id:"type",children:"Type"}),e.jsx(L,{labelId:"type",label:"Type",sx:{width:200},defaultValue:"",disabled:!s,displayEmpty:!0,children:R==null?void 0:R.map(({value:u,label:g})=>e.jsx(f,{value:u,children:u},g))})]})})}),e.jsx(I,{}),e.jsx(y,{children:e.jsx(C,{children:e.jsxs(M,{sx:{width:200},className:"severity",onChange:i,children:[e.jsx(T,{id:"severity",children:"Severity"}),e.jsx(L,{labelId:"severity",label:"Severity",sx:{width:200},defaultValue:"",disabled:!s,displayEmpty:!0,children:P==null?void 0:P.map(({value:u,label:g})=>e.jsx(f,{value:u,children:u},g))})]})})}),e.jsx(I,{}),e.jsx(y,{children:e.jsx(C,{children:e.jsxs(M,{sx:{width:200},className:"state",onChange:d,children:[e.jsx(T,{id:"state",children:"State"}),e.jsx(L,{labelId:"state",label:"State",sx:{width:200},defaultValue:"",disabled:!s,displayEmpty:!0,children:E==null?void 0:E.map(({value:u,label:g})=>e.jsx(f,{value:u,children:u},g))})]})})}),e.jsx(I,{}),e.jsx(y,{children:e.jsx(C,{children:e.jsx(Z,{control:e.jsx(G,{}),label:"Solo diferencias"})})}),e.jsx(I,{}),e.jsx(y,{children:e.jsx(C,{children:e.jsx(ze,{variant:"contained",startIcon:e.jsx(te,{}),sx:{width:200},children:"Download"})})})]})},yt=()=>{const[t,n]=o.useState(!1),s=o.useCallback(()=>{n(!0)},[]),r=o.useCallback(()=>{n(!1)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(f,{onClick:s,children:[e.jsx(le,{children:e.jsx(te,{})}),e.jsx(ie,{children:"Descarga Personalizada"})]}),e.jsx(bt,{handleClose:r,isOpen:t})]})},Ct=()=>{const[t]=Me();return e.jsxs(f,{onClick:t,children:[e.jsx(le,{children:e.jsx(je,{fontSize:"small"})}),e.jsx(ie,{children:"Restaurar"})]})},vt=()=>{const[t,n]=o.useState(null),s=o.useRef(null),r=Te(),c=o.useCallback(()=>{n(null)},[]);o.useEffect(()=>{n(r?s.current:null)},[r]);const a=o.useCallback(({currentTarget:l})=>{n(l)},[]);return e.jsxs(e.Fragment,{children:[e.jsx($e,{children:e.jsx(ae,{ref:s,onClick:a,sx:{background:({palette:l})=>l.secondary.main,zIndex:500},className:"dragableMenu",children:e.jsx(pe,{fontSize:"large"})})}),e.jsxs(re,{className:"menuDragable",anchorEl:t,open:!!t,onClose:c,children:[e.jsx(Le,{}),e.jsx(yt,{}),e.jsx(Ct,{})]})]})};function qt(){return e.jsxs(e.Fragment,{children:[e.jsxs(m,{gap:3,children:[e.jsxs(j,{children:[e.jsx(fe,{})," Activa o desactiva los switches dependiendo si deseas habilitar la regla o no"]}),e.jsxs(j,{children:[e.jsx(be,{})," Recuerda que los estados que propongas no se aplicarán de inmediato en SonarQube"]})]}),e.jsx(m,{direction:"column",gap:4,marginTop:4,children:e.jsxs(O,{display:"flex",gap:4,children:[e.jsx(Ke,{}),e.jsx(Ue,{}),e.jsx(ye,{})]})}),e.jsx(pt,{}),e.jsx(ft,{content:e.jsx(vt,{})})]})}export{qt as default};
