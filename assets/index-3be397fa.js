var ge=Object.defineProperty;var pe=(o,e,t)=>e in o?ge(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var d=(o,e,t)=>(pe(o,typeof e!="symbol"?e+"":e,t),t);import{A as X,j as s,a2 as me,a3 as fe,a4 as ye,a5 as xe,a6 as we,a7 as je,a8 as Ce,a9 as be}from"./@mui/icons-material-c62336cc.js";import{a as ve,r as i,b as ke}from"./vendor-b612640b.js";import{c as G,_ as Se}from"./@supabase/supabase-js-711ba96a.js";import{u as Y,T as Ie,C as Pe,I as V,B as S,P as Oe,a as I,M as Ee,L as Re,b as Te,c as Fe,d as y,e as Ae,f as Le,S as k,g as Me,h as _e,i as ee,A as Be,j as H,k as qe,l as De,F as te,m as se,O as ne,n as Ne,o as Qe,p as ze,q as Ue}from"./@mui/material-b56fe79a.js";import{$ as Ve}from"./dexie-3976de5d.js";import{d as $e}from"./dexie-react-hooks-0c2ddb12.js";import{a as Ge}from"./axios-760d4776.js";import{c as g}from"./@react-rxjs/utils-24ca515a.js";import{b as p}from"./@react-rxjs/core-1a0bb4f0.js";import{Q as He,u as re,a as Ke}from"./@tanstack/react-query-7cfe65c4.js";import{u as We}from"./react-hook-form-c6612ec3.js";import{T as Je}from"./@reactour/tour-e24be7d6.js";import{h as Ze}from"./hotkeys-js-d20e5801.js";import"./@emotion/react-0d101b94.js";import"./@emotion/styled-6b07d811.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();var $={},Z=ve;$.createRoot=Z.createRoot,$.hydrateRoot=Z.hydrateRoot;var ae=(o=>(o.DARK="dark",o.LIGTH="light",o))(ae||{});const oe={fontFamily:["Foco"].join(",")},Xe=X({palette:{mode:"dark"},typography:{...oe}}),Ye=X({palette:{mode:"light",primary:{main:"#0099CC"},secondary:{main:"#EE2C70"}},typography:{...oe}}),ie=i.createContext({toggleColorMode(){}}),et=({app:o})=>{const e=Y("(prefers-color-scheme: dark)"),[t,r]=i.useState(localStorage.getItem("mode")||(e?"light":"dark")),n=i.useMemo(()=>({toggleColorMode(){r(a=>a==="dark"?"light":"dark")}}),[]);return i.useEffect(()=>{localStorage.setItem("mode",t)},[t]),s.jsx(ie.Provider,{value:n,children:s.jsxs(Ie,{theme:t==="dark"?Xe:Ye,children:[s.jsx(Pe,{}),o]})})},j=class extends Ve{constructor(){super("syncro");d(this,"rulesStatus");this.version(3).stores({rulesStatus:"id, updated_at, newStatus, language, qualityProfileId, description"})}static getInstance(){return j.instance??(j.instance=new j),j.instance}async getLocalRules(t){return await this.rulesStatus.where("id").anyOf(t).toArray()}async countAllRules(){return await this.rulesStatus.count()}async saveDescription(t,r){const n=await this.rulesStatus.get(t.id);return await this.rulesStatus.put({id:Number(t.id),languageId:t.lang_id,newStatus:t.isActive,qualityProfileId:Number(t.qualityProfile_id),...n,updated_at:new Date,description:r})}};let F=j;d(F,"instance");const O=F.getInstance(),tt={width:"80vh",maxWidth:600,minWidth:400,height:"80vh",minHeight:400,borderRadius:50},st=i.memo(function({popoverBody:o,icon:e,sxProps:t,textButton:r,buttonProps:n}){const[a,c]=i.useState(null),u=i.useCallback(x=>{x.stopPropagation(),c(x.currentTarget)},[]),E=i.useCallback(x=>{x.stopPropagation(),c(null)},[]);return s.jsxs(s.Fragment,{children:[r?s.jsx(S,{startIcon:e,onClick:u,...n,children:r}):s.jsx(V,{onClick:u,sx:{margin:"auto"},children:e}),s.jsxs(Oe,{anchorOrigin:{vertical:"center",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:t??tt,open:!!a,onClose:E,anchorEl:a,children:[s.jsx(V,{onClick:E,sx:{position:"absolute",top:0,right:0},children:s.jsx(me,{sx:{fontSize:"medium"}})}),s.jsx(I,{margin:1,children:o})]})]})}),ce=o=>{const e={VITE_SUPABASE_TOKEN:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZueGZtZnNmdGR3aGlhaGxnb3pnIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODE5NTQ2MjIsImV4cCI6MTk5NzUzMDYyMn0.2-lbg4bjMgp6MxaHUpHd1qTIHoydHr0uXAi78MZ06h4",VITE_WOOPRA_DOMAIN:"pacifico.dev.com",VITE_SUPABASE_URL:"https://fnxfmfsftdwhiahlgozg.supabase.co",VITE_TYPE_CLIENT:"supabase",BASE_URL:"/rulesAdmin",MODE:"production",DEV:!1,PROD:!0,SSR:!1}[o];if(!e)throw new Error(`Not found env ${o}`);return e},D=ce("VITE_SUPABASE_TOKEN"),N=ce("VITE_SUPABASE_URL"),nt="supabase",C=class{constructor(e){this.client=e}getByRuleName(e,t,r){throw new Error("Method not implemented.")}downloadReport(e){throw new Error("Method not implemented.")}postNewStatus(e){throw new Error("Method not implemented.")}async getTotalCountByTable(e){return 100}static getInstance(){return C.instance??(C.instance=new C(Ge.create({baseURL:N,headers:{apiKey:D}}))),C.instance}async getPaginatedRulesByFilter(e,t){const{data:r}=await this.client.get("/rules",{params:{...e,...t}});return{data:r,count:100}}async getQualityProfilesByLanguage(e){const{data:t}=await this.client.get("/qualityprofiles",{params:{language_id:e}});return t}async getAllLanguages(){const{data:e}=await this.client.get("/languages");return e}};let A=C;d(A,"instance");const rt=A.getInstance,h=class{constructor(e){this.client=e}async getCSVReportUpdatables(e){return await this.client.rpc("get_changed_q",{quality_id:Number(e)}).select("*").csv().throwOnError()}async getCSVCompletFiltered(e){return await this.prepareFilteredQuery(e).csv().throwOnError()}async downloadReport(e,t=!0){const{data:r}=t?await this.getCSVReportUpdatables(Number(e.qualityProfile_id)):await this.getCSVCompletFiltered(e),n=document.createElement("a");n.download="report";const a=URL.createObjectURL(new Blob([r],{type:"text/csv"}));n.href=a,n.click(),URL.revokeObjectURL(a),n.remove()}changeIsActive(e,t=!0){if(e.length)return this.client.from("status").update({isActive:t,updated_at:new Date}).in("id",e.map(({id:r})=>r)).throwOnError()}async bulkUpdateDescription(e){if(e.length)return await this.client.from("status").upsert(e.map(({id:t,description:r,qualityProfileId:n})=>({id:t,description:r,qualityProfile_id:n}))).select().throwOnError()}async postNewStatus(e){const t=e.filter(({newStatus:a})=>!a),r=e.filter(({newStatus:a})=>a),n=e.filter(({description:a})=>!!a);await Promise.all([this.changeIsActive(t,!1),this.changeIsActive(r,!0),this.bulkUpdateDescription(n)])}async getTotalCountByTable(e){const{count:t}=await this.client.from(e).select("*",{count:"exact",head:!0}).throwOnError();return t??0}async getQualityProfilesByLanguage(e){const{data:t}=await this.client.from("qualityprofiles").select().eq("language_id",e).throwOnError();return t}buildQuery(e,t){for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const n=t[r];n!=="all"&&n!=null&&(e=e.eq(h.queryBuilderColumns[r],n))}return e}prepareFilteredQuery(e){delete e.lang_id;const t=this.client.from("status").select(`
        *,
        qualityprofiles(
          *
        ),
        rules!inner(
          *
        )
      `,{count:"exact"});return this.buildQuery(t,e)}async getPaginatedRulesByFilter(e,t){const r=this.prepareFilteredQuery(e),{data:n,count:a}=await r.range(...this.getRange(t)).order("id",{ascending:!0}).throwOnError();return{data:n,count:a}}async getAllLanguages(){const{data:e}=await this.client.from("languages").select().throwOnError();return e.filter(({name:t})=>h.whiteList[t])}static getInstance(e){return h.instance??(h.instance=new h(e??G(N,D))),h.instance}getRange({page:e,limit:t=10}){return[(e-1)*t,e*t-1]}async getByRuleName(e,t,r){const{data:n,count:a}=await this.prepareFilteredQuery(t).ilike("rules.name",`%${e}%`).range(...this.getRange(r)).order("id",{ascending:!0}).throwOnError();return{data:n,count:a}}};let v=h;d(v,"instance"),d(v,"whiteList",{ts:!0,js:!0,css:!0,java:!0,web:!0}),d(v,"queryBuilderColumns",{severity:"rules.severity",type:"rules.type",isActiveSonar:"isActiveSonar",qualityProfile_id:"qualityProfile_id"});const at=v.getInstance,le=G(N,D),ot={axios:rt,supabase:()=>at(le)},B=ot[nt](),[it,ts]=g(),[ct]=p(it,""),[lt,ss]=g(),[ut]=p(lt,"all"),[dt,ns]=g(),[ht]=p(dt,null),[gt,rs]=g(),[pt]=p(gt,"all"),[mt,as]=g(),[ft]=p(mt,""),[yt,xt]=g();p(yt,0);const[wt,q]=g(),[jt]=p(wt,1),[Ct,bt]=g(),[os]=p(Ct,!1),[vt,is]=g(),[kt]=p(vt,null),K=new He({defaultOptions:{queries:{staleTime:1/0,refetchOnMount:!1,refetchOnWindowFocus:!1,_optimisticResults:"optimistic"}}}),f=class{constructor(){if(f.instance)throw new Error("Singleton")}static getInstance(){return f.instance??(f.instance=new f),f.instance}get tokenData(){return{token:localStorage.getItem("token"),refreshToken:localStorage.getItem("refreshToken")}}set tokenData(e){Object.keys(e).forEach(t=>localStorage.setItem(t,e[t]))}};let L=f;d(L,"instance");const b=class{constructor(e,t=L.getInstance()){d(this,"isLogged");this.client=e,this.authStorage=t}static getInstance(e){return b.instance??(b.instance=new b(e??G(N,D).auth)),b.instance}setToken(e){this.authStorage.tokenData={refreshToken:e.refresh_token,token:e.access_token}}async login(e,t){const{data:r,error:n}=await this.client.signInWithPassword({email:e,password:t});if(n)throw n;return this.setToken(r.session),this.isLogged=!0,r}async verifyAuth(e){const{data:t,error:r}=await this.client.getUser(e);if(r)throw r;return t}async logOut(e){const{error:t}=await this.client.signOut();if(t)throw t;return e}async getPermissions(){const{data:e,error:t}=await this.client.mfa.getAuthenticatorAssuranceLevel();if(t)throw t;return e}async checkAuth(e,t){const r=e??this.authStorage.tokenData.token,n=t??this.authStorage.tokenData.refreshToken;if(!r||!n)return;const{data:a,error:c}=await this.client.setSession({access_token:r,refresh_token:n});if(c)throw c;return this.setToken(a.session),this.isLogged=!0,a}};let M=b;d(M,"instance");const _=M.getInstance(le.auth),Q=i.createContext(_),cs=()=>{const o=pt(),e=ct(),t=ht(),r=ft(),n=ut(),a=jt(),c=kt(),[u,E]=i.useState(10),x=i.useRef(0),[ue,de]=i.useState([]),z=!!(e&&r),{data:P,isFetching:he}=re({queryKey:["rules",e,r,n,t,o,a,u,c],async queryFn(){const m={severity:o,lang_id:e,isActiveSonar:t,qualityProfile_id:r,type:n},U={page:a,limit:u},{data:R,count:T}=c?await B.getByRuleName(c,m,U):await B.getPaginatedRulesByFilter(m,U);return x.current=T,xt(T),R},enabled:z,keepPreviousData:!0});i.useEffect(()=>{q(1)},[n,o,t,r,c]);const W=i.useCallback(async()=>{if(!z)return;const m=P==null?void 0:P.map(({rules:l,...w})=>({...l,...w})),R=(m?await O.getLocalRules(m.map(({id:l})=>Number(l))):[]).reduce((l,w)=>(l[w.id]=w,l),{}),T=m==null?void 0:m.map(l=>{var w,J;return{...l,isActive:((w=R[l.id])==null?void 0:w.newStatus)??l.isActive,description:((J=R[l.id])==null?void 0:J.description)??l.description}});de(T)},[P,z]);return i.useEffect(()=>{W()},[P,a,W]),[q,E,{data:ue,isLoading:he,total:x.current,page:a,rowsPerPage:u}]},St=()=>{const[o,e]=i.useState(!1);return[i.useCallback(async()=>{e(!0);const r=await O.rulesStatus.toArray();await B.postNewStatus(r),await O.rulesStatus.clear(),await K.invalidateQueries({queryKey:["rules"]}),q(1),e(!1)},[]),o]},ls=()=>{const[o,e]=i.useState(!1);return[i.useCallback(async()=>{e(!0),await O.rulesStatus.clear(),await K.invalidateQueries({queryKey:["rules"]}),q(1),e(!1)},[]),o]},It={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,pt:2,px:4,pb:3},Pt=()=>{const[o]=St(),[e,t]=i.useState(!1),r=()=>{t(!0)},n=()=>{t(!1)},a=()=>{o(),n()};return s.jsxs(s.Fragment,{children:[s.jsxs(Ee,{onClick:r,children:[s.jsx(Re,{children:s.jsx(fe,{fontSize:"small"})}),s.jsx(Te,{children:"Sincronizar"})]}),s.jsx(Fe,{open:e,onClose:n,"aria-labelledby":"child-modal-title","aria-describedby":"child-modal-description",children:s.jsxs(I,{sx:{...It,width:350},children:[s.jsx(y,{variant:"h6",children:"Confirmar sincronización"}),s.jsx(y,{children:"¿Estás seguro de que deseas sincronizar los datos?"}),s.jsx(S,{onClick:n,color:"primary",children:"Cancelar"}),s.jsx(S,{onClick:a,color:"primary",autoFocus:!0,children:"Sincronizar"})]})})]})},Ot=()=>{var r;const o=$e.useLiveQuery(()=>O.rulesStatus.toArray()),{data:e}=re({queryKey:["languages"],queryFn:()=>B.getAllLanguages()}),t=i.useMemo(()=>e==null?void 0:e.reduce((n,{id:a,name:c})=>(n[a]=c,n),{}),[e]);return s.jsx(st,{icon:o!=null&&o.length?s.jsx(ye,{color:"warning"}):s.jsx(xe,{color:"success"}),textButton:s.jsx(y,{children:o!=null&&o.length?"Tienes cambios sin sincronizar":"No hay cambios sin sincronizar"}),buttonProps:{variant:"contained"},popoverBody:s.jsx(Ae,{children:e&&s.jsxs(Le,{children:[(r=o==null?void 0:o.filter(({languageId:n},a,c)=>c.findIndex(({languageId:u})=>u===n)===a))==null?void 0:r.map(({languageId:n},a)=>s.jsx(k,{direction:"row",children:s.jsx(Me,{label:t[n]})},a)),s.jsx(_e,{children:s.jsx(Pt,{})})]})})})},Et=()=>{const{palette:o}=ee(),e=i.useContext(ie),{isLogged:t}=i.useContext(Q),r=i.useCallback(()=>{e.toggleColorMode()},[e]);return s.jsx(Be,{sx:{background:({palette:n})=>`linear-gradient(90deg, ${n.primary.main} 80%, ${n.secondary.main} 100%)`},children:s.jsx(H,{children:s.jsxs(qe,{disableGutters:!0,sx:{justifyContent:"space-between"},children:[s.jsxs(I,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:[s.jsx(y,{variant:"h6",fontWeight:900,children:"Sonardash"}),s.jsx(y,{variant:"body1",children:"/ Gestión de Reglas"})]}),t&&s.jsx(Ot,{}),s.jsxs(k,{direction:"row",justifyContent:"center",alignItems:"center",children:[(o==null?void 0:o.mode)===ae.DARK?s.jsx(we,{}):s.jsx(je,{}),s.jsx(De,{color:"warning",onChange:r}),s.jsx("img",{src:"https://www.pacifico.com.pe/image/layout_set_logo?img_id=86311733&t=1683695027672",alt:"logo de pacifico seguros"})]})]})})})},Rt="/rulesAdmin/admin.svg",Tt=({inputProps:o,disabled:e})=>{const[t,r]=i.useState(!1),n=i.useCallback(()=>{r(a=>!a)},[]);return s.jsxs(te,{disabled:e,children:[s.jsx(se,{htmlFor:"password",children:"Password"}),s.jsx(ne,{id:"password",type:t?"text":"password",inputProps:o,endAdornment:s.jsx(Ne,{position:"end",children:s.jsx(V,{"aria-label":"toggle password visibility",onMouseDown:a=>a.preventDefault(),edge:"end",onClick:n,children:t?s.jsx(Ce,{}):s.jsx(be,{})})}),label:"Password"})]})};function Ft(){const{handleSubmit:o,register:e}=We(),t=i.useContext(Q),[r,n]=i.useState(!1),a=i.useCallback(async({email:c,password:u})=>{n(!0),await t.login(c,u),n(!1)},[t]);return s.jsxs(k,{component:"form",onSubmit:o(a),spacing:2,p:2,children:[s.jsxs(te,{disabled:r,children:[s.jsx(se,{htmlFor:"email",children:"Email"}),s.jsx(ne,{id:"email",inputProps:e("email")})]}),s.jsx(Tt,{disabled:r,inputProps:e("password")}),r?s.jsx(I,{display:"flex",justifyContent:"center",children:s.jsx(Qe,{})}):s.jsx(S,{type:"submit",variant:"contained",children:"Login"})]})}const At=()=>{const[o,e]=i.useState(!1),t=ee(),r=Y(t.breakpoints.up("md")),n=i.useCallback(()=>{e(!0)},[]),a=i.useCallback(()=>{e(!1)},[]);return s.jsxs(s.Fragment,{children:[s.jsxs(k,{direction:"row",height:"80vh",spacing:2,gap:2,alignItems:"center",justifyContent:"center",children:[s.jsx(I,{sx:{width:{xs:"0%",md:"50%"},display:{xs:"none",md:"block"}},children:s.jsx("img",{style:{width:"100%"},src:Rt,alt:"admin configuring panel"})}),s.jsxs(k,{spacing:1,width:{sm:"100%",md:"50%"},children:[s.jsx(y,{variant:"h3",component:"h1",children:"Ace config and simplify SonarQube rule administration"}),s.jsx(y,{variant:"body1",children:"Effortlessly Customize SonarQube Rules for Optimal Code Quality"}),s.jsxs(k,{spacing:2,direction:{sm:"column",md:"row"},children:[s.jsx(S,{variant:"contained",children:"Sing up"}),s.jsx(S,{variant:"outlined",onClick:n,children:"Log in"})]})]})]}),s.jsx(ze,{PaperProps:{sx:{justifyContent:"center"}},onOpen:n,onClose:a,open:o,anchor:r?"right":"bottom",children:s.jsx(H,{sx:{maxWidth:500,width:{md:"50vw"},minHeight:"50vh",display:"grid",placeContent:"center"},children:s.jsx(Ft,{})})})]})},Lt=()=>s.jsx(I,{width:"100%",sx:{display:"grid",placeContent:"center"},children:s.jsx(Ue,{animation:"pulse",variant:"rectangular",width:"80vw",height:"50vh"})}),Mt=i.lazy(()=>Se(()=>import("./AdminPanel-f72e4617.js"),["assets/AdminPanel-f72e4617.js","assets/@mui/icons-material-c62336cc.js","assets/vendor-b612640b.js","assets/@emotion/react-0d101b94.js","assets/@emotion/styled-6b07d811.js","assets/@reactour/tour-e24be7d6.js","assets/@tanstack/react-query-7cfe65c4.js","assets/@react-rxjs/core-1a0bb4f0.js","assets/@react-rxjs/utils-24ca515a.js","assets/@mui/material-b56fe79a.js","assets/use-debounce-b0ac4a1c.js","assets/dayjs-c0cd33fe.js","assets/react-draggable-fc23873a.js","assets/@supabase/supabase-js-711ba96a.js","assets/dexie-3976de5d.js","assets/dexie-react-hooks-0c2ddb12.js","assets/axios-760d4776.js","assets/react-hook-form-c6612ec3.js","assets/hotkeys-js-d20e5801.js"]));function _t(){const{isLogged:o}=i.useContext(Q);return s.jsx(et,{app:s.jsxs(s.Fragment,{children:[s.jsx(Et,{}),s.jsx(H,{sx:{paddingTop:12,minHeight:"100vh"},children:o?s.jsx(i.Suspense,{fallback:s.jsx(Lt,{}),children:s.jsx(Mt,{})}):s.jsx(At,{})})]})})}const Bt="pacifico.dev.com",qt=({children:o})=>{const[e,t]=i.useState(!1);i.useEffect(()=>{_.checkAuth().then(n=>{var a;return t(!!((a=n==null?void 0:n.user)!=null&&a.id))})},[]);const r=i.useMemo(()=>({isLogged:e,async login(n,a){const c=await _.login(n,a);return t(!0),c},async checkAuth(n,a){return await _.checkAuth(n,a)}}),[e]);return s.jsx(Q.Provider,{value:r,children:o})};Ze("ctrl+m",o=>{o.preventDefault(),bt(!0)});window.woopra.config({domain:Bt,outgoing_tracking:!0,download_tracking:!0,click_tracking:!0}),window.woopra.track();$.createRoot(document.getElementById("root")).render(s.jsx(ke.StrictMode,{children:s.jsx(Je,{steps:[{selector:".language",content:"Selecciona el lenguaje de programación del cual deseas consultar reglas."},{selector:".mainFilters",content:"Ahora procede a seleccionar el perfil a consultar"},{selector:".actualState",content:"Este es el estado actual de la regla en Sonarqube. Las reglas activas son las que analizan los repositorios."},{selector:".proposedState",content:"Aquí podrás proponer si una regla debe estar activada o desactivada, recuerda que tu propuesta no se verá reflejada en SonarQube inmediatamente."},{selector:".dragableMenu",content:s.jsxs(y,{children:["Las opciones de descarga y guardado se encuentran en este botón. Si no lo encuentras rápido, ubícalo con ",s.jsx("kbd",{children:"ctrl"})," +"," ",s.jsx("kbd",{children:"m"}),", ¡también lo puedes mover por toda la pantalla!"]})}],children:s.jsx(qt,{children:s.jsx(Ke,{client:K,children:s.jsx(_t,{})})})})}));export{ae as C,Pt as S,as as a,ns as b,rs as c,ss as d,O as e,B as f,cs as g,ls as h,os as i,st as m,ts as s,ct as u};
