var Ee=Object.defineProperty;var Ae=(n,t,s)=>t in n?Ee(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var T=(n,t,s)=>(Ae(n,typeof t!="symbol"?t+"":t,s),s);import{j as e,A as ue,a0 as Le,a1 as Fe,a2 as Oe,a3 as De,a4 as Be,a5 as qe,a6 as Ne,a7 as $e,a8 as ze,a9 as Qe,aa as Ve,ab as Ye,ac as Ue,ad as He,ae as Ge}from"./@mui/icons-material-2e3cd2f8.js";import{a as Ke,r as l,d as ee,b as We}from"./vendor-b612640b.js";import{c as v}from"./@react-rxjs/utils-24ca515a.js";import{b as w}from"./@react-rxjs/core-1a0bb4f0.js";import{a as Je}from"./axios-760d4776.js";import{c as Ze}from"./@supabase/supabase-js-f1992ef7.js";import{u as H,Q as Xe,a as et}from"./@tanstack/react-query-7cfe65c4.js";import{C as te,F as de,I as he,S as ge,M as A,u as tt,T as nt,a as st,P as at,b as rt,c as ot,d as it,e as lt,f as ct,g as Y,B as ut,h as ne,i as U,j as B,k as m,l as f,m as L,n as O,o as dt,p as ht,q as gt,r as pe,s as pt,t as mt,L as me,v as fe,w as ft,x as xt,y as yt,z as jt,A as Ct,D as xe,E as bt,G as vt}from"./@mui/material-9988e97e.js";import{u as wt,T as St}from"./@reactour/tour-e24be7d6.js";import{c as _t,o as kt}from"./use-debounce-6bf2a1da.js";import{$ as Mt}from"./dexie-3976de5d.js";import{d as It,a as q}from"./dayjs-c0cd33fe.js";import{d as Rt}from"./dexie-react-hooks-0c2ddb12.js";import{c as Tt}from"./react-draggable-fdf0e62d.js";import{h as Pt}from"./hotkeys-js-d20e5801.js";import"./@emotion/react-0d101b94.js";import"./@emotion/styled-6b07d811.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();var W={},oe=Ke;W.createRoot=oe.createRoot,W.hydrateRoot=oe.hydrateRoot;const[Et,At]=v(),[se]=w(Et,""),[Lt,Ft]=v(),[ye]=w(Lt,"all"),[Ot,Dt]=v(),[je]=w(Ot,null),[Bt,qt]=v(),[Ce]=w(Bt,"all"),[Nt,ie]=v(),[ae]=w(Nt,""),[$t,zt]=v();w($t,0);const[Qt,J]=v(),[Vt]=w(Qt,1),[Yt,Ut]=v(),[Ht]=w(Yt,!1),[Gt,le]=v(),[Kt]=w(Gt,null),be=n=>{const t={VITE_SUPABASE_TOKEN:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZueGZtZnNmdGR3aGlhaGxnb3pnIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODE5NTQ2MjIsImV4cCI6MTk5NzUzMDYyMn0.2-lbg4bjMgp6MxaHUpHd1qTIHoydHr0uXAi78MZ06h4",VITE_WOOPRA_DOMAIN:"pacifico.dev.com",VITE_SUPABASE_URL:"https://fnxfmfsftdwhiahlgozg.supabase.co",VITE_TYPE_CLIENT:"supabase",BASE_URL:"/rulesAdmin",MODE:"production",DEV:!1,PROD:!0,SSR:!1}[n];if(!t)throw new Error(`Not found env ${n}`);return t},ve=be("VITE_SUPABASE_TOKEN"),we=be("VITE_SUPABASE_URL"),Wt="supabase",P=class{constructor(t){this.client=t}getByRuleName(t,s,r){throw new Error("Method not implemented.")}downloadReport(t){throw new Error("Method not implemented.")}postNewStatus(t){throw new Error("Method not implemented.")}async getTotalCountByTable(t){return 100}static getInstance(){return P.instance??(P.instance=new P(Je.create({baseURL:we,headers:{apiKey:ve}}))),P.instance}async getPaginatedRulesByFilter(t,s){const{data:r}=await this.client.get("/rules",{params:{...t,...s}});return{data:r,count:100}}async getQualityProfilesByLanguage(t){const{data:s}=await this.client.get("/qualityprofiles",{params:{language_id:t}});return s}async getAllLanguages(){const{data:t}=await this.client.get("/languages");return t}};let Q=P;T(Q,"instance");const Jt=Q.getInstance,b=class{constructor(t){this.client=t}async getCSVReportUpdatables(t){return await this.client.rpc("get_changed_q",{quality_id:Number(t)}).select("*").csv().throwOnError()}async getCSVCompletFiltered(t){return await this.prepareFilteredQuery(t).csv().throwOnError()}async downloadReport(t,s=!0){const{data:r}=s?await this.getCSVReportUpdatables(Number(t.qualityProfile_id)):await this.getCSVCompletFiltered(t),o=document.createElement("a");o.download="report";const a=URL.createObjectURL(new Blob([r],{type:"text/csv"}));o.href=a,o.click(),URL.revokeObjectURL(a),o.remove()}changeIsActive(t,s=!0){if(t.length)return this.client.from("status").update({isActive:s,updated_at:new Date}).in("id",t.map(({id:r})=>r)).throwOnError()}async bulkUpdateDescription(t){if(t.length)return await this.client.from("status").upsert(t.map(({id:s,description:r,qualityProfileId:o})=>({id:s,description:r,qualityProfile_id:o}))).select().throwOnError()}async postNewStatus(t){const s=t.filter(({newStatus:a})=>!a),r=t.filter(({newStatus:a})=>a),o=t.filter(({description:a})=>!!a);await Promise.all([this.changeIsActive(s,!1),this.changeIsActive(r,!0),this.bulkUpdateDescription(o)])}async getTotalCountByTable(t){const{count:s}=await this.client.from(t).select("*",{count:"exact",head:!0}).throwOnError();return s??0}async getQualityProfilesByLanguage(t){const{data:s}=await this.client.from("qualityprofiles").select().eq("language_id",t).throwOnError();return s}buildQuery(t,s){for(const r in s){if(!Object.prototype.hasOwnProperty.call(s,r))continue;const o=s[r];o!=="all"&&o!=null&&(t=t.eq(b.queryBuilderColumns[r],o))}return t}prepareFilteredQuery(t){delete t.lang_id;const s=this.client.from("status").select(`
        *,
        qualityprofiles(
          *
        ),
        rules!inner(
          *
        )
      `,{count:"exact"});return this.buildQuery(s,t)}async getPaginatedRulesByFilter(t,s){const r=this.prepareFilteredQuery(t),{data:o,count:a}=await r.range(...this.getRange(s)).order("id",{ascending:!0}).throwOnError();return{data:o,count:a}}async getAllLanguages(){const{data:t}=await this.client.from("languages").select().throwOnError();return t.filter(({name:s})=>b.whiteList[s])}static getInstance(){return b.instance??(b.instance=new b(Ze(we,ve))),b.instance}getRange({page:t,limit:s=10}){return[(t-1)*s,t*s-1]}async getByRuleName(t,s,r){const{data:o,count:a}=await this.prepareFilteredQuery(s).ilike("rules.name",`%${t}%`).range(...this.getRange(r)).order("id",{ascending:!0}).throwOnError();return{data:o,count:a}}};let D=b;T(D,"instance"),T(D,"whiteList",{ts:!0,js:!0,css:!0,java:!0,web:!0}),T(D,"queryBuilderColumns",{severity:"rules.severity",type:"rules.type",isActiveSonar:"isActiveSonar",qualityProfile_id:"qualityProfile_id"});const Zt=D.getInstance,Xt={axios:Jt,supabase:Zt},M=Xt[Wt](),en=()=>{const n=se(),t=l.useRef(null),{data:s,isFetching:r}=H({queryKey:["qualityprofile",n],queryFn:()=>M.getQualityProfilesByLanguage(n),enabled:!!n});l.useEffect(()=>{var a;ie(((a=t.current)==null?void 0:a.value)??"")},[n]);const o=l.useCallback(a=>{ie(a.target.value)},[]);return r?e.jsx(te,{}):e.jsxs(de,{className:"mainFilters",sx:{width:200},children:[e.jsx(he,{id:"qualityprofile",children:"Quality Profile"}),e.jsx(ge,{ref:t,onChange:o,label:"Quality Profile",labelId:"qualityprofile",defaultValue:"",displayEmpty:!0,children:s==null?void 0:s.map(({id:a,name:i})=>e.jsx(A,{value:a,children:i},a))})]})},tn=()=>{const{setIsOpen:n,isOpen:t}=wt(),{data:s,isLoading:r}=H({queryKey:["languages"],queryFn:()=>M.getAllLanguages()}),o=l.useCallback(a=>{At(a.target.value)},[]);return l.useEffect(()=>{localStorage.getItem("firstVisit")||(localStorage.setItem("firstVisit",new Date().toDateString()),n(!0))},[n]),l.useEffect(()=>{const a=document.querySelector("body");t?a.style.overflow="hidden":a.style.overflow="auto"},[t]),e.jsx(de,{sx:{width:200},className:"language",children:r?e.jsx(te,{}):e.jsxs(e.Fragment,{children:[e.jsx(he,{id:"language",children:"Lenguaje"}),e.jsx(ge,{labelId:"language",label:"Lenguaje",onChange:o,sx:{width:200},defaultValue:"",displayEmpty:!0,children:s==null?void 0:s.map(({id:a,name:i})=>e.jsx(A,{value:a,children:i},a))})]})})};var z=(n=>(n.DARK="dark",n.LIGTH="light",n))(z||{});const Se={fontFamily:["Foco"].join(",")},nn=ue({palette:{mode:"dark"},typography:{...Se}}),sn=ue({palette:{mode:"light",primary:{main:"#0099CC"},secondary:{main:"#EE2C70"}},typography:{...Se}}),_e=l.createContext({toggleColorMode(){}}),an=({app:n})=>{const t=tt("(prefers-color-scheme: dark)"),[s,r]=l.useState(localStorage.getItem("mode")||(t?"light":"dark")),o=l.useMemo(()=>({toggleColorMode(){r(a=>a==="dark"?"light":"dark")}}),[]);return l.useEffect(()=>{localStorage.setItem("mode",s)},[s]),e.jsx(_e.Provider,{value:o,children:e.jsxs(nt,{theme:s==="dark"?nn:sn,children:[e.jsx(st,{}),n]})})},rn=l.memo(function({body:t,header:s,footer:r,stickyHeader:o=!0}){return e.jsxs(at,{sx:{paddingY:4,background:"transparent"},children:[e.jsx(rt,{sx:{maxHeight:"80vh"},children:e.jsxs(ot,{stickyHeader:o,children:[e.jsx(it,{children:s}),e.jsx(lt,{sx:{backgroundColor:({palette:a})=>a.mode===z.DARK?a.grey[800]:a.grey[300]},children:t}),r&&t&&e.jsx(ct,{children:r})]})}),!t&&e.jsx("div",{children:"asdsadsadsda"})]})}),on=({value:n,label:t,reactiveCb:s})=>{const r=l.useCallback(()=>{s(n)},[s,n]);return e.jsx(A,{onClick:r,children:t})},re=({filterConfig:n,reactiveCallback:t,isClosingRecursive:s})=>{const[r,o]=l.useState(null),[a,i]=l.useState(!0),u=l.useCallback(d=>{t(d),i(d==="all"),s&&o(null)},[s,t]),h=l.useCallback(()=>{o(null)},[]),c=l.useCallback(d=>{d.preventDefault(),o(d.currentTarget)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Y,{onClick:c,sx:{padding:"1px !important"},children:e.jsx(ut,{variant:"dot",invisible:a,color:"secondary",children:e.jsx(Le,{sx:{color:"white"}})})}),e.jsx(ne,{anchorEl:r,onClose:h,open:!!r,children:n.map(({value:d,label:x})=>e.jsx(on,{label:x,value:d,reactiveCb:u}))})]})},ln=Object.freeze({all:null,active:!0,deactive:!1}),cn=[{value:"all",label:"Todos"},{value:"active",label:"Activo"},{value:"deactive",label:"Inactivo"}],un=()=>{const n=l.useCallback(t=>{Dt(ln[t])},[]);return e.jsx(re,{filterConfig:cn,isClosingRecursive:!0,reactiveCallback:n})};var ke=(n=>(n.Blocker="BLOCKER",n.Critical="CRITICAL",n.Info="INFO",n.Major="MAJOR",n.Minor="MINOR",n))(ke||{}),Me=(n=>(n.Bug="BUG",n.CodeSmell="CODE_SMELL",n.SecurityHotspot="SECURITY_HOTSPOT",n.Vulnerability="VULNERABILITY",n))(Me||{});const dn=[{value:"all",label:"Todos"},...Object.values(ke).map(n=>({value:n,label:n}))],hn=()=>{const n=l.useCallback(t=>{qt(t)},[]);return e.jsx(re,{filterConfig:dn,isClosingRecursive:!0,reactiveCallback:n})},gn=[{value:"all",label:"Todos"},...Object.values(Me).map(n=>({value:n,label:n}))],pn=()=>{const n=l.useCallback(t=>Ft(t),[]);return e.jsx(re,{filterConfig:gn,isClosingRecursive:!0,reactiveCallback:n})},$=[{label:"Código",resource:"key",textAlign:"left"},{label:"Regla",resource:"name",textAlign:"left"},{label:"Tipo",resource:"type",filter:e.jsx(pn,{})},{label:"Severidad",resource:"severity",filter:e.jsx(hn,{})},{label:"Detalle",especialConfig:!0,resource:"htmlDesc"},{label:"Estado Actual",resource:"isActiveSonar",especialConfig:!0,className:"actualState",filter:e.jsx(un,{})},{label:"Estado Propuesto",resource:"isActive",especialConfig:!0,className:"proposedState"},{label:"Última Propuesta: ",resource:"updated_at",especialConfig:!0,icon:e.jsx(Fe,{sx:{color:n=>n.palette.common.white}})}],E=class extends Mt{constructor(){super("syncro");T(this,"rulesStatus");this.version(3).stores({rulesStatus:"id, updated_at, newStatus, language, qualityProfileId, description"})}static getInstance(){return E.instance??(E.instance=new E),E.instance}async getLocalRules(s){return await this.rulesStatus.where("id").anyOf(s).toArray()}async countAllRules(){return await this.rulesStatus.count()}async saveDescription(s,r){const o=await this.rulesStatus.get(s.id);return await this.rulesStatus.put({id:Number(s.id),languageId:s.lang_id,newStatus:s.isActive,qualityProfileId:Number(s.qualityProfile_id),...o,updated_at:new Date,description:r})}};let V=E;T(V,"instance");const k=V.getInstance(),Ie=new Xe({defaultOptions:{queries:{staleTime:1/0,refetchOnMount:!1,refetchOnWindowFocus:!1,_optimisticResults:"optimistic"}}}),mn=()=>{const n=Ce(),t=se(),s=je(),r=ae(),o=ye(),a=Vt(),i=Kt(),[u,h]=l.useState(10),c=l.useRef(0),[d,x]=l.useState([]),j=!!(t&&r),{data:S,isFetching:N}=H({queryKey:["rules",t,r,o,s,n,a,u,i],async queryFn(){const y={severity:n,lang_id:t,isActiveSonar:s,qualityProfile_id:r,type:o},R={page:a,limit:u},{data:_,count:F}=i?await M.getByRuleName(i,y,R):await M.getPaginatedRulesByFilter(y,R);return c.current=F,zt(F),_},enabled:j,keepPreviousData:!0});l.useEffect(()=>{J(1)},[o,n,s,r,i]);const I=l.useCallback(async()=>{if(!j)return;const y=S==null?void 0:S.map(({rules:g,...p})=>({...g,...p})),_=(y?await k.getLocalRules(y.map(({id:g})=>Number(g))):[]).reduce((g,p)=>(g[p.id]=p,g),{}),F=y==null?void 0:y.map(g=>{var p,C;return{...g,isActive:((p=_[g.id])==null?void 0:p.newStatus)??g.isActive,description:((C=_[g.id])==null?void 0:C.description)??g.description}});x(F)},[S,j]);return l.useEffect(()=>{I()},[S,a,I]),[J,h,{data:d,isLoading:N,total:c.current,page:a,rowsPerPage:u}]},Re=()=>{const[n,t]=l.useState(!1);return[l.useCallback(async()=>{t(!0);const r=await k.rulesStatus.toArray();await M.postNewStatus(r),await k.rulesStatus.clear(),await Ie.invalidateQueries({queryKey:["rules"]}),J(1),t(!1)},[]),n]},fn=l.memo(({data:n})=>e.jsx(U,{children:n.map(({label:t,icon:s,className:r,filter:o})=>e.jsx(B,{variant:"head",className:r,sx:{background:a=>`${a.palette.grey[900]} !important`},children:e.jsxs(m,{direction:"row",gap:.5,alignItems:"center",justifyContent:"center",children:[s,e.jsx(f,{sx:{color:a=>a.palette.common.white},fontWeight:700,children:t}),o]})},t))}));var Z={},xn={get exports(){return Z},set exports(n){Z=n}};(function(n,t){(function(s,r){n.exports=r()})(ee,function(){return function(s,r,o){o.updateLocale=function(a,i){var u=o.Ls[a];if(u)return(i?Object.keys(i):[]).forEach(function(h){u[h]=i[h]}),u}}})})(xn);const yn=Z;var X={},jn={get exports(){return X},set exports(n){X=n}};(function(n,t){(function(s,r){n.exports=r()})(ee,function(){return function(s,r,o){s=s||{};var a=r.prototype,i={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function u(c,d,x,j){return a.fromToBase(c,d,x,j)}o.en.relativeTime=i,a.fromToBase=function(c,d,x,j,S){for(var N,I,y,R=x.$locale().relativeTime||i,_=s.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],F=_.length,g=0;g<F;g+=1){var p=_[g];p.d&&(N=j?o(c).diff(x,p.d,!0):x.diff(c,p.d,!0));var C=(s.rounding||Math.round)(Math.abs(N));if(y=N>0,C<=p.r||!p.r){C<=1&&g>0&&(p=_[g-1]);var G=R[p.l];S&&(C=S(""+C)),I=typeof G=="string"?G.replace("%d",C):G(C,d,p.l,y);break}}if(d)return I;var K=y?R.future:R.past;return typeof K=="function"?K(I):K.replace("%s",I)},a.to=function(c,d){return u(c,d,this,!0)},a.from=function(c,d){return u(c,d,this)};var h=function(c){return c.$u?o.utc():o()};a.toNow=function(c){return this.to(h(this),c)},a.fromNow=function(c){return this.from(h(this),c)}}})})(jn);const Cn=X;var ce={},bn={get exports(){return ce},set exports(n){ce=n}};(function(n,t){(function(s,r){n.exports=r(It)})(ee,function(s){function r(i){return i&&typeof i=="object"&&"default"in i?i:{default:i}}var o=r(s),a={name:"es",monthsShort:"ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),weekStart:1,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:function(i){return i+"º"}};return o.default.locale(a,null,!0),a})})(bn);q.extend(yn);q.locale("es");q.extend(Cn);q.updateLocale("es",{relativeTime:{future:"en %s",past:"hace %s",s:"1 s",m:"1 min",mm:"%d min",h:"1 h",hh:"%d h",d:"1 d",dd:"%d d",M:"1 M",MM:"%d M",y:"1 Y",yy:"%d Y"}});const vn=({date:n})=>e.jsx(f,{align:"left",children:q(n).from(new Date)});function wn(n){const{tags:t,isActive:s,dateSonar:r,ruleTitle:o,ruleDescription:a}=n;return e.jsxs(L,{children:[e.jsxs(m,{padding:2,direction:"column",spacing:2,children:[e.jsxs(m,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:[e.jsx(O,{sx:{backgroundColor:({palette:i})=>i.mode===z.DARK?i.grey[900]:i.grey[800],color:"white"},label:`Regla ${s?"activo":"inactivo"} desde:`}),e.jsx(O,{label:`${r??"Sin info"}`})]}),e.jsx(m,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:t.map(i=>e.jsx(O,{label:i},i))})]}),e.jsx(m,{direction:"row",justifyContent:"flex-start",alignItems:"center",padding:2,pb:0,children:e.jsx(dt,{title:o,children:e.jsx(O,{color:"secondary",label:e.jsx(f,{noWrap:!0,variant:"h5",children:o})})})}),e.jsxs(m,{direction:"column",justifyContent:"center",padding:2,children:[e.jsx(m,{direction:"row",justifyContent:"flex-start",children:e.jsx(O,{label:"Descripción de la Regla",sx:{backgroundColor:({palette:i})=>i.mode===z.DARK?i.grey[900]:i.grey[800],color:"white"}})}),e.jsx(f,{dangerouslySetInnerHTML:{__html:a}})]})]})}const Sn={width:"80vh",maxWidth:600,minWidth:400,height:"80vh",minHeight:400,borderRadius:50},Te=l.memo(function({popoverBody:n,icon:t,sxProps:s,textButton:r,buttonProps:o}){const[a,i]=l.useState(null),u=l.useCallback(c=>{i(c.currentTarget)},[]),h=l.useCallback(()=>{i(null)},[]);return e.jsxs(e.Fragment,{children:[r?e.jsx(ht,{startIcon:t,onClick:u,...o,children:r}):e.jsx(Y,{onClick:u,sx:{margin:"auto"},children:t}),e.jsxs(gt,{anchorOrigin:{vertical:"center",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:s??Sn,open:!!a,onClose:h,anchorEl:a,children:[e.jsx(Y,{onClick:h,sx:{position:"absolute",top:0,right:0},children:e.jsx(Oe,{sx:{fontSize:"medium"}})}),e.jsx(L,{margin:1,children:n})]})]})});function _n({initialStatus:n,id:t,language_id:s,qualityProfile_id:r}){const[o,a]=l.useState(!1);l.useEffect(()=>{k.rulesStatus.get(Number(t)).then(u=>a(!!u))},[t]);const i=l.useCallback(async u=>{const h=await k.rulesStatus.get(Number(t));k.rulesStatus.put({...h,id:Number(t),newStatus:u.target.checked,updated_at:new Date,languageId:s,qualityProfileId:Number(r)}),a(!0)},[t,r,s]);return e.jsxs(L,{color:"red",children:[e.jsx(pe,{color:o?"warning":"primary",onChange:i,defaultChecked:n}),o?"C":""]})}const kn=({resource:n,value:t,result:s,secondaryValue:r})=>n==="isActiveSonar"?e.jsx(f,{children:t?"Activo":"Inactivo"}):n==="htmlDesc"?e.jsx(Te,{icon:e.jsx(De,{}),popoverBody:e.jsx(wn,{tags:[s.severity,s.type],isActive:s.isActive,ruleTitle:s.name,ruleDescription:s.htmlDesc})}):n==="updated_at"?Math.abs(q(String(t)).diff(r,"hours"))>6?e.jsx(vn,{date:String(t)}):e.jsx(f,{align:"left",children:"--"}):e.jsx(_n,{initialStatus:!!t,id:s.id,language_id:s.lang_id,qualityProfile_id:s.qualityProfile_id}),Mn=({colSpan:n})=>e.jsx(B,{colSpan:n,children:e.jsx(L,{display:"grid",sx:{placeContent:"center",minHeight:400},children:e.jsx(te,{})})}),In=({icon:n,primaryText:t,secondaryText:s})=>e.jsxs(m,{direction:"column",justifyContent:"center",alignItems:"center",minHeight:"50vh",sx:{fontSize:100},gap:8,children:[n,e.jsxs(m,{direction:"column",gap:4,children:[e.jsx(f,{color:"GrayText",variant:"h3",children:t}),s&&e.jsx(f,{textAlign:"center",color:"GrayText",variant:"body1",children:s})]})]}),Rn=({hasContent:n,children:t,colSpan:s})=>n?e.jsx(e.Fragment,{children:t}):e.jsx(U,{children:e.jsx(B,{colSpan:s,children:e.jsx(In,{icon:e.jsx(Be,{color:"disabled",fontSize:"inherit"}),primaryText:"Sin datos",secondaryText:"Selecciona filtros"})})}),Tn=({children:n,collapseContent:t,colSpan:s})=>{const[r,o]=l.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{sx:{cursor:"pointer",":hover":{backgroundColor:({palette:a})=>a.grey[400]}},onClick:()=>{o(a=>!a)},children:n}),e.jsx(U,{children:e.jsx(B,{colSpan:s,padding:r?"normal":"none",children:e.jsx(mt,{in:r,sx:{"& .MuiCollapse-wrapperInner":{display:"flex"}},children:t})})})]})},Pn=({title:n,result:t})=>{const s=_t(async({target:r})=>await k.saveDescription(t,r.value),500);return e.jsx("textarea",{defaultValue:t.description,title:n,placeholder:"Ingresa el porqué del cambio",onChange:s,style:{resize:"none",width:"90%",margin:"auto"}})};function En(){const[n,t,{data:s,isLoading:r,total:o,page:a,rowsPerPage:i}]=mn(),u=l.useCallback((c,d)=>{c&&n(d+1)},[n]),h=l.useCallback(c=>{t(parseInt(c.target.value,10)),n(1)},[n,t]);return e.jsxs(e.Fragment,{children:[e.jsx(rn,{body:r?e.jsx(Mn,{colSpan:$.length}):e.jsx(Rn,{hasContent:!!(s!=null&&s.length),colSpan:$.length,children:s==null?void 0:s.map(c=>e.jsx(Tn,{colSpan:$.length,collapseContent:e.jsx(Pn,{result:c,title:`${c.id}-comments`}),children:$.map(({resource:d,especialConfig:x,textAlign:j})=>x?e.jsx(B,{sx:{textAlign:"center"},children:e.jsx(kn,{result:c,resource:d,secondaryValue:c.created_at,value:c[d]??"--"})},d+c.id):e.jsx(B,{sx:{textAlign:j??"center"},children:String(c[d]??"--")},d+c.id))},c.id))}),header:e.jsx(fn,{data:$})}),e.jsx(L,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(pt,{rowsPerPage:i,count:o??1e3,page:a-1,onPageChange:u,onRowsPerPageChange:h,labelRowsPerPage:"Filas por página"})})]})}const Pe=()=>{const[n]=Re();return e.jsxs(A,{onClick:n,children:[e.jsx(me,{children:e.jsx(qe,{fontSize:"small"})}),e.jsx(fe,{children:"Sincronizar"})]})},An=()=>{var r;const n=Rt.useLiveQuery(()=>k.rulesStatus.toArray()),{data:t}=H({queryKey:["languages"],queryFn:()=>M.getAllLanguages()}),s=l.useMemo(()=>t==null?void 0:t.reduce((o,{id:a,name:i})=>(o[a]=i,o),{}),[t]);return e.jsx(Te,{icon:n!=null&&n.length?e.jsx(Ne,{color:"warning"}):e.jsx($e,{color:"success"}),textButton:e.jsx(f,{children:n!=null&&n.length?"Tienes cambios sin sincronizar":"No hay cambios sin sincronizar"}),buttonProps:{variant:"contained"},popoverBody:e.jsx(ft,{children:t&&e.jsxs(xt,{children:[(r=n==null?void 0:n.filter(({languageId:o},a,i)=>i.findIndex(({languageId:u})=>u===o)===a))==null?void 0:r.map(({languageId:o},a)=>e.jsx(m,{direction:"row",children:e.jsx(O,{label:s[o]})},a)),e.jsx(yt,{children:e.jsx(Pe,{})})]})})})},Ln=()=>{const{palette:n}=jt(),t=l.useContext(_e),s=l.useCallback(()=>{t.toggleColorMode()},[t]);return e.jsx(Ct,{sx:{background:({palette:r})=>`linear-gradient(90deg, ${r.primary.main} 80%, ${r.secondary.main} 100%)`},children:e.jsx(xe,{children:e.jsxs(bt,{disableGutters:!0,sx:{justifyContent:"space-between"},children:[e.jsxs(L,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(f,{variant:"h6",fontWeight:900,children:"Sonardash"}),e.jsx(f,{variant:"body1",children:"/ Gestión de Reglas"})]}),e.jsx(An,{}),e.jsxs(m,{direction:"row",justifyContent:"center",alignItems:"center",children:[(n==null?void 0:n.mode)===z.DARK?e.jsx(ze,{}):e.jsx(Qe,{}),e.jsx(pe,{color:"warning",onChange:s}),e.jsx("img",{src:"https://www.pacifico.com.pe/image/layout_set_logo?img_id=86311733&t=1683695027672",alt:"logo de pacifico seguros"})]})]})})})},Fn=({cb:n})=>{const t=Ce(),s=je(),r=ae(),o=ye(),[a,i]=l.useState(null),u=l.useCallback(()=>{i(null)},[]),h=l.useCallback(async({currentTarget:x})=>{r&&i(x)},[r]),c=l.useCallback(async()=>{n&&await n(),await M.downloadReport({qualityProfile_id:r})},[n,r]),d=l.useCallback(async()=>{n&&await n(),await M.downloadReport({isActiveSonar:s,qualityProfile_id:r,severity:t,type:o},!1)},[s,r,t,o,n]);return e.jsxs(e.Fragment,{children:[e.jsxs(A,{disabled:!r,onClick:h,children:[e.jsx(me,{children:e.jsx(Ve,{})}),e.jsx(fe,{children:"Descarga Personalizada"})]}),e.jsxs(ne,{anchorEl:a,onClose:u,open:!!a,children:[e.jsx(A,{onClick:c,children:"Reporte de Actualizables"}),e.jsx(A,{onClick:d,children:"Reporte Completo"})]})]})},On=()=>{const[n,t]=l.useState(null),s=l.useRef(null),r=Ht(),[o]=Re(),a=l.useCallback(()=>{t(null)},[]);l.useEffect(()=>{t(r?s.current:null)},[r]);const i=l.useCallback(({currentTarget:u})=>{t(u)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Tt,{children:e.jsx(Y,{ref:s,onClick:i,sx:{background:({palette:u})=>u.secondary.main,zIndex:500},className:"dragableMenu",children:e.jsx(Ye,{fontSize:"large"})})}),e.jsxs(ne,{className:"menuDragable",anchorEl:n,open:!!n,onClose:a,children:[e.jsx(Pe,{}),e.jsx(Fn,{cb:o})]})]})},Dn=({content:n})=>e.jsx("div",{style:{position:"sticky",bottom:20,left:20,display:"flex",justifyContent:"flex-end",zIndex:500},children:n}),Bn=()=>{const n=se(),t=ae(),[s,r]=l.useState(),[o]=kt(s,1e3),a=l.useMemo(()=>n&&t,[n,t]),i=l.useCallback(({target:u})=>{r(u.value)},[]);return l.useEffect(()=>{r(""),le()},[n,t]),l.useEffect(()=>{le(o)},[o]),e.jsx(vt,{value:s,disabled:!a,onChange:i,startAdornment:e.jsx(Ue,{})})};function qn(){return e.jsx(an,{app:e.jsxs(e.Fragment,{children:[e.jsx(Ln,{}),e.jsxs(xe,{sx:{paddingTop:12},children:[e.jsxs(m,{gap:3,children:[e.jsxs(f,{children:[e.jsx(He,{})," Activa o desactiva los switches dependiendo si deseas habilitar la regla o no"]}),e.jsxs(f,{children:[e.jsx(Ge,{})," Recuerda que los estados que propongas no se aplicarán de inmediato en SonarQube"]})]}),e.jsx(m,{direction:"column",gap:4,marginTop:4,children:e.jsxs(L,{display:"flex",gap:4,children:[e.jsx(tn,{}),e.jsx(en,{}),e.jsx(Bn,{})]})}),e.jsx(En,{}),e.jsx(Dn,{content:e.jsx(On,{})}),e.jsx(m,{paddingY:3,direction:"row",gap:3,justifyContent:"space-between"})]})]})})}const Nn="pacifico.dev.com";Pt("ctrl+m",n=>{n.preventDefault(),Ut(!0)});window.woopra.config({domain:Nn,outgoing_tracking:!0,download_tracking:!0,click_tracking:!0}),window.woopra.track();W.createRoot(document.getElementById("root")).render(e.jsx(We.StrictMode,{children:e.jsx(St,{steps:[{selector:".language",content:"Selecciona el lenguaje de programación del cual deseas consultar reglas."},{selector:".mainFilters",content:"Ahora procede a seleccionar el perfil a consultar"},{selector:".actualState",content:"Este es el estado actual de la regla en Sonarqube. Las reglas activas son las que analizan los repositorios."},{selector:".proposedState",content:"Aquí podrás proponer si una regla debe estar activada o desactivada, recuerda que tu propuesta no se verá reflejada en SonarQube inmediatamente."},{selector:".dragableMenu",content:e.jsxs(f,{children:["Las opciones de descarga y guardado se encuentran en este botón. Si no lo encuentras rápido, ubícalo con ",e.jsx("kbd",{children:"ctrl"})," +"," ",e.jsx("kbd",{children:"m"}),", ¡también lo puedes mover por toda la pantalla!"]})}],children:e.jsx(et,{client:Ie,children:e.jsx(qn,{})})})}));
