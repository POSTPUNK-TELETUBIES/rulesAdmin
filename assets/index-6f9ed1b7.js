var Pe=Object.defineProperty;var Ae=(n,t,s)=>t in n?Pe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var I=(n,t,s)=>(Ae(n,typeof t!="symbol"?t+"":t,s),s);import{j as e,z as ue,$ as Le,a0 as Fe,a1 as Oe,a2 as Be,a3 as De,a4 as qe,a5 as Ne,a6 as $e,a7 as ze,a8 as Qe,a9 as Ve,aa as Ye,ab as Ue,ac as He,ad as Ge}from"./@mui/icons-material-b0e8ace3.js";import{a as Ke,r as l,d as X,b as Je}from"./vendor-b612640b.js";import{c as b}from"./@react-rxjs/utils-24ca515a.js";import{b as v}from"./@react-rxjs/core-1a0bb4f0.js";import{a as We}from"./axios-760d4776.js";import{c as Ze}from"./@supabase/supabase-js-f1992ef7.js";import{u as U,Q as Xe,a as et}from"./@tanstack/react-query-7cfe65c4.js";import{C as ee,F as de,I as he,S as ge,M as P,u as tt,T as nt,a as st,P as at,b as rt,c as ot,d as it,e as lt,f as ct,g as Y,B as ut,h as te,i as ne,j as N,k as p,l as m,m as A,n as F,o as dt,p as ht,q as gt,r as pe,s as pt,L as me,t as fe,v as mt,w as ft,x as xt,y as yt,A as jt,z as xe,D as Ct,E as bt}from"./@mui/material-54c2e253.js";import{u as vt,T as wt}from"./@reactour/tour-e24be7d6.js";import{$ as St}from"./dexie-3976de5d.js";import{d as _t,a as D}from"./dayjs-c0cd33fe.js";import{d as Mt}from"./dexie-react-hooks-0c2ddb12.js";import{c as Rt}from"./react-draggable-b6ee902b.js";import{o as kt}from"./use-debounce-e641744f.js";import{h as It}from"./hotkeys-js-d20e5801.js";import"./@emotion/react-0d101b94.js";import"./@emotion/styled-6b07d811.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();var K={},oe=Ke;K.createRoot=oe.createRoot,K.hydrateRoot=oe.hydrateRoot;const[Tt,Et]=b(),[se]=v(Tt,""),[Pt,At]=b(),[ye]=v(Pt,"all"),[Lt,Ft]=b(),[je]=v(Lt,null),[Ot,Bt]=b(),[Ce]=v(Ot,"all"),[Dt,ie]=b(),[ae]=v(Dt,""),[qt,Nt]=b();v(qt,0);const[$t,J]=b(),[zt]=v($t,1),[Qt,Vt]=b(),[Yt]=v(Qt,!1),[Ut,le]=b(),[Ht]=v(Ut,null),be=n=>{const t={VITE_SUPABASE_TOKEN:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZueGZtZnNmdGR3aGlhaGxnb3pnIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODE5NTQ2MjIsImV4cCI6MTk5NzUzMDYyMn0.2-lbg4bjMgp6MxaHUpHd1qTIHoydHr0uXAi78MZ06h4",VITE_WOOPRA_DOMAIN:"pacifico.dev.com",VITE_SUPABASE_URL:"https://fnxfmfsftdwhiahlgozg.supabase.co",VITE_TYPE_CLIENT:"supabase",BASE_URL:"/rulesAdmin",MODE:"production",DEV:!1,PROD:!0,SSR:!1}[n];if(!t)throw new Error(`Not found env ${n}`);return t},ve=be("VITE_SUPABASE_TOKEN"),we=be("VITE_SUPABASE_URL"),Gt="supabase",T=class{constructor(t){this.client=t}getByRuleName(t,s,r){throw new Error("Method not implemented.")}downloadReport(t){throw new Error("Method not implemented.")}postNewStatus(t){throw new Error("Method not implemented.")}async getTotalCountByTable(t){return 100}static getInstance(){return T.instance??(T.instance=new T(We.create({baseURL:we,headers:{apiKey:ve}}))),T.instance}async getPaginatedRulesByFilter(t,s){const{data:r}=await this.client.get("/rules",{params:{...t,...s}});return{data:r,count:100}}async getQualityProfilesByLanguage(t){const{data:s}=await this.client.get("/qualityprofiles",{params:{language_id:t}});return s}async getAllLanguages(){const{data:t}=await this.client.get("/languages");return t}};let Q=T;I(Q,"instance");const Kt=Q.getInstance,C=class{constructor(t){this.client=t}async getCSVReportUpdatables(t){return await this.client.rpc("get_changed_q",{quality_id:Number(t)}).select("*").csv().throwOnError()}async getCSVCompletFiltered(t){return await this.prepareFilteredQuery(t).csv().throwOnError()}async downloadReport(t,s=!0){const{data:r}=s?await this.getCSVReportUpdatables(Number(t.qualityProfile_id)):await this.getCSVCompletFiltered(t),o=document.createElement("a");o.download="report";const a=URL.createObjectURL(new Blob([r],{type:"text/csv"}));o.href=a,o.click(),URL.revokeObjectURL(a),o.remove()}changeIsActive(t,s=!0){if(t.length)return this.client.from("status").update({isActive:s,updated_at:new Date}).in("id",t.map(({id:r})=>r)).throwOnError()}async postNewStatus(t){const s=t.filter(({newStatus:o})=>!o),r=t.filter(({newStatus:o})=>o);await Promise.all([this.changeIsActive(s,!1),this.changeIsActive(r,!0)])}async getTotalCountByTable(t){const{count:s}=await this.client.from(t).select("*",{count:"exact",head:!0}).throwOnError();return s??0}async getQualityProfilesByLanguage(t){const{data:s}=await this.client.from("qualityprofiles").select().eq("language_id",t).throwOnError();return s}buildQuery(t,s){for(const r in s){if(!Object.prototype.hasOwnProperty.call(s,r))continue;const o=s[r];o!=="all"&&o!=null&&(t=t.eq(C.queryBuilderColumns[r],o))}return t}prepareFilteredQuery(t){delete t.lang_id;const s=this.client.from("status").select(`
        *,
        qualityprofiles(
          *
        ),
        rules!inner(
          *
        )
      `,{count:"exact"});return this.buildQuery(s,t)}async getPaginatedRulesByFilter(t,s){const r=this.prepareFilteredQuery(t),{data:o,count:a}=await r.range(...this.getRange(s)).order("id",{ascending:!0}).throwOnError();return{data:o,count:a}}async getAllLanguages(){const{data:t}=await this.client.from("languages").select().throwOnError();return t.filter(({name:s})=>C.whiteList[s])}static getInstance(){return C.instance??(C.instance=new C(Ze(we,ve))),C.instance}getRange({page:t,limit:s=10}){return[(t-1)*s,t*s-1]}async getByRuleName(t,s,r){const{data:o,count:a}=await this.prepareFilteredQuery(s).ilike("rules.name",`%${t}%`).range(...this.getRange(r)).order("id",{ascending:!0}).throwOnError();return{data:o,count:a}}};let O=C;I(O,"instance"),I(O,"whiteList",{ts:!0,js:!0,css:!0,java:!0,web:!0}),I(O,"queryBuilderColumns",{severity:"rules.severity",type:"rules.type",isActiveSonar:"isActiveSonar",qualityProfile_id:"qualityProfile_id"});const Jt=O.getInstance,Wt={axios:Kt,supabase:Jt},_=Wt[Gt](),Zt=()=>{const n=se(),t=l.useRef(null),{data:s,isFetching:r}=U({queryKey:["qualityprofile",n],queryFn:()=>_.getQualityProfilesByLanguage(n),enabled:!!n});l.useEffect(()=>{var a;ie(((a=t.current)==null?void 0:a.value)??"")},[n]);const o=l.useCallback(a=>{ie(a.target.value)},[]);return r?e.jsx(ee,{}):e.jsxs(de,{className:"mainFilters",sx:{width:200},children:[e.jsx(he,{id:"qualityprofile",children:"Quality Profile"}),e.jsx(ge,{ref:t,onChange:o,label:"Quality Profile",labelId:"qualityprofile",defaultValue:"",displayEmpty:!0,children:s==null?void 0:s.map(({id:a,name:i})=>e.jsx(P,{value:a,children:i},a))})]})},Xt=()=>{const{setIsOpen:n,isOpen:t}=vt(),{data:s,isLoading:r}=U({queryKey:["languages"],queryFn:()=>_.getAllLanguages()}),o=l.useCallback(a=>{Et(a.target.value)},[]);return l.useEffect(()=>{localStorage.getItem("firstVisit")||(localStorage.setItem("firstVisit",new Date().toDateString()),n(!0))},[n]),l.useEffect(()=>{const a=document.querySelector("body");t?a.style.overflow="hidden":a.style.overflow="auto"},[t]),e.jsx(de,{sx:{width:200},className:"language",children:r?e.jsx(ee,{}):e.jsxs(e.Fragment,{children:[e.jsx(he,{id:"language",children:"Lenguaje"}),e.jsx(ge,{labelId:"language",label:"Lenguaje",onChange:o,sx:{width:200},defaultValue:"",displayEmpty:!0,children:s==null?void 0:s.map(({id:a,name:i})=>e.jsx(P,{value:a,children:i},a))})]})})};var $=(n=>(n.DARK="dark",n.LIGTH="light",n))($||{});const Se={fontFamily:["Foco"].join(",")},en=ue({palette:{mode:"dark"},typography:{...Se}}),tn=ue({palette:{mode:"light",primary:{main:"#0099CC"},secondary:{main:"#EE2C70"}},typography:{...Se}}),_e=l.createContext({toggleColorMode(){}}),nn=({app:n})=>{const t=tt("(prefers-color-scheme: dark)"),[s,r]=l.useState(localStorage.getItem("mode")||(t?"light":"dark")),o=l.useMemo(()=>({toggleColorMode(){r(a=>a==="dark"?"light":"dark")}}),[]);return l.useEffect(()=>{localStorage.setItem("mode",s)},[s]),e.jsx(_e.Provider,{value:o,children:e.jsxs(nt,{theme:s==="dark"?en:tn,children:[e.jsx(st,{}),n]})})},sn=l.memo(function({body:t,header:s,footer:r,stickyHeader:o=!0}){return e.jsxs(at,{sx:{paddingY:4,background:"transparent"},children:[e.jsx(rt,{sx:{maxHeight:"80vh"},children:e.jsxs(ot,{stickyHeader:o,children:[e.jsx(it,{children:s}),e.jsx(lt,{sx:{backgroundColor:({palette:a})=>a.mode===$.DARK?a.grey[800]:a.grey[300]},children:t}),r&&t&&e.jsx(ct,{children:r})]})}),!t&&e.jsx("div",{children:"asdsadsadsda"})]})}),an=({value:n,label:t,reactiveCb:s})=>{const r=l.useCallback(()=>{s(n)},[s,n]);return e.jsx(P,{onClick:r,children:t})},re=({filterConfig:n,reactiveCallback:t,isClosingRecursive:s})=>{const[r,o]=l.useState(null),[a,i]=l.useState(!0),u=l.useCallback(d=>{t(d),i(d==="all"),s&&o(null)},[s,t]),h=l.useCallback(()=>{o(null)},[]),c=l.useCallback(d=>{d.preventDefault(),o(d.currentTarget)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Y,{onClick:c,sx:{padding:"1px !important"},children:e.jsx(ut,{variant:"dot",invisible:a,color:"secondary",children:e.jsx(Le,{sx:{color:"white"}})})}),e.jsx(te,{anchorEl:r,onClose:h,open:!!r,children:n.map(({value:d,label:f})=>e.jsx(an,{label:f,value:d,reactiveCb:u}))})]})},rn=Object.freeze({all:null,active:!0,deactive:!1}),on=[{value:"all",label:"Todos"},{value:"active",label:"Activo"},{value:"deactive",label:"Inactivo"}],ln=()=>{const n=l.useCallback(t=>{Ft(rn[t])},[]);return e.jsx(re,{filterConfig:on,isClosingRecursive:!0,reactiveCallback:n})};var Me=(n=>(n.Blocker="BLOCKER",n.Critical="CRITICAL",n.Info="INFO",n.Major="MAJOR",n.Minor="MINOR",n))(Me||{}),Re=(n=>(n.Bug="BUG",n.CodeSmell="CODE_SMELL",n.SecurityHotspot="SECURITY_HOTSPOT",n.Vulnerability="VULNERABILITY",n))(Re||{});const cn=[{value:"all",label:"Todos"},...Object.values(Me).map(n=>({value:n,label:n}))],un=()=>{const n=l.useCallback(t=>{Bt(t)},[]);return e.jsx(re,{filterConfig:cn,isClosingRecursive:!0,reactiveCallback:n})},dn=[{value:"all",label:"Todos"},...Object.values(Re).map(n=>({value:n,label:n}))],hn=()=>{const n=l.useCallback(t=>At(t),[]);return e.jsx(re,{filterConfig:dn,isClosingRecursive:!0,reactiveCallback:n})},z=[{label:"Código",resource:"key",textAlign:"left"},{label:"Regla",resource:"name",textAlign:"left"},{label:"Tipo",resource:"type",filter:e.jsx(hn,{})},{label:"Severidad",resource:"severity",filter:e.jsx(un,{})},{label:"Detalle",especialConfig:!0,resource:"htmlDesc"},{label:"Estado Actual",resource:"isActiveSonar",especialConfig:!0,className:"actualState",filter:e.jsx(ln,{})},{label:"Estado Propuesto",resource:"isActive",especialConfig:!0,className:"proposedState"},{label:"Última Propuesta: ",resource:"updated_at",especialConfig:!0,icon:e.jsx(Fe,{sx:{color:n=>n.palette.common.white}})}],E=class extends St{constructor(){super("syncro");I(this,"rulesStatus");this.version(1).stores({rulesStatus:"id, updated_at, newStatus, language, qualityProfile"})}static getInstance(){return E.instace??(E.instace=new E),E.instace}async getLocalRules(s){return await this.rulesStatus.where("id").anyOf(s).toArray()}async countAllRules(){return await this.rulesStatus.count()}};let V=E;I(V,"instace");const B=V.getInstance(),ke=new Xe({defaultOptions:{queries:{staleTime:1/0,refetchOnMount:!1,refetchOnWindowFocus:!1,_optimisticResults:"optimistic"}}}),gn=()=>{const n=Ce(),t=se(),s=je(),r=ae(),o=ye(),a=zt(),i=Ht(),[u,h]=l.useState(10),c=l.useRef(0),[d,f]=l.useState([]),y=!!(t&&r),{data:w,isFetching:q}=U({queryKey:["rules",t,r,o,s,n,a,u,i],async queryFn(){const j={severity:n,lang_id:t,isActiveSonar:s,qualityProfile_id:r,type:o},R={page:a,limit:u},{data:k,count:L}=i?await _.getByRuleName(i,j,R):await _.getPaginatedRulesByFilter(j,R);return c.current=L,Nt(L),k},enabled:y,keepPreviousData:!0});l.useEffect(()=>{J(1)},[o,n,s,r,i]);const M=l.useCallback(async()=>{if(!y)return;const j=w==null?void 0:w.map(({rules:g,...x})=>({...g,...x})),k=(await B.getLocalRules(j.map(({id:g})=>Number(g)))).reduce((g,{id:x,newStatus:S})=>(g[x]=S,g),{}),L=j.map(g=>({...g,isActive:k[g.id]??g.isActive}));f(L)},[w,y]);return l.useEffect(()=>{M()},[w,a,M]),[J,h,{data:d,isLoading:q,total:c.current,page:a,rowsPerPage:u}]},Ie=()=>{const[n,t]=l.useState(!1);return[l.useCallback(async()=>{t(!0);const r=await B.rulesStatus.toArray();await _.postNewStatus(r),await B.rulesStatus.clear(),await ke.invalidateQueries({queryKey:["rules"]}),J(1),t(!1)},[]),n]},pn=l.memo(({data:n})=>e.jsx(ne,{children:n.map(({label:t,icon:s,className:r,filter:o})=>e.jsx(N,{variant:"head",className:r,sx:{background:a=>`${a.palette.grey[900]} !important`},children:e.jsxs(p,{direction:"row",gap:.5,alignItems:"center",justifyContent:"center",children:[s,e.jsx(m,{sx:{color:a=>a.palette.common.white},fontWeight:700,children:t}),o]})},t))}));var W={},mn={get exports(){return W},set exports(n){W=n}};(function(n,t){(function(s,r){n.exports=r()})(X,function(){return function(s,r,o){o.updateLocale=function(a,i){var u=o.Ls[a];if(u)return(i?Object.keys(i):[]).forEach(function(h){u[h]=i[h]}),u}}})})(mn);const fn=W;var Z={},xn={get exports(){return Z},set exports(n){Z=n}};(function(n,t){(function(s,r){n.exports=r()})(X,function(){return function(s,r,o){s=s||{};var a=r.prototype,i={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function u(c,d,f,y){return a.fromToBase(c,d,f,y)}o.en.relativeTime=i,a.fromToBase=function(c,d,f,y,w){for(var q,M,j,R=f.$locale().relativeTime||i,k=s.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],L=k.length,g=0;g<L;g+=1){var x=k[g];x.d&&(q=y?o(c).diff(f,x.d,!0):f.diff(c,x.d,!0));var S=(s.rounding||Math.round)(Math.abs(q));if(j=q>0,S<=x.r||!x.r){S<=1&&g>0&&(x=k[g-1]);var H=R[x.l];w&&(S=w(""+S)),M=typeof H=="string"?H.replace("%d",S):H(S,d,x.l,j);break}}if(d)return M;var G=j?R.future:R.past;return typeof G=="function"?G(M):G.replace("%s",M)},a.to=function(c,d){return u(c,d,this,!0)},a.from=function(c,d){return u(c,d,this)};var h=function(c){return c.$u?o.utc():o()};a.toNow=function(c){return this.to(h(this),c)},a.fromNow=function(c){return this.from(h(this),c)}}})})(xn);const yn=Z;var ce={},jn={get exports(){return ce},set exports(n){ce=n}};(function(n,t){(function(s,r){n.exports=r(_t)})(X,function(s){function r(i){return i&&typeof i=="object"&&"default"in i?i:{default:i}}var o=r(s),a={name:"es",monthsShort:"ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),weekStart:1,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:function(i){return i+"º"}};return o.default.locale(a,null,!0),a})})(jn);D.extend(fn);D.locale("es");D.extend(yn);D.updateLocale("es",{relativeTime:{future:"en %s",past:"hace %s",s:"1 s",m:"1 min",mm:"%d min",h:"1 h",hh:"%d h",d:"1 d",dd:"%d d",M:"1 M",MM:"%d M",y:"1 Y",yy:"%d Y"}});const Cn=({date:n})=>e.jsx(m,{align:"left",children:D(n).from(new Date)});function bn(n){const{tags:t,isActive:s,dateSonar:r,ruleTitle:o,ruleDescription:a}=n;return e.jsxs(A,{children:[e.jsxs(p,{padding:2,direction:"column",spacing:2,children:[e.jsxs(p,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:[e.jsx(F,{sx:{backgroundColor:({palette:i})=>i.mode===$.DARK?i.grey[900]:i.grey[800],color:"white"},label:`Regla ${s?"activo":"inactivo"} desde:`}),e.jsx(F,{label:`${r??"Sin info"}`})]}),e.jsx(p,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:t.map(i=>e.jsx(F,{label:i},i))})]}),e.jsx(p,{direction:"row",justifyContent:"flex-start",alignItems:"center",padding:2,pb:0,children:e.jsx(dt,{title:o,children:e.jsx(F,{color:"secondary",label:e.jsx(m,{noWrap:!0,variant:"h5",children:o})})})}),e.jsxs(p,{direction:"column",justifyContent:"center",padding:2,children:[e.jsx(p,{direction:"row",justifyContent:"flex-start",children:e.jsx(F,{label:"Descripción de la Regla",sx:{backgroundColor:({palette:i})=>i.mode===$.DARK?i.grey[900]:i.grey[800],color:"white"}})}),e.jsx(m,{dangerouslySetInnerHTML:{__html:a}})]})]})}const vn={width:"80vh",maxWidth:600,minWidth:400,height:"80vh",minHeight:400,borderRadius:50},Te=l.memo(function({popoverBody:n,icon:t,sxProps:s,textButton:r,buttonProps:o}){const[a,i]=l.useState(null),u=l.useCallback(c=>{i(c.currentTarget)},[]),h=l.useCallback(()=>{i(null)},[]);return e.jsxs(e.Fragment,{children:[r?e.jsx(ht,{startIcon:t,onClick:u,...o,children:r}):e.jsx(Y,{onClick:u,sx:{margin:"auto"},children:t}),e.jsxs(gt,{anchorOrigin:{vertical:"center",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:s??vn,open:!!a,onClose:h,anchorEl:a,children:[e.jsx(Y,{onClick:h,sx:{position:"absolute",top:0,right:0},children:e.jsx(Oe,{sx:{fontSize:"medium"}})}),e.jsx(A,{margin:1,children:n})]})]})});function wn({initialStatus:n,id:t,language_id:s,qualityProfile_id:r}){const[o,a]=l.useState(!1);l.useEffect(()=>{B.rulesStatus.get(Number(t)).then(u=>a(!!u))},[t]);const i=l.useCallback(u=>{B.rulesStatus.put({id:Number(t),newStatus:u.target.checked,updated_at:new Date,languageId:s,qualityProfileId:r}),a(!0)},[t,r,s]);return e.jsxs(A,{color:"red",children:[e.jsx(pe,{color:o?"warning":"primary",onChange:i,defaultChecked:n}),o?"C":""]})}const Sn=({resource:n,value:t,result:s,secondaryValue:r})=>n==="isActiveSonar"?e.jsx(m,{children:t?"Activo":"Inactivo"}):n==="htmlDesc"?e.jsx(Te,{icon:e.jsx(Be,{}),popoverBody:e.jsx(bn,{tags:[s.severity,s.type],isActive:s.isActive,ruleTitle:s.name,ruleDescription:s.htmlDesc})}):n==="updated_at"?Math.abs(D(String(t)).diff(r,"hours"))>6?e.jsx(Cn,{date:String(t)}):e.jsx(m,{align:"left",children:"--"}):e.jsx(wn,{initialStatus:!!t,id:s.id,language_id:s.lang_id,qualityProfile_id:s.qualityProfile_id}),_n=({colSpan:n})=>e.jsx(N,{colSpan:n,children:e.jsx(A,{display:"grid",sx:{placeContent:"center",minHeight:400},children:e.jsx(ee,{})})}),Mn=({icon:n,primaryText:t,secondaryText:s})=>e.jsxs(p,{direction:"column",justifyContent:"center",alignItems:"center",minHeight:"50vh",sx:{fontSize:100},gap:8,children:[n,e.jsxs(p,{direction:"column",gap:4,children:[e.jsx(m,{color:"GrayText",variant:"h3",children:t}),s&&e.jsx(m,{textAlign:"center",color:"GrayText",variant:"body1",children:s})]})]}),Rn=({hasContent:n,children:t,colSpan:s})=>n?e.jsx(e.Fragment,{children:t}):e.jsx(ne,{children:e.jsx(N,{colSpan:s,children:e.jsx(Mn,{icon:e.jsx(De,{color:"disabled",fontSize:"inherit"}),primaryText:"Sin datos",secondaryText:"Selecciona filtros"})})});function kn(){const[n,t,{data:s,isLoading:r,total:o,page:a,rowsPerPage:i}]=gn(),u=l.useCallback((c,d)=>{c&&n(d+1)},[n]),h=l.useCallback(c=>{t(parseInt(c.target.value,10)),n(1)},[n,t]);return e.jsxs(e.Fragment,{children:[e.jsx(sn,{body:r?e.jsx(_n,{colSpan:z.length}):e.jsx(Rn,{hasContent:!!(s!=null&&s.length),colSpan:z.length,children:s==null?void 0:s.map(c=>e.jsx(ne,{children:z.map(({resource:d,especialConfig:f,textAlign:y})=>f?e.jsx(N,{sx:{textAlign:"center"},children:e.jsx(Sn,{result:c,resource:d,secondaryValue:c.created_at,value:c[d]??"--"})},d+c.id):e.jsx(N,{sx:{textAlign:y??"center"},children:String(c[d]??"--")},d+c.id))},c.id))}),header:e.jsx(pn,{data:z})}),e.jsx(A,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(pt,{rowsPerPage:i,count:o??1e3,page:a-1,onPageChange:u,onRowsPerPageChange:h,labelRowsPerPage:"Filas por pagina"})})]})}const Ee=()=>{const[n]=Ie();return e.jsxs(P,{onClick:n,children:[e.jsx(me,{children:e.jsx(qe,{fontSize:"small"})}),e.jsx(fe,{children:"Sincronizar"})]})},In=()=>{var r;const n=Mt.useLiveQuery(()=>B.rulesStatus.toArray()),{data:t}=U({queryKey:["languages"],queryFn:()=>_.getAllLanguages()}),s=l.useMemo(()=>t==null?void 0:t.reduce((o,{id:a,name:i})=>(o[a]=i,o),{}),[t]);return e.jsx(Te,{icon:n!=null&&n.length?e.jsx(Ne,{color:"warning"}):e.jsx($e,{color:"success"}),textButton:e.jsx(m,{children:n!=null&&n.length?"Tienes cambios sin sincronizar":"No hay cambios sin sincronizar"}),buttonProps:{variant:"contained"},popoverBody:e.jsx(mt,{children:t&&e.jsxs(ft,{children:[(r=n==null?void 0:n.filter(({languageId:o},a,i)=>i.findIndex(({languageId:u})=>u===o)===a))==null?void 0:r.map(({languageId:o},a)=>e.jsx(p,{direction:"row",children:e.jsx(F,{label:s[o]})},a)),e.jsx(xt,{children:e.jsx(Ee,{})})]})})})},Tn=()=>{const{palette:n}=yt(),t=l.useContext(_e),s=l.useCallback(()=>{t.toggleColorMode()},[t]);return e.jsx(jt,{sx:{background:({palette:r})=>`linear-gradient(90deg, ${r.primary.main} 80%, ${r.secondary.main} 100%)`},children:e.jsx(xe,{children:e.jsxs(Ct,{disableGutters:!0,sx:{justifyContent:"space-between"},children:[e.jsxs(A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(m,{variant:"h6",fontWeight:900,children:"Sonardash"}),e.jsx(m,{variant:"body1",children:"/ Gestión de Reglas"})]}),e.jsx(In,{}),e.jsxs(p,{direction:"row",justifyContent:"center",alignItems:"center",children:[(n==null?void 0:n.mode)===$.DARK?e.jsx(ze,{}):e.jsx(Qe,{}),e.jsx(pe,{color:"warning",onChange:s}),e.jsx("img",{src:"https://www.pacifico.com.pe/image/layout_set_logo?img_id=26556784&t=1682438787127",alt:"logo de pacifico seguros"})]})]})})})},En=({cb:n})=>{const t=Ce(),s=je(),r=ae(),o=ye(),[a,i]=l.useState(null),u=l.useCallback(()=>{i(null)},[]),h=l.useCallback(async({currentTarget:f})=>{r&&i(f)},[r]),c=l.useCallback(async()=>{n&&await n(),await _.downloadReport({qualityProfile_id:r})},[n,r]),d=l.useCallback(async()=>{n&&await n(),await _.downloadReport({isActiveSonar:s,qualityProfile_id:r,severity:t,type:o},!1)},[s,r,t,o,n]);return e.jsxs(e.Fragment,{children:[e.jsxs(P,{disabled:!r,onClick:h,children:[e.jsx(me,{children:e.jsx(Ve,{})}),e.jsx(fe,{children:"Descarga Personalizada"})]}),e.jsxs(te,{anchorEl:a,onClose:u,open:!!a,children:[e.jsx(P,{onClick:c,children:"Reporte de Actualizables"}),e.jsx(P,{onClick:d,children:"Reporte Completo"})]})]})},Pn=()=>{const[n,t]=l.useState(null),s=l.useRef(null),r=Yt(),[o]=Ie(),a=l.useCallback(()=>{t(null)},[]);l.useEffect(()=>{t(r?s.current:null)},[r]);const i=l.useCallback(({currentTarget:u})=>{t(u)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Rt,{children:e.jsx(Y,{ref:s,onClick:i,sx:{background:({palette:u})=>u.secondary.main,zIndex:500},className:"dragableMenu",children:e.jsx(Ye,{fontSize:"large"})})}),e.jsxs(te,{className:"menuDragable",anchorEl:n,open:!!n,onClose:a,children:[e.jsx(Ee,{}),e.jsx(En,{cb:o})]})]})},An=({content:n})=>e.jsx("div",{style:{position:"sticky",bottom:20,left:20,display:"flex",justifyContent:"flex-end",zIndex:500},children:n}),Ln=()=>{const n=se(),t=ae(),[s,r]=l.useState(),[o]=kt(s,1e3),a=l.useMemo(()=>n&&t,[n,t]),i=l.useCallback(({target:u})=>{r(u.value)},[]);return l.useEffect(()=>{r(""),le()},[n,t]),l.useEffect(()=>{le(o)},[o]),e.jsx(bt,{value:s,disabled:!a,onChange:i,startAdornment:e.jsx(Ue,{})})};function Fn(){return e.jsx(nn,{app:e.jsxs(e.Fragment,{children:[e.jsx(Tn,{}),e.jsxs(xe,{sx:{paddingTop:12},children:[e.jsxs(p,{gap:3,children:[e.jsxs(m,{children:[e.jsx(He,{})," Activa o desactiva los switches dependiendo si deseas habilitar la regla o no"]}),e.jsxs(m,{children:[e.jsx(Ge,{})," Recuerda que los estados que propongas no se aplicarán de inmediato en SonarQube"]})]}),e.jsx(p,{direction:"column",gap:4,marginTop:4,children:e.jsxs(A,{display:"flex",gap:4,children:[e.jsx(Xt,{}),e.jsx(Zt,{}),e.jsx(Ln,{})]})}),e.jsx(kn,{}),e.jsx(An,{content:e.jsx(Pn,{})}),e.jsx(p,{paddingY:3,direction:"row",gap:3,justifyContent:"space-between"})]})]})})}const On="pacifico.dev.com";It("ctrl+m",n=>{n.preventDefault(),Vt(!0)});window.woopra.config({domain:On,outgoing_tracking:!0,download_tracking:!0,click_tracking:!0}),window.woopra.track();K.createRoot(document.getElementById("root")).render(e.jsx(Je.StrictMode,{children:e.jsx(wt,{steps:[{selector:".language",content:"Selecciona el lenguaje de programación del cual deseas consultar reglas."},{selector:".mainFilters",content:"Ahora procede a seleccionar el perfil a consultar"},{selector:".actualState",content:"Este es el estado actual de la regla en Sonarqube. Las reglas activas son las que analizan los repositorios."},{selector:".proposedState",content:"Aquí podrás proponer si una regla debe estar activada o desactivada, recuerda que tu propuesta no se verá reflejada en SonarQube inmediatamente."},{selector:".dragableMenu",content:e.jsxs(m,{children:["Las opciones de descarga y guardado se encuentran en este botón. Si no lo encuentras rápido, ubícalo con ",e.jsx("kbd",{children:"ctrl"})," +"," ",e.jsx("kbd",{children:"m"}),", ¡también lo puedes mover por toda la pantalla!"]})}],children:e.jsx(et,{client:ke,children:e.jsx(Fn,{})})})}));
