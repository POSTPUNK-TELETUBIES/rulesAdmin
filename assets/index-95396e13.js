var Dt=Object.defineProperty;var Ot=(n,t,s)=>t in n?Dt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var w=(n,t,s)=>(Ot(n,typeof t!="symbol"?t+"":t,s),s);import{N as nt,j as e,a7 as Nt,a8 as at,a9 as qt,aa as Te,ab as Bt,ac as zt,ad as Ut,ae as Qt,af as $t,ag as Vt,ah as Ht,ai as Wt,aj as Yt,ak as rt,al as Kt,am as Gt,an as Jt,ao as Xt,ap as Zt}from"./@mui/icons-material-ab3a2dd4.js";import{a as es,r as l,e as ts,d as Fe,g as it,b as ss}from"./vendor-207237f2.js";import{u as ns,S as as}from"./notistack-db4c90f8.js";import{u as ot,C as rs,S as is,a as Ee,F as P,I as T,O as G,b as os,c as f,B as b,L as Le,G as Se,P as ls,T as cs,d as us,e as ds,f as hs,g as gs,M as k,h as fe,i as je,D as ms,j as ps,k as xs,l as J,m as _,n as Ye,o as fs,p as js,q as ys,r as bs,A as Cs,s as vs,t as De,v as Oe,w as lt,x as ye,y as ws,z as _s,E as ct,H as Ke,J as le,K as Ss,N as ne,Q as ks,R as Is}from"./@mui/material-cee8dd7b.js";import{w as Ps,u as ut,s as V,x as dt,y as Ts,b as p,z as N,P as Ls,C as Y,D as be,E as Ne,H as Rs,J as As,M as Ms,N as Fs,O as Es,Q as Ds,R as Os,S as Ns,U as qs}from"./@mui/lab-869fd29d.js";import{u as ht,L as Bs,B as zs,R as Us,a as ie,N as Ge}from"./react-router-dom-99b80545.js";import{u as qe}from"./react-hook-form-53b9354b.js";import{c as Be}from"./@supabase/supabase-js-98458e85.js";import{b as pe}from"./react-lazy-load-image-component-3f9d37e3.js";import{X as Qs}from"./dexie-911c5dc6.js";import{d as $s}from"./dexie-react-hooks-efe53238.js";import{a as Vs}from"./axios-4a70c6fc.js";import{p as Hs}from"./papaparse-6ea79c53.js";import{c as A}from"./@react-rxjs/utils-31d3d490.js";import{b as M}from"./@react-rxjs/core-8fefe617.js";import{Q as Ws,u as Ce,a as Ys}from"./@tanstack/react-query-b125ade5.js";import{u as Ks,T as Gs}from"./@reactour/tour-6e99e852.js";import{d as Js,a as X}from"./dayjs-f30b717c.js";import{c as Xs,o as Zs}from"./use-debounce-ff8cde72.js";import{D as en}from"./react-draggable-7aabed6d.js";import{h as tn}from"./hotkeys-js-46483ca1.js";import"./@emotion/react-23f5b1b9.js";import"./@emotion/styled-94d978bf.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();var Re={},Je=es;Re.createRoot=Je.createRoot,Re.hydrateRoot=Je.hydrateRoot;var re=(n=>(n.DARK="dark",n.LIGTH="light",n))(re||{});const gt={fontFamily:["Foco"].join(",")},sn=nt({palette:{mode:"dark"},typography:{...gt}}),nn=nt({palette:{mode:"light",primary:{main:"#0099CC"},secondary:{main:"#EE2C70"}},typography:{...gt}}),mt=l.createContext({toggleColorMode(){}}),an=({children:n})=>{const t=ot("(prefers-color-scheme: dark)"),[s,a]=l.useState(localStorage.getItem("mode")||(t?"light":"dark")),r=l.useMemo(()=>({toggleColorMode(){a(i=>i==="dark"?"light":"dark")}}),[]);return l.useEffect(()=>{localStorage.setItem("mode",s)},[s]),e.jsx(mt.Provider,{value:r,children:e.jsxs(Ps,{theme:s==="dark"?sn:nn,children:[e.jsx(rs,{}),n]})})},rn=({handleClose:n,handleOpen:t,isOpen:s,content:a})=>{const r=ut(),i=ot(r.breakpoints.up("md"));return e.jsx(is,{PaperProps:{sx:{justifyContent:"center"}},onOpen:t,onClose:n,open:s,anchor:i?"right":"bottom",children:e.jsx(Ee,{sx:on,children:a})})},on={maxWidth:500,width:{md:"50vw"},minHeight:"50vh",display:"grid",placeContent:"center"};var ce=(n=>(n.FIRST_VISIT="firstVisit",n.TIMES_VISIT="timesVisit",n))(ce||{});class ln extends Error{constructor(t){super(`${t} is required, please do check .envexample to provide one similar into .env file`)}}const pt=n=>{const t={VITE_SUPABASE_TOKEN:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndyaXBhbnFobXdnbnJua25iZ2tiIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODcyMTU5NDksImV4cCI6MjAwMjc5MTk0OX0.FUBAfuwsSF69KLApkOttj3RLHDaQ4d6pBJujZnrLOzk",VITE_WOOPRA_DOMAIN:"pacifico.dev.com",VITE_SUPABASE_URL:"https://wripanqhmwgnrnknbgkb.supabase.co",VITE_TYPE_CLIENT:"supabase",BASE_URL:"/rulesAdmin",MODE:"production",DEV:!1,PROD:!0,SSR:!1}[n];if(!t)throw new ln(n);return t},cn=(n,t=!0,s=document.body)=>{const a=s.querySelector(n);a&&(a.style.overflow=t?"hidden":"auto")},un=n=>n<=3,dn=()=>{const n=localStorage.getItem(ce.TIMES_VISIT);if(un(Number(n)))return localStorage.setItem(ce.FIRST_VISIT,new Date().toDateString()),localStorage.setItem(ce.TIMES_VISIT,((Number(n)||0)+1).toString()),!0},Xe=n=>n!=null,hn={css:1,java:1,web:1,Web:1,javascript:1,typescript:1},gn=(n,t=hn)=>{const[s]=n.match(/^.+:/);return t[s.substring(0,s.length-1)]?n.replace(s,""):n},mn=(n,t,s)=>t?gn(n,s):n,Ae=(n,t,s)=>n?t:s,ze=(n,t,s)=>n==null?void 0:n.reduce((a,r)=>(a[String(r[t])]=s?r[s]:r,a),{}),pn=()=>{const n=new Date;return n.setUTCHours(0),n.setUTCMinutes(0),n},xt=(n,t,s=!0)=>{if(!s)return window[n]=t};xt("keyBy",ze);xt("renderConditional",Ae);const xn=n=>{const t=[],s=new Date;for(let a=0;a<n;a++){s.setMinutes(s.getMinutes()-a);const r={id:a+1,author:"asda",timestamp:"asdsa",content:"asdasdsad"};t.push(r)}return t},ve=pt("VITE_SUPABASE_TOKEN"),we=pt("VITE_SUPABASE_URL"),fn="supabase",ke=void 0,jn=ke==null?void 0:ke.serverInit();window.mockServer=jn;const ft=Be(we,ve),O=class{constructor(){if(O.instance)throw new Error("Singleton")}static getInstance(){return O.instance??(O.instance=new O),O.instance}get tokenData(){return{token:localStorage.getItem("token"),refreshToken:localStorage.getItem("refreshToken")}}set tokenData(t){Object.keys(t).forEach(s=>localStorage.setItem(s,t[s]))}clean(){localStorage.removeItem("token"),localStorage.removeItem("refreshToken")}};let ue=O;w(ue,"instance");const z=class{constructor(t,s=ue.getInstance()){w(this,"isLogged");w(this,"user");this.client=t,this.authStorage=s}async singUp({email:t,firstName:s,lastName:a,password:r,username:i}){const{data:o,error:c}=await this.client.signUp({email:t,password:r,options:{data:{first_name:s,last_name:a,username:i}}});if(c)throw c;return o}static getInstance(t){return z.instance??(z.instance=new z(t??Be(we,ve).auth)),z.instance}setToken(t){this.authStorage.tokenData={refreshToken:t.refresh_token,token:t.access_token}}async login(t,s){const{data:a,error:r}=await this.client.signInWithPassword({email:t,password:s});if(r)throw r;return this.setToken(a.session),this.isLogged=!0,this.user=a.user,a}async verifyAuth(t){const{data:s,error:a}=await this.client.getUser(t);if(a)throw a;return s}async logOut(t){const{error:s}=await this.client.signOut();if(s)throw s;return this.user=null,this.authStorage.clean(),t}async getPermissions(){const{data:t,error:s}=await this.client.mfa.getAuthenticatorAssuranceLevel();if(s)throw s;return t}async checkAuth(t,s){const a=t??this.authStorage.tokenData.token,r=s??this.authStorage.tokenData.refreshToken;if(!a||!r)return;const{data:i,error:o}=await this.client.setSession({access_token:a,refresh_token:r});if(o)throw o;return this.setToken(i.session),this.isLogged=!0,this.user=i.user,i}};let de=z;w(de,"instance");const B=Object.assign(de.getInstance(ft.auth),{isLoading:!0}),q=l.createContext(B),Me=({inputProps:n,disabled:t,id:s="password",label:a="Contraseña"})=>{const[r,i]=l.useState(!1),o=l.useCallback(()=>{i(c=>!c)},[]);return e.jsxs(P,{disabled:t,children:[e.jsx(T,{htmlFor:s,children:a}),e.jsx(G,{id:s,type:r?"text":"password",inputProps:n,endAdornment:e.jsx(os,{position:"end",children:e.jsx(V,{"aria-label":"toggle password visibility",onMouseDown:c=>c.preventDefault(),edge:"end",onClick:o,children:r?e.jsx(Nt,{}):e.jsx(at,{})})}),label:a})]})};function yn(){const n=l.useContext(q),{enqueueSnackbar:t}=ns(),s=ht();async function a(r,i){try{await n.login(r,i),s("/admin")}catch(o){const{message:c}=o;return t("Credenciales inválidas",{variant:"error",autoHideDuration:3e3}),c}}return a}function bn({singUpClick:n,isSingUpAvailable:t}){const{handleSubmit:s,register:a,resetField:r}=qe(),i=yn(),[o,c]=l.useState(!1),h=l.useCallback(async({email:u,password:d})=>{c(!0),r("password"),i(u,d),c(!1)},[i,r]);return e.jsxs(f,{component:"form",onSubmit:s(h),spacing:2,children:[e.jsx(b,{display:"flex",justifyContent:"center",children:e.jsx(dt,{sx:{width:80,height:80}})}),e.jsxs(P,{disabled:o,children:[e.jsx(T,{htmlFor:"email",children:"Correo Electronico"}),e.jsx(G,{id:"email",label:"Correo Electronico",inputProps:a("email")})]}),e.jsx(Me,{disabled:o,inputProps:a("password")}),e.jsx(Ts,{type:"submit",variant:"contained",disabled:o,loading:o,children:"Iniciar Sesión"}),t&&e.jsxs(p,{align:"center",children:["¿Aún no te registras? ",e.jsx(Le,{onClick:n,children:"Registrate"})," "]})]})}const Cn=({handleLoginClick:n})=>{const[t,s]=l.useState(!1),[a,r]=l.useState(!1),{register:i,handleSubmit:o}=qe(),c=l.useContext(q),h=l.useCallback(async u=>{s(!0),await c.singUp(u),s(!1),r(!0)},[c]);return a?e.jsx(f,{children:e.jsxs(p,{children:["Revisa tu correo y haz click en el enalnce de confirmacion, si ya lo hiciste, ",e.jsx(Le,{onClick:n,children:"Logueate"})]})}):e.jsxs(f,{component:"form",onSubmit:o(h),spacing:2,children:[e.jsxs(P,{disabled:t,children:[e.jsx(T,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",label:"Email",inputProps:i("email")})]}),e.jsx(Me,{inputProps:i("password")}),e.jsx(Me,{id:"confirmPassword",label:"Confirm Password",inputProps:i("confirmPassword")}),e.jsxs(P,{disabled:t,children:[e.jsx(T,{htmlFor:"username",children:"Username"}),e.jsx(G,{id:"username",label:"Username",inputProps:i("username")})]}),e.jsxs(P,{disabled:t,children:[e.jsx(T,{htmlFor:"lastName",children:"Apellido"}),e.jsx(G,{id:"lastName",label:"Apellido",inputProps:i("lastName")})]}),e.jsxs(P,{disabled:t,children:[e.jsx(T,{htmlFor:"firstName",children:"Nombre"}),e.jsx(G,{id:"firstName",label:"Nombre",inputProps:i("firstName")})]}),e.jsx(N,{type:"submit",variant:"contained",children:"Sing up"}),e.jsxs(p,{align:"center",children:["¿Ya tienes cuenta? ",e.jsx(Le,{onClick:n,children:"Log in"})]})]})},vn="_container_862mo_1",wn="_imgContainer_862mo_5",_n="_img_862mo_5",Sn="_textContainer_862mo_18",kn="_title_862mo_36",In="_subtitle_862mo_40",W={container:vn,imgContainer:wn,"lazy-load-image-background":"_lazy-load-image-background_862mo_10",img:_n,textContainer:Sn,title:kn,subtitle:In};const Pn=({isSingUpAvailable:n})=>{const[t,s]=l.useState(!1),[a,r]=l.useState(!0),i=l.useCallback((u=!0)=>()=>{s(!0),r(u)},[]),o=l.useCallback(()=>{s(!1)},[]),c=l.useCallback(()=>{r(!1)},[]),h=l.useCallback(()=>{r(!0)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(Se,{container:!0,columns:{xs:6,md:12},className:W.container,children:[e.jsx(Se,{item:!0,xs:6,className:W.imgContainer,children:e.jsx(pe.LazyLoadImage,{src:"admin3.webp",className:W.img,alt:"chica sujetando en sus manos una laptop de colo negra",effect:"blur",width:"100%"})}),e.jsx(Se,{item:!0,xs:6,children:e.jsxs(b,{p:{xs:3,sm:8,lg:14},className:W.textContainer,children:[e.jsx("h2",{className:W.title,children:"Administración de reglas de SonarQube"}),e.jsx("h3",{className:W.subtitle,children:"Personalize y configure sin esfuerzo para optimizar la calidad del codigo."}),e.jsxs(f,{gap:2,direction:{sm:"column",md:"row"},marginTop:{xs:2,sm:4},children:[n&&e.jsx(N,{variant:"contained",onClick:i(!1),children:"Registrate"}),e.jsx(N,{variant:"outlined",onClick:i(),sx:{px:6},style:{alignSelf:"center",width:"max-content"},children:"Iniciar sesión"})]})]})})]}),e.jsx(rn,{content:a?e.jsx(bn,{singUpClick:c}):e.jsx(Cn,{handleLoginClick:h}),handleClose:o,handleOpen:i,isOpen:t})]})},Tn="_container_1ueut_1",Ln="_img_1ueut_5",Rn="_box_1ueut_11",Ie={container:Tn,img:Ln,box:Rn},An=()=>e.jsxs("div",{className:Ie.container,children:[e.jsx(pe.LazyLoadImage,{src:"error404.webp",className:Ie.img,alt:"Fondo degradado",effect:"blur",width:"100%"}),e.jsx("div",{className:Ie.box,children:e.jsx(Bs,{to:"/",children:e.jsx(N,{variant:"contained",size:"large",children:"Volver al inicio"})})})]}),U=class extends Qs{constructor(){super("syncro");w(this,"rulesStatus");this.version(5).stores({rulesStatus:"id, updated_at, newStatus, language, qualityProfileId, description, user_email"})}static getInstance(){return U.instance??(U.instance=new U),U.instance}async getLocalRules(s){return await this.rulesStatus.where("id").anyOf(s).toArray()}async countAllRules(){return await this.rulesStatus.count()}async saveDescription(s,a){const r=await this.rulesStatus.get(s.id);return await this.rulesStatus.put({id:Number(s.id),languageId:s.lang_id,newStatus:s.isActive,qualityProfileId:Number(s.qualityProfile_id),...r,updated_at:new Date,...a?{description:a}:{},user_email:s.user_email})}async getRulesToUpdate(){return await this.rulesStatus.toArray()}};let he=U;w(he,"instance");const S=he.getInstance(),Mn={width:"80vh",maxWidth:600,minWidth:400,height:"80vh",minHeight:400,borderRadius:50},Fn=l.memo(function({popoverBody:n,icon:t,sxProps:s,textButton:a,buttonProps:r}){const[i,o]=l.useState(null),c=l.useCallback(u=>{u.stopPropagation(),o(u.currentTarget)},[]),h=l.useCallback(u=>{u.stopPropagation(),o(null)},[]);return e.jsxs(e.Fragment,{children:[a?e.jsx(N,{startIcon:t,onClick:c,...r,children:a}):e.jsx(V,{onClick:c,sx:{margin:"auto"},children:t}),e.jsxs(ls,{anchorOrigin:{vertical:"center",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:s??Mn,open:!!i,onClose:h,anchorEl:i,children:[e.jsx(V,{onClick:h,sx:{position:"absolute",top:0,right:0},children:e.jsx(qt,{sx:{fontSize:"medium"}})}),e.jsx(b,{margin:1,children:n})]})]})}),Q=class{constructor(t){this.client=t}getConflicts(t){throw new Error("Method not implemented.")}getByRuleName(t,s,a){throw new Error("Method not implemented.")}downloadReport(t){throw new Error("Method not implemented.")}postNewStatus(t){throw new Error("Method not implemented.")}async getTotalCountByTable(t){return 100}static getInstance(){return Q.instance??(Q.instance=new Q(Vs.create({baseURL:we,headers:{apiKey:ve}}))),Q.instance}async getPaginatedRulesByFilter(t,s){const{data:a}=await this.client.get("/rules",{params:{...t,...s}});return{data:a,count:100}}async getQualityProfilesByLanguage(t){const{data:s}=await this.client.get("/qualityprofiles",{params:{language_id:t}});return s}async getAllLanguages(){const{data:t}=await this.client.get("/languages");return t}};let ge=Q;w(ge,"instance");const En=ge.getInstance,$=class{static getInstance(){return $.instance??($.instance=new $),$.instance}parseReport(t){const s=t.map(({rules:a,qualityprofiles:r,...i})=>({...a,...r,...i,ruleKey:a.key,qualityProfileName:r.name,ruleName:a.name}));return Hs.unparse(s,{columns:["qualityProfileName","ruleKey","ruleName","severity","type","updated_at","created_at","description","isActiveSonar","isActive","user_email"]})}};let me=$;w(me,"instance");const Dn=me.getInstance(),R=class{constructor(t,s=Dn){this.client=t,this.reportGenerator=s}static getInstance(t){return R.instance??(R.instance=new R(t??Be(we,ve))),R.instance}async getConflicts(t){const s=pn().toISOString(),a=this.client.from("status").select(`
        *,
        qualityprofiles(
        *
        ),
        rules!inner(
          *
      )
      `).in("id",t.map(({id:c})=>c)).gt("updated_at",s).throwOnError(),{data:r}=await a,i=ze(r,"id");return t.filter(({id:c,newStatus:h})=>{var u,d;return Xe((u=i[c])==null?void 0:u.isActive)&&((d=i[c])==null?void 0:d.isActive)!==h}).map(c=>{const{rules:h,...u}=i[c.id];return{...h,...u,...c}})}async getCSVReportUpdatables(t){const{data:s}=await this.client.rpc("get_changed_q",{quality_id:Number(t)}).select("*").csv().throwOnError();return s}async getCSVCompleteFiltered(t){const{data:s}=await this.prepareFilteredQuery(t).throwOnError();return this.reportGenerator.parseReport(s)}async downloadReport(t,s=!0){const a=s?await this.getCSVReportUpdatables(Number(t.qualityProfile_id)):await this.getCSVCompleteFiltered(t),r=document.createElement("a");r.download="report";const i=URL.createObjectURL(new Blob([a],{type:"text/csv"}));r.href=i,r.click(),URL.revokeObjectURL(i),r.remove()}changeIsActive(t,s=!0){if(!t.length)return;const[{user_email:a}]=t;return this.client.from("status").update({isActive:s,updated_at:new Date,user_email:a}).in("id",t.map(({id:r})=>r)).throwOnError()}async bulkUpdateDescription(t){if(!t.length)return;const{data:s}=await this.client.auth.getUser();return await this.client.from("status").upsert(t.map(({id:a,description:r,qualityProfileId:i})=>{var o;return{id:a,description:r,qualityProfile_id:i,user_email:(o=s.user)==null?void 0:o.email}})).select().throwOnError()}async postNewStatus(t){const s=t.filter(({newStatus:i})=>!i),a=t.filter(({newStatus:i})=>i),r=t.filter(({description:i})=>!!i);await Promise.all([this.changeIsActive(s,!1),this.changeIsActive(a,!0),this.bulkUpdateDescription(r)])}async getTotalCountByTable(t){const{count:s}=await this.client.from(t).select("*",{count:"exact",head:!0}).throwOnError();return s??0}getQualityProfilesByLanguageQuery(t){return this.client.from("qualityprofiles").select().eq("language_id",t).throwOnError()}async getQualityProfilesByLanguage(t){const{data:s}=await this.getQualityProfilesByLanguageQuery(t);return s}buildQuery(t,s){for(const a in s){if(!Object.prototype.hasOwnProperty.call(s,a))continue;const r=s[a];r!=="all"&&Xe(r)&&(t=t.eq(R.queryBuilderColumns[a],r))}return t}prepareFilteredQuery(t){delete t.lang_id;const s=this.client.from("status").select(`
        *,
        qualityprofiles(
          *
        ),
        rules!inner(
          *
        )
      `,{count:"exact"});return this.buildQuery(s,t)}getPaginatedRulesByFilterQuery(t,s){return this.prepareFilteredQuery(t).range(...this.getRange(s)).order("id",{ascending:!0}).throwOnError()}async getPaginatedRulesByFilter(t,s){const{data:a,count:r}=await this.getPaginatedRulesByFilterQuery(t,s);return{data:a,count:r}}getAllLanguagesQuery(){return this.client.from("languages").select().throwOnError()}async getAllLanguages(){const{data:t}=await this.getAllLanguagesQuery();return t.filter(({name:s})=>R.whiteList[s])}getRange({page:t,limit:s=10}){return[(t-1)*s,t*s-1]}async getByRuleName(t,s,a){const{data:r,count:i}=await this.prepareFilteredQuery(s).ilike("rules.name",`%${t}%`).range(...this.getRange(a)).order("id",{ascending:!0}).throwOnError();return{data:r,count:i}}subscribeChanges(t){return this.client.channel("changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"status"},t).subscribe()}};let K=R;w(K,"instance"),w(K,"whiteList",{ts:!0,js:!0,css:!0,java:!0,web:!0}),w(K,"queryBuilderColumns",{severity:"rules.severity",type:"rules.type",isActiveSonar:"isActiveSonar",qualityProfile_id:"qualityProfile_id"});const Ue=K.getInstance,On={axios:En,supabase:()=>Ue(ft)},H=On[fn](),[Nn,qn]=A(),[Qe]=M(Nn,""),[Bn,zn]=A(),[Un]=M(Bn,"all"),[Qn,$n]=A(),[Vn]=M(Qn,null),[Hn,Wn]=A(),[Yn]=M(Hn,"all"),[Kn,Ze]=A(),[jt]=M(Kn,""),[Gn,Jn]=A();M(Gn,0);const[Xn,xe]=A(),[Zn]=M(Xn,1),[ea,ta]=A(),[sa]=M(ea,!1),[na,et]=A(),[aa]=M(na,null),$e=new Ws({defaultOptions:{queries:{staleTime:1/0,refetchOnMount:!1,refetchOnWindowFocus:!1,_optimisticResults:"optimistic"}}}),ra=()=>{const n=Yn(),t=Qe(),s=Vn(),a=jt(),r=Un(),i=Zn(),o=aa();return{severity:n,lang_id:t,isActiveSonar:s,qualityProfile_id:a,type:r,page:i,textMatchFilter:o}},ia=()=>{const{isActiveSonar:n,lang_id:t,page:s,qualityProfile_id:a,severity:r,textMatchFilter:i,type:o}=ra(),[c,h]=l.useState(10),u=l.useRef(0),[d,x]=l.useState([]),[y,g]=l.useState(null),m=!!(t&&a),{data:I,isFetching:Z,isLoading:ee,isRefetching:te,isFetched:_e}=Ce({queryKey:["rules",t,a,o,n,r,s,c,i],async queryFn(){const j={severity:r,lang_id:t,isActiveSonar:n,qualityProfile_id:a,type:o},C={page:s,limit:c},{data:E,count:D}=i?await H.getByRuleName(i,j,C):await H.getPaginatedRulesByFilter(j,C);return u.current=D,Jn(D),E},enabled:m,keepPreviousData:!0});l.useEffect(()=>{xe(1)},[o,r,n,a,i]);const F=l.useCallback(async()=>{if(!m)return;const j=I==null?void 0:I.map(({rules:v,...L})=>{var se;return{...v,...L,...Number((se=y==null?void 0:y.new)==null?void 0:se.id)===Number(L.id)?y==null?void 0:y.new:{},isActiveOriginal:L.isActive}}),E=(j?await S.getLocalRules(j.map(({id:v})=>Number(v))):[]).reduce((v,L)=>(v[L.id]=L,v),{}),D=j==null?void 0:j.map(v=>{var L,se;return{...v,isActive:((L=E[v.id])==null?void 0:L.newStatus)??v.isActive,description:((se=E[v.id])==null?void 0:se.description)??v.description}});x(D)},[I,m,y]);return l.useEffect(()=>{F()},[I,s,F]),l.useEffect(()=>{const j=Ue().subscribeChanges(C=>g({...C}));return()=>{j.unsubscribe()}},[]),[xe,h,{data:d,isFetching:Z,isLoading:ee,total:u.current,page:s,isFetched:_e,rowsPerPage:c,isRefetching:te}]},oa=()=>{const[n,t]=l.useState(!1);return[l.useCallback(async a=>{t(!0);const r=await S.rulesStatus.toArray(),i=a?r.filter(({id:o})=>a[Number(o)]):r;await H.postNewStatus(i),await S.rulesStatus.clear(),await $e.invalidateQueries({queryKey:["rules"]}),xe(1),t(!1)},[]),n]},la=()=>{const[n,t]=l.useState(!1);return[l.useCallback(async()=>{t(!0),await S.rulesStatus.clear(),await $e.invalidateQueries({queryKey:["rules"]}),xe(1),t(!1)},[]),n]},yt=l.memo(function({body:t,header:s,footer:a,stickyHeader:r=!0}){return e.jsxs(Ls,{sx:{my:4,background:"transparent"},children:[e.jsx(cs,{sx:{maxHeight:"80vh"},children:e.jsxs(us,{stickyHeader:r,children:[e.jsx(ds,{children:s}),e.jsx(hs,{sx:{backgroundColor:({palette:i})=>i.mode===re.DARK?i.grey[800]:i.grey[300]},children:t}),a&&t&&e.jsx(gs,{children:a})]})}),!t&&e.jsx("div",{children:"asdsadsadsda"})]})}),tt=[{resource:"key",label:"Codigo"},{resource:"name",label:"Regla"},{resource:"newStatus",label:"Estado local"}],bt=()=>{const[n]=oa(),[t,s]=l.useState(!1),[a,r]=l.useState([]),i=l.useRef({}),[o,c]=l.useState(!1),h=l.useCallback(()=>{s(!1)},[]),u=l.useCallback(()=>{const{current:g}=i,m=Object.values(g).length?g:void 0;n(m),h()},[n,h]),d=l.useCallback(async()=>{const g=await S.getRulesToUpdate(),m=await H.getConflicts(g);if(r(m),m!=null&&m.length)return s(!0);u()},[u]),x=l.useCallback((g,m)=>{if(m.target.checked)return i.current[g]=!0;delete i.current[g]},[]),y=l.useCallback(g=>{c(g.target.checked)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{onClick:d,children:[e.jsx(fe,{children:e.jsx(Te,{fontSize:"small"})}),e.jsx(je,{children:"Sincronizar"})]}),e.jsxs(ms,{onClose:h,open:t,children:[e.jsx(ps,{children:"Hay conflictos"}),e.jsxs(xs,{children:[e.jsx(yt,{header:e.jsxs(J,{children:[e.jsx(_,{children:e.jsx(Ye,{checked:o,onChange:y})}),tt.map(({label:g})=>e.jsx(_,{children:g},g))]}),body:e.jsx(e.Fragment,{children:a==null?void 0:a.map(g=>e.jsxs(J,{children:[e.jsx(_,{children:e.jsx(Ye,{disabled:o,onChange:m=>x(g.id,m)})}),tt.map(m=>e.jsx(_,{id:`${g.id}-${m.label}`,children:typeof g[m.resource]=="boolean"?g[m.resource]?"Activo":"Inactivo":g[m.resource]}))]},g.id))})}),e.jsx(fs,{children:e.jsx(N,{onClick:u,startIcon:e.jsx(Te,{}),children:"Sincronizar"})})]})]})]})},ca=()=>H.getAllLanguages(),ua=()=>{var a;const n=$s.useLiveQuery(()=>S.rulesStatus.toArray()),{data:t}=Ce({queryKey:["languages"],queryFn:ca}),s=l.useMemo(()=>ze(t,"id","name"),[t]);return e.jsx(Fn,{icon:Ae(!(n!=null&&n.length),e.jsx(zt,{}),e.jsx(Bt,{})),textButton:e.jsx(p,{children:Ae(!!(n!=null&&n.length),"Tienes cambios sin sincronizar","No hay cambios sin sincronizar")}),buttonProps:{variant:"contained"},popoverBody:e.jsx(js,{children:t&&e.jsxs(ys,{children:[(a=n==null?void 0:n.filter(({languageId:r},i,o)=>o.findIndex(({languageId:c})=>c===r)===i))==null?void 0:a.map(({languageId:r},i)=>e.jsx(f,{direction:"row",children:e.jsx(Y,{label:s[r]})},i)),e.jsx(bs,{children:e.jsx(bt,{})})]})})})},da="_header_181un_1",ha="_bg_181un_6",ga="_title_181un_10",ma="_logo_181un_15",oe={header:da,bg:ha,title:ga,logo:ma},pa=()=>{const n=ht(),{palette:t}=ut(),s=l.useContext(mt),{isLogged:a,user:r}=l.useContext(q),[i,o]=l.useState(null),c=l.useContext(q),h=l.useCallback(()=>s.toggleColorMode(),[s]),u=l.useCallback(({currentTarget:x})=>{o(x)},[]),d=l.useCallback(()=>{o(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(Cs,{position:"sticky",className:oe.header,children:[e.jsx(pe.LazyLoadImage,{src:"BannerDegrade.webp",style:{background:"green",top:"0"},className:oe.bg,effect:"blur"}),e.jsx(Ee,{sx:{py:2},children:e.jsxs(vs,{disableGutters:!0,sx:{justifyContent:"space-between"},children:[e.jsxs(b,{gap:{xs:0,sm:1},className:oe.title,children:[e.jsxs(b,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(pe.LazyLoadImage,{src:"logo.webp",effect:"blur",alt:"logo de pacifico",className:oe.logo,style:{display:"flex"}}),e.jsx(p,{variant:"h6",fontWeight:900,fontSize:{xs:"1.4rem",sm:"1.6rem"},children:"Sonardash"})]}),e.jsx(p,{variant:"body1",children:"/ Gestión de Reglas"})]}),a&&e.jsx(ua,{}),e.jsxs(f,{direction:"row",justifyContent:"center",alignItems:"center",children:[(t==null?void 0:t.mode)===re.DARK?e.jsx(Ut,{}):e.jsx(Qt,{}),e.jsx(De,{color:"warning",onChange:h}),a&&e.jsx(N,{sx:{borderRadius:"50%"},onClick:u,children:e.jsx(dt,{sx:{width:40,height:40},variant:"circular",children:r==null?void 0:r.email[0]})})]})]})})]}),e.jsx(Oe,{open:!!i,anchorEl:i,onClose:d,children:e.jsx(lt,{children:e.jsxs(k,{onClick:()=>{c.logOut(),d(),n("home")},children:[e.jsx(fe,{children:e.jsx($t,{})}),e.jsx(je,{children:"Log out"})]})})})]})},xa=()=>{const{data:n,isLoading:t}=Ce({queryKey:["languages"],queryFn:()=>H.getAllLanguages()});return{data:n,isLoading:t}},Ct=n=>{const{data:t,isFetching:s}=Ce({queryKey:["qualityprofile",n],queryFn:()=>H.getQualityProfilesByLanguage(n),enabled:!!n});return{data:t,isFetching:s}},vt=({className:n,handleChange:t,inputProps:s,includeAllOption:a,displayEmpty:r})=>{const{data:i,isLoading:o}=xa();return e.jsx(P,{sx:{width:200},className:n,children:o?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[e.jsx(T,{id:"language",children:"Lenguaje"}),e.jsxs(ye,{inputProps:s,labelId:"language",label:"Lenguaje",onChange:t,sx:{width:200},defaultValue:a?"all":"",displayEmpty:r,children:[a&&e.jsx(k,{value:"all",children:"Todos"}),i==null?void 0:i.map(({id:c,name:h})=>e.jsx(k,{value:c,children:h},c))]})]})})},fa=()=>{const{setIsOpen:n,isOpen:t}=Ks(),s=l.useCallback(a=>{qn(a.target.value)},[]);return l.useEffect(()=>{const a=dn();n(a)},[n]),l.useEffect(()=>{cn("body",t==null?void 0:t.valueOf())},[t]),e.jsx(vt,{className:"language",handleChange:s,displayEmpty:!0})},ja=()=>{const n=Qe(),t=l.useRef(null),{data:s,isFetching:a}=Ct(n);l.useEffect(()=>{var i;Ze(((i=t.current)==null?void 0:i.value)??"")},[n]);const r=l.useCallback(i=>{Ze(i.target.value)},[]);return a?e.jsx(be,{}):e.jsxs(P,{className:"mainFilters",sx:{width:200},children:[e.jsx(T,{id:"qualityprofile",children:"Quality Profile"}),e.jsx(ye,{ref:t,onChange:r,label:"Quality Profile",labelId:"qualityprofile",defaultValue:"",displayEmpty:!0,children:s==null?void 0:s.map(({id:i,name:o})=>e.jsx(k,{value:i,children:o},i))})]})},ya=({value:n,label:t,reactiveCb:s})=>{const a=l.useCallback(()=>{s(n)},[s,n]);return e.jsx(k,{onClick:a,children:t})},Ve=({filterConfig:n,reactiveCallback:t,isClosingRecursive:s})=>{const[a,r]=l.useState(null),[i,o]=l.useState(!0),c=l.useCallback(d=>{t(d),o(d==="all"),s&&r(null)},[s,t]),h=l.useCallback(()=>{r(null)},[]),u=l.useCallback(d=>{d.preventDefault(),r(d.currentTarget)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(V,{onClick:u,sx:{padding:"1px !important"},children:e.jsx(ws,{variant:"dot",invisible:i,color:"secondary",children:e.jsx(Vt,{sx:{color:"#e4a010"}})})}),e.jsx(Oe,{anchorEl:a,onClose:h,open:!!a,children:n.map(({value:d,label:x})=>e.jsx(ya,{label:x,value:d,reactiveCb:c}))})]})};var wt=(n=>(n.Blocker="BLOCKER",n.Critical="CRITICAL",n.Info="INFO",n.Major="MAJOR",n.Minor="MINOR",n))(wt||{}),_t=(n=>(n.Bug="BUG",n.CodeSmell="CODE_SMELL",n.SecurityHotspot="SECURITY_HOTSPOT",n.Vulnerability="VULNERABILITY",n))(_t||{});const St=[{value:"all",label:"Todos"},...Object.values(_t).map(n=>({value:n,label:n}))],kt=[{value:"all",label:"Todos"},...Object.values(wt).map(n=>({value:n,label:n}))],It=[{value:"all",label:"Todos"},{value:"active",label:"Activo"},{value:"deactive",label:"Inactivo"}],ba=Object.freeze({all:null,active:!0,deactive:!1}),Ca=()=>{const n=l.useCallback(t=>{$n(ba[t])},[]);return e.jsx(Ve,{filterConfig:It,isClosingRecursive:!0,reactiveCallback:n})},va=()=>{const n=l.useCallback(t=>{Wn(t)},[]);return e.jsx(Ve,{filterConfig:kt,isClosingRecursive:!0,reactiveCallback:n})},wa=()=>{const n=l.useCallback(t=>zn(t),[]);return e.jsx(Ve,{filterConfig:St,isClosingRecursive:!0,reactiveCallback:n})},ae=[{label:"",especialConfig:!0,resource:"htmlDesc"},{label:"Código",resource:"key",textAlign:"left"},{label:"Regla",resource:"name",textAlign:"left"},{label:"Tipo",resource:"type",filter:e.jsx(wa,{}),textAlign:"left"},{label:"Severidad",resource:"severity",textAlign:"left",filter:e.jsx(va,{})},{label:"E. Actual",resource:"isActiveSonar",especialConfig:!0,className:"actualState",textAlign:"left",filter:e.jsx(Ca,{}),sxProps:{minWidth:100}},{label:"E. Propuesto",resource:"isActive",especialConfig:!0,className:"proposedState",sxProps:{minWidth:100}},{label:"Propuesta",resource:"updated_at",especialConfig:!0,icon:e.jsx(Ht,{sx:{color:n=>n.palette.common.white}})},{label:"Autor",resource:"user_email",sxProps:{width:150}}],_a=l.memo(({data:n})=>e.jsx(e.Fragment,{children:e.jsx(J,{children:n.map(({label:t,icon:s,filter:a,className:r,sxProps:i})=>e.jsx(_,{variant:"head",className:r,sx:{background:o=>`${o.palette.grey[900]} !important`,...i},children:e.jsxs(f,{direction:"row",gap:.5,alignItems:"center",justifyContent:"space-between",children:[e.jsx(p,{sx:{color:o=>o.palette.common.white},fontWeight:700,children:t}),s,a]})},t))})}));function Sa({initialStatus:n,result:t,id:s}){const[a,r]=l.useState(!1),[i,o]=l.useState(n),{user:c}=l.useContext(q);l.useEffect(()=>{o(n)},[n]),l.useEffect(()=>{S.rulesStatus.get(Number(s)).then(d=>r(!!d))},[s]);const h=t.isActiveOriginal!==i;l.useEffect(()=>{a&&t.isActiveOriginal===i&&S.rulesStatus.delete(Number(s))},[i,s,a,t.isActiveOriginal]);const u=l.useCallback(async d=>{o(d.target.checked);const x=await S.rulesStatus.get(Number(s));(!a||t.isActiveOriginal!==d.target.checked)&&await S.rulesStatus.put({...x,id:Number(s),newStatus:d.target.checked,updated_at:new Date,languageId:t.lang_id,qualityProfileId:Number(t.qualityProfile_id),user_email:c==null?void 0:c.email}),r(!0)},[s,a,t.isActiveOriginal,t.lang_id,t.qualityProfile_id,c==null?void 0:c.email]);return e.jsxs(f,{direction:"row",alignItems:"center",children:[e.jsx(p,{minWidth:60,children:i?"Activo":"Inactivo"}),e.jsx(De,{onChange:u,checked:i}),a&&h?e.jsx(Te,{}):""]})}function ka(n){const{tags:t,isActive:s,dateSonar:a,ruleTitle:r,ruleDescription:i}=n;return e.jsxs(b,{children:[e.jsxs(f,{padding:2,direction:"column",spacing:2,children:[e.jsxs(f,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:[e.jsx(Y,{sx:{backgroundColor:({palette:o})=>o.mode===re.DARK?o.grey[900]:o.grey[800],color:"white"},label:`Regla ${s?"activo":"inactivo"} desde:`}),e.jsx(Y,{label:`${a??"Sin info"}`})]}),e.jsx(f,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:t.map(o=>e.jsx(Y,{label:o},o))})]}),e.jsx(f,{direction:"row",justifyContent:"flex-start",alignItems:"center",padding:2,pb:0,children:e.jsx(Ne,{title:r,children:e.jsx(Y,{color:"secondary",label:e.jsx(p,{noWrap:!0,variant:"h5",children:r})})})}),e.jsxs(f,{direction:"column",justifyContent:"center",padding:2,children:[e.jsx(f,{direction:"row",justifyContent:"flex-start",children:e.jsx(Y,{label:"Descripción de la Regla",sx:{backgroundColor:({palette:o})=>o.mode===re.DARK?o.grey[900]:o.grey[800],color:"white"}})}),e.jsx(p,{dangerouslySetInnerHTML:{__html:i}})]})]})}var He={},Pt={exports:{}};(function(n){function t(s){return s&&s.__esModule?s:{default:s}}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports})(Pt);var Tt=Pt.exports,Pe={};const Ia=ts(Wt);var st;function Lt(){return st||(st=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=Ia}(Pe)),Pe}var Pa=Tt;Object.defineProperty(He,"__esModule",{value:!0});var Rt=He.default=void 0,Ta=Pa(Lt()),La=e,Ra=(0,Ta.default)((0,La.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"}),"History");Rt=He.default=Ra;function Aa({comments:n}){return e.jsx(Rs,{sx:{[`& .${As.root}:before`]:{flex:0,padding:0}},children:n.map(t=>e.jsxs(Ms,{children:[e.jsxs(Fs,{children:[e.jsx(Es,{color:"primary",children:e.jsx(Rt,{})}),e.jsx(Ds,{})]}),e.jsx(Os,{children:e.jsxs(b,{sx:{textAlign:"left"},children:[e.jsx(p,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:"bold",color:"black"},children:t.timestamp}),e.jsx(p,{variant:"body1",children:t.author}),e.jsx(p,{variant:"body1",children:t.content})]})})]},t.id))})}var We={},Ma=Tt;Object.defineProperty(We,"__esModule",{value:!0});var At=We.default=void 0,Fa=Ma(Lt()),Ea=e,Da=(0,Fa.default)((0,Ea.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");At=We.default=Da;const Mt=({title:n,result:t})=>{const{user:s}=l.useContext(q),a=Xs(async({target:i})=>await S.saveDescription({...t,user_email:s==null?void 0:s.email},i.value),500),r=()=>{};return e.jsxs(e.Fragment,{children:[e.jsx(p,{sx:{fontStyle:"italic",fontWeight:900},children:"Sustento de la propuesta"}),e.jsx(_s,{multiline:!0,fullWidth:!0,defaultValue:t.description,title:n,placeholder:"Esta regla aún no ha tenido observaciones",onChange:a}),e.jsx(Ne,{title:"Editar propuesta",children:e.jsx(V,{onClick:r,sx:{background:({palette:i})=>i.primary.light,zIndex:500},children:e.jsx(At,{})})})]})},Oa=[{tab:"description",content:({result:n})=>e.jsx(ka,{tags:[n.severity,n.type],isActive:n.isActive,ruleTitle:n.name,ruleDescription:n.htmlDesc})},{tab:"history",content:()=>{const n=xn(8);return e.jsxs(b,{height:"100%",display:"flex",flexDirection:"column",children:[e.jsx(b,{flexGrow:1,overflow:"auto",flexBasis:"75%",children:e.jsx(Aa,{comments:n})}),e.jsx(le,{}),e.jsx(b,{height:"30%",overflow:"auto",p:2,children:e.jsx(f,{direction:"row",pr:2,children:e.jsx(Mt,{result:{id:"1",created_at:new Date,isActive:!0,isActiveSonar:!1,qualityProfile_id:"profile-id",rule_id:"rule-id",updated_at:new Date,key:"rule-key",lang_id:"language-id",name:"rule-name",user_email:"user@example.com"},title:"Sustento de la propuesta"})})})]})}}],Na=({isDrawerOpen:n,setIsDrawerOpen:t,result:s})=>{const[a,r]=l.useState("");l.useEffect(()=>{n||r("")},[n]);const i=u=>{u.stopPropagation(),t(!n),a==="description"&&r("")},o=(u,d)=>{r(d)},c=u=>{u.stopPropagation()},h=Oa.find(u=>u.tab===a);return e.jsxs(ct,{anchor:"right",open:n,onClose:i,onClick:c,PaperProps:{style:{width:"42.5%"}},children:[e.jsxs(Ns,{value:a,onChange:o,variant:"fullWidth","aria-label":"Drawer tabs",children:[e.jsx(Ke,{label:"Descripción de Reglas",value:"description"}),e.jsx(Ke,{label:"Historial de Cambios",value:"history"})]}),h&&h.content({result:s})]})};var Ft={exports:{}};(function(n,t){(function(s,a){n.exports=a()})(Fe,function(){return function(s,a,r){r.updateLocale=function(i,o){var c=r.Ls[i];if(c)return(o?Object.keys(o):[]).forEach(function(h){c[h]=o[h]}),c}}})})(Ft);var qa=Ft.exports;const Ba=it(qa);var Et={exports:{}};(function(n,t){(function(s,a){n.exports=a()})(Fe,function(){return function(s,a,r){s=s||{};var i=a.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function c(u,d,x,y){return i.fromToBase(u,d,x,y)}r.en.relativeTime=o,i.fromToBase=function(u,d,x,y,g){for(var m,I,Z,ee=x.$locale().relativeTime||o,te=s.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],_e=te.length,F=0;F<_e;F+=1){var j=te[F];j.d&&(m=y?r(u).diff(x,j.d,!0):x.diff(u,j.d,!0));var C=(s.rounding||Math.round)(Math.abs(m));if(Z=m>0,C<=j.r||!j.r){C<=1&&F>0&&(j=te[F-1]);var E=ee[j.l];g&&(C=g(""+C)),I=typeof E=="string"?E.replace("%d",C):E(C,d,j.l,Z);break}}if(d)return I;var D=Z?ee.future:ee.past;return typeof D=="function"?D(I):D.replace("%s",I)},i.to=function(u,d){return c(u,d,this,!0)},i.from=function(u,d){return c(u,d,this)};var h=function(u){return u.$u?r.utc():r()};i.toNow=function(u){return this.to(h(this),u)},i.fromNow=function(u){return this.from(h(this),u)}}})})(Et);var za=Et.exports;const Ua=it(za);var Qa={exports:{}};(function(n,t){(function(s,a){n.exports=a(Js)})(Fe,function(s){function a(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var r=a(s),i={name:"es",monthsShort:"ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),weekStart:1,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:function(o){return o+"º"}};return r.default.locale(i,null,!0),i})})(Qa);X.extend(Ba);X.locale("es");X.extend(Ua);X.updateLocale("es",{relativeTime:{future:"en %s",past:"hace %s",s:"1 s",m:"1 min",mm:"%d min",h:"1 h",hh:"%d h",d:"1 d",dd:"%d d",M:"1 M",MM:"%d M",y:"1 Y",yy:"%d Y"}});const $a=n=>X(n).from(new Date),Va=({resource:n,value:t,result:s,secondaryValue:a})=>{const[r,i]=l.useState(!1),o=()=>{i(!r)};return n==="isActiveSonar"?e.jsx(p,{children:t?"Activo":"Inactivo"}):n==="htmlDesc"?e.jsxs(e.Fragment,{children:[e.jsx(V,{onClick:o,children:e.jsx(at,{})}),e.jsx(Na,{isDrawerOpen:r,setIsDrawerOpen:i,result:s})]}):n==="updated_at"?Math.abs(X(String(t)).diff(a,"hours"))>6?e.jsx(p,{align:"left",children:$a(String(t))}):e.jsx(p,{align:"left",children:"--"}):e.jsx(Sa,{initialStatus:!!t,result:s,id:s.id})},Ha=({colSpan:n})=>e.jsx(_,{colSpan:n,children:e.jsx(b,{display:"grid",sx:{placeContent:"center",minHeight:400},children:e.jsx(be,{})})}),Wa=({icon:n,primaryText:t,secondaryText:s})=>e.jsxs(f,{direction:"column",justifyContent:"center",alignItems:"center",minHeight:"50vh",sx:{fontSize:100},gap:8,children:[n,e.jsxs(f,{direction:"column",gap:4,children:[e.jsx(p,{color:"GrayText",variant:"h3",children:t}),s&&e.jsx(p,{textAlign:"center",color:"GrayText",variant:"body1",children:s})]})]}),Ya=({hasContent:n,children:t,colSpan:s})=>n?e.jsx(e.Fragment,{children:t}):e.jsx(J,{children:e.jsx(_,{colSpan:s,children:e.jsx(Wa,{icon:e.jsx(Yt,{color:"disabled",fontSize:"inherit"}),primaryText:"Sin datos",secondaryText:"Selecciona filtros"})})}),Ka=({children:n,collapseContent:t,colSpan:s})=>{const[a,r]=l.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(J,{sx:{cursor:"pointer",":hover":{backgroundColor:({palette:i})=>i.grey[400]}},onClick:()=>{r(i=>!i)},children:n}),e.jsxs(J,{children:[e.jsx(_,{padding:a?"normal":"none",colSpan:2}),e.jsx(_,{colSpan:s,padding:a?"normal":"none",children:e.jsx(qs,{in:a,children:t})})]})]})};function Ga(){const[n,t,{data:s,isFetching:a,total:r,page:i,rowsPerPage:o}]=ia(),c=l.useCallback((u,d)=>{u&&n(d+1)},[n]),h=l.useCallback(u=>{t(parseInt(u.target.value,10)),n(1)},[n,t]);return e.jsxs(e.Fragment,{children:[e.jsx(yt,{body:a?e.jsx(Ha,{colSpan:ae.length}):e.jsx(Ya,{hasContent:!!(s!=null&&s.length),colSpan:ae.length,children:a?[]:s==null?void 0:s.map(u=>e.jsx(Ka,{colSpan:ae.length-2,collapseContent:e.jsx(f,{direction:"row",pr:2,children:e.jsx(Mt,{result:u,title:`${u.id}-comments`})}),children:ae.map(({resource:d,especialConfig:x,textAlign:y})=>x?e.jsx(_,{sx:{textAlign:y??"center"},children:e.jsx(Va,{result:u,resource:d,secondaryValue:u.created_at,value:u[d]??"--"})},d+u.id):e.jsx(_,{sx:{textAlign:y??"center",maxWidth:140},children:e.jsx(Ne,{title:String(u[d]??"--"),children:e.jsx(p,{noWrap:!0,sx:{...d==="key"?{width:60}:{}},children:mn(String(u[d]??"--"),d==="key")})})},d+u.id))},u.id))}),header:e.jsx(_a,{data:ae})}),e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(Ss,{rowsPerPage:o,count:r??1e3,page:i-1,onPageChange:c,onRowsPerPageChange:h,labelRowsPerPage:"Filas por página"})})]})}const Ja=({content:n})=>e.jsx("div",{style:{position:"sticky",bottom:20,left:"90vw",width:40,display:"flex",justifyContent:"flex-end",zIndex:500},children:n}),Xa=({label:n,labelId:t,inputProps:s,config:a})=>e.jsx(ye,{labelId:t,label:n,sx:{width:200},defaultValue:"all",displayEmpty:!0,inputProps:s,children:a==null?void 0:a.map(({value:r,label:i})=>e.jsx(k,{value:r,children:i},i))}),Za=[{id:"type-uncontrolled",label:"Type",registerField:"type",config:St},{id:"severity-uncontrolled",label:"Severity",registerField:"severity",config:kt},{id:"state-uncontrolled",label:"State",registerField:"state",config:It}],er=({handleChanges:n,text:t,inputProps:s,includeAllOptions:a})=>{const{data:r,isFetching:i}=Ct(t==="all"?"":t);if(i)return e.jsx(be,{});const[o]=r??[];return e.jsxs(P,{sx:{width:200},children:[e.jsx(T,{id:"qualityProfile-uncontrolled",children:"Quality Profile"}),e.jsxs(ye,{inputProps:s,onChange:n,label:"Quality Profile",labelId:"qualityProfile-uncontrolled",defaultValue:a?"all":o==null?void 0:o.id,children:[a&&e.jsx(k,{value:"all",children:"Todos"}),r==null?void 0:r.map(({id:c,name:h})=>e.jsx(k,{value:c,children:h},c))]})]})},tr=({handleClose:n,isOpen:t})=>{const{register:s,handleSubmit:a}=qe(),[r,i]=l.useState(),[o,c]=l.useState(!0),h=l.useCallback(async d=>await Ue().downloadReport({lang_id:d.language_id,qualityProfile_id:d.qualityProfile_id,severity:d.severity,type:d.type,isActiveSonar:d.state},d.showOnlyIsActiveDifferences),[]),u=l.useCallback(d=>{i(d.target.value)},[]);return e.jsx(ct,{variant:"persistent",onClose:n,anchor:"right",open:t,children:e.jsx(f,{sx:{minWidth:400},component:"form",onSubmit:a(h),children:e.jsxs(lt,{children:[e.jsx(ne,{children:e.jsx(ks,{control:e.jsx(De,{...s("showOnlyIsActiveDifferences"),checked:!o,onChange:d=>c(!d.target.checked)}),label:"Solo estados propuestos"})}),e.jsx(le,{}),e.jsx(ne,{children:e.jsx(vt,{includeAllOption:o,inputProps:s("language_id"),className:"generic-filter-uncontrolled",handleChange:u})}),e.jsx(ne,{children:e.jsx(er,{includeAllOptions:o,text:r,inputProps:s("qualityProfile_id")})}),o&&e.jsxs(e.Fragment,{children:[e.jsx(le,{}),Za.map(({id:d,label:x,registerField:y,config:g})=>e.jsx(ne,{children:e.jsxs(P,{sx:{width:200},children:[e.jsx(T,{id:d,children:x}),e.jsx(Xa,{config:g,label:x,labelId:d,inputProps:s(y)})]})},d+x))]}),e.jsx(le,{}),e.jsx(ne,{children:e.jsx(N,{type:"submit",variant:"contained",startIcon:e.jsx(rt,{}),sx:{width:"100%"},children:"Descargar"})})]})})})},sr=()=>{const[n,t]=l.useState(!1),s=l.useCallback(()=>{t(!0)},[]),a=l.useCallback(()=>{t(!1)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{onClick:s,children:[e.jsx(fe,{children:e.jsx(rt,{})}),e.jsx(je,{children:"Descarga Personalizada"})]}),e.jsx(tr,{handleClose:a,isOpen:n})]})},nr=()=>{const[n]=la();return e.jsxs(k,{onClick:n,children:[e.jsx(fe,{children:e.jsx(Kt,{fontSize:"small"})}),e.jsx(je,{children:"Restaurar"})]})},ar=()=>{const[n,t]=l.useState(null),s=l.useRef(null),a=sa(),r=l.useCallback(()=>{t(null)},[]);l.useEffect(()=>{t(a?s.current:null)},[a]);const i=l.useCallback(({currentTarget:o})=>{t(o)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(en,{children:e.jsx(V,{ref:s,onClick:i,sx:{background:({palette:o})=>o.secondary.main,zIndex:500},className:"dragableMenu",children:e.jsx(Gt,{fontSize:"large"})})}),e.jsxs(Oe,{className:"menuDragable",anchorEl:n,open:!!n,onClose:r,children:[e.jsx(bt,{}),e.jsx(sr,{}),e.jsx(nr,{})]})]})},rr=()=>{const n=Qe(),t=jt(),[s,a]=l.useState(),[r]=Zs(s,1e3),i=l.useMemo(()=>n&&t,[n,t]),o=l.useCallback(({target:c})=>{a(c.value)},[]);return l.useEffect(()=>{a(""),et()},[n,t]),l.useEffect(()=>{et(r)},[r]),e.jsx(Is,{value:s,disabled:!i,onChange:o,startAdornment:e.jsx(Jt,{})})};function ir(){return e.jsxs(Ee,{children:[e.jsxs(b,{display:"flex",flexDirection:"column",gap:2,pt:6,pb:2,children:[e.jsxs(b,{display:"flex",gap:1.5,children:[e.jsx(Xt,{}),e.jsx(p,{fontSize:{xs:"16px",md:"17px"},children:"Activa o desactiva los switches dependiendo si deseas habilitar la regla o no"})]}),e.jsxs(b,{display:"flex",gap:1.5,children:[e.jsx(Zt,{}),e.jsx(p,{fontSize:{xs:"16px",md:"17px"},children:"Recuerda que los estados que propongas no se aplicarán de inmediato en SonarQube"})]})]}),e.jsx(f,{direction:"column",gap:4,marginTop:4,children:e.jsxs(b,{display:"flex",gap:4,children:[e.jsx(fa,{}),e.jsx(ja,{}),e.jsx(rr,{})]})}),e.jsx(Ga,{}),e.jsx(Ja,{content:e.jsx(ar,{})})]})}const or=()=>{const{isLogged:n}=l.useContext(q);return e.jsxs(zs,{children:[e.jsx(pa,{}),e.jsxs(Us,{children:[e.jsx(ie,{path:"/",element:n?e.jsx(Ge,{to:"/admin"}):e.jsx(Ge,{to:"/home"})}),e.jsx(ie,{path:"/home",element:e.jsx(Pn,{})}),n&&e.jsx(ie,{path:"/admin",element:e.jsx(ir,{})}),e.jsx(ie,{path:"*",element:e.jsx(An,{})})]})]})};function lr(){return e.jsx(b,{display:"flex",flexDirection:"column",minHeight:"100vh",children:e.jsx(as,{children:e.jsx(an,{children:e.jsx(or,{})})})})}const cr="pacifico.dev.com",ur=({children:n})=>{const[t,s]=l.useState(!1),[a,r]=l.useState(!0);l.useEffect(()=>{B.checkAuth().then(o=>{var c;s(!!((c=o==null?void 0:o.user)!=null&&c.id))}).finally(()=>{r(!1)})},[]);const i=l.useMemo(()=>({isLogged:t,isLoading:a,user:B.user,async login(o,c){const h=await B.login(o,c);return s(!0),h},async checkAuth(o,c){return await B.checkAuth(o,c)},async singUp(o){await B.singUp(o)},async logOut(){await B.logOut(),s(!1)}}),[t,a]);return e.jsx(q.Provider,{value:i,children:n})};tn("ctrl+m",n=>{n.preventDefault(),ta(!0)});window.woopra.config({domain:cr,outgoing_tracking:!0,download_tracking:!0,click_tracking:!0}),window.woopra.track();Re.createRoot(document.getElementById("root")).render(e.jsx(ss.StrictMode,{children:e.jsx(Gs,{steps:[{selector:".language",content:"Selecciona el lenguaje de programación del cual deseas consultar reglas."},{selector:".mainFilters",content:"Ahora procede a seleccionar el perfil a consultar"},{selector:".actualState",content:"Este es el estado actual de la regla en Sonarqube. Las reglas activas son las que analizan los repositorios."},{selector:".proposedState",content:"Aquí podrás proponer si una regla debe estar activada o desactivada, recuerda que tu propuesta no se verá reflejada en SonarQube inmediatamente."},{selector:".dragableMenu",content:e.jsxs(p,{children:["Las opciones de descarga y guardado se encuentran en este botón. Si no lo encuentras rápido, ubícalo con ",e.jsx("kbd",{children:"ctrl"})," +"," ",e.jsx("kbd",{children:"m"}),", ¡también lo puedes mover por toda la pantalla!"]})}],children:e.jsx(ur,{children:e.jsx(Ys,{client:$e,children:e.jsx(lr,{})})})})}));
