import{r as l}from"./vendor-207237f2.js";var T=l.createContext(null);T.Consumer;var w=function(e,t){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(o[r]=n[r])},w(e,t)};function U(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");w(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}var f=function(){return f=Object.assign||function(t){for(var o,n=1,r=arguments.length;n<r;n++){o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])}return t},f.apply(this,arguments)};/*! js-cookie v3.0.5 | MIT */function S(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)e[n]=o[n]}return e}var A={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function x(e,t){function o(r,s,i){if(!(typeof document>"u")){i=S({},t,i),typeof i.expires=="number"&&(i.expires=new Date(Date.now()+i.expires*864e5)),i.expires&&(i.expires=i.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var h="";for(var u in i)i[u]&&(h+="; "+u,i[u]!==!0&&(h+="="+i[u].split(";")[0]));return document.cookie=r+"="+e.write(s,r)+h}}function n(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var s=document.cookie?document.cookie.split("; "):[],i={},h=0;h<s.length;h++){var u=s[h].split("="),m=u.slice(1).join("=");try{var c=decodeURIComponent(u[0]);if(i[c]=e.read(m,c),r===c)break}catch{}}return r?i[r]:i}}return Object.create({set:o,get:n,remove:function(r,s){o(r,"",S({},s,{expires:-1}))},withAttributes:function(r){return x(this.converter,S({},this.attributes,r))},withConverter:function(r){return x(S({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}})}var a=x(A,{path:"/"}),_=function(){function e(t,o,n,r,s){this.authStorageType=o,this.authStorageName=t,this.authTimeStorageName="".concat(t,"_storage"),this.stateStorageName="".concat(t,"_state"),this.refreshTokenName=n,this.cookieDomain=r,this.cookieSecure=s,this.authStorageTypeName="".concat(this.authStorageName,"_type"),this.isUsingRefreshToken=!!this.refreshTokenName,this.refreshTokenTimeName=this.refreshTokenName?"".concat(this.refreshTokenName,"_time"):null}return e.prototype.initialToken=function(){return this.authStorageType==="cookie"?this.initialCookieToken_():this.initialLSToken_()},e.prototype.initialCookieToken_=function(){var t=a.get(this.authStorageName),o=a.get(this.authStorageTypeName),n=a.get(this.authTimeStorageName),r=a.get(this.stateStorageName),s=this.isUsingRefreshToken&&this.refreshTokenName!=null?a.get(this.refreshTokenName):null,i=this.isUsingRefreshToken&&this.refreshTokenTimeName!=null?a.get(this.refreshTokenTimeName):null;return this.checkTokenExist(t,o,n,r,s,i)},e.prototype.initialLSToken_=function(){var t=localStorage.getItem(this.authStorageName),o=localStorage.getItem(this.authStorageTypeName),n=localStorage.getItem(this.authTimeStorageName),r=localStorage.getItem(this.stateStorageName),s=this.isUsingRefreshToken&&this.refreshTokenName!=null?localStorage.getItem(this.refreshTokenName):null,i=this.isUsingRefreshToken&&this.refreshTokenTimeName!=null?localStorage.getItem(this.refreshTokenTimeName):null;return this.checkTokenExist(t,o,n,r,s,i)},e.prototype.checkTokenExist=function(t,o,n,r,s,i){if(t&&o&&n&&r){var h=new Date(n);try{var u=JSON.parse(r),m={auth:{token:t,type:o,expiresAt:h},userState:u,isSignIn:!0,isUsingRefreshToken:this.isUsingRefreshToken,refresh:void 0};if(this.isUsingRefreshToken&&s&&i){var c=new Date(i);return f(f({},m),{refresh:{token:s,expiresAt:c}})}else return f(f({},m),{refresh:null})}catch{return{auth:null,refresh:null,userState:null,isUsingRefreshToken:this.isUsingRefreshToken,isSignIn:!1}}}else return{auth:null,refresh:null,userState:null,isUsingRefreshToken:this.isUsingRefreshToken,isSignIn:!1}},e.prototype.syncTokens=function(t){t.auth?this.isUsingRefreshToken&&t.refresh?this.setToken(t.auth.token,t.auth.type,t.refresh.token,t.refresh.expiresAt,t.auth.expiresAt,t.userState):this.setToken(t.auth.token,t.auth.type,null,null,t.auth.expiresAt,t.userState):this.removeToken()},e.prototype.setToken=function(t,o,n,r,s,i){this.authStorageType==="cookie"?this.setCookieToken_(t,o,n,s,r,i):this.setLSToken_(t,o,n,s,r,i)},e.prototype.setCookieToken_=function(t,o,n,r,s,i){a.set(this.authStorageName,t,{expires:r,domain:this.cookieDomain,secure:this.cookieSecure}),a.set(this.authStorageTypeName,o,{expires:r,domain:this.cookieDomain,secure:this.cookieSecure}),a.set(this.authTimeStorageName,r.toISOString(),{expires:r,domain:this.cookieDomain,secure:this.cookieSecure}),i&&a.set(this.stateStorageName,JSON.stringify(i),{expires:r,domain:this.cookieDomain,secure:this.cookieSecure}),this.isUsingRefreshToken&&this.refreshTokenName&&n&&a.set(this.refreshTokenName,n,{expires:r,domain:this.cookieDomain,secure:this.cookieSecure}),this.isUsingRefreshToken&&this.refreshTokenTimeName&&s&&a.set(this.refreshTokenTimeName,s.toISOString(),{expires:r,domain:this.cookieDomain,secure:this.cookieSecure})},e.prototype.setLSToken_=function(t,o,n,r,s,i){localStorage.setItem(this.authStorageName,t),localStorage.setItem(this.authStorageTypeName,o),localStorage.setItem(this.authTimeStorageName,r.toISOString()),i&&localStorage.setItem(this.stateStorageName,JSON.stringify(i)),this.isUsingRefreshToken&&this.refreshTokenName&&n&&localStorage.setItem(this.refreshTokenName,n),this.isUsingRefreshToken&&this.refreshTokenTimeName&&s&&localStorage.setItem(this.refreshTokenTimeName,s.toISOString())},e.prototype.removeToken=function(){this.authStorageType==="cookie"?this.removeCookieToken_():this.removeLSToken_()},e.prototype.removeCookieToken_=function(){a.remove(this.authStorageName,{domain:this.cookieDomain,secure:this.cookieSecure}),a.remove(this.authTimeStorageName,{domain:this.cookieDomain,secure:this.cookieSecure}),a.remove(this.authStorageTypeName,{domain:this.cookieDomain,secure:this.cookieSecure}),a.remove(this.stateStorageName,{domain:this.cookieDomain,secure:this.cookieSecure}),this.isUsingRefreshToken&&this.refreshTokenName&&a.remove(this.refreshTokenName,{domain:this.cookieDomain,secure:this.cookieSecure}),this.isUsingRefreshToken&&this.refreshTokenTimeName&&a.remove(this.refreshTokenTimeName,{domain:this.cookieDomain,secure:this.cookieSecure})},e.prototype.removeLSToken_=function(){localStorage.removeItem(this.authStorageName),localStorage.removeItem(this.authTimeStorageName),localStorage.removeItem(this.authStorageTypeName),localStorage.removeItem(this.stateStorageName),this.isUsingRefreshToken&&this.refreshTokenName&&localStorage.removeItem(this.refreshTokenName),this.isUsingRefreshToken&&this.refreshTokenTimeName&&localStorage.removeItem(this.refreshTokenTimeName)},e}(),k;(function(e){e[e.SignIn=0]="SignIn",e[e.SignOut=1]="SignOut",e[e.RefreshToken=2]="RefreshToken"})(k||(k={}));function O(e,t){switch(t.type){case k.SignIn:return f(f({},e),{auth:t.payload.auth,refresh:t.payload.refresh,userState:t.payload.userState,isSignIn:!0});case k.SignOut:return f(f({},e),{auth:null,refresh:null,userState:null,isSignIn:!1});case k.RefreshToken:return e.isSignIn&&e.auth&&e.refresh?f(f({},e),{auth:{token:t.payload.newAuthToken?t.payload.newAuthToken:e.auth.token,type:e.auth.type,expiresAt:t.payload.newAuthTokenExpireIn?new Date(new Date().getTime()+t.payload.newAuthTokenExpireIn*60*1e3):e.auth.expiresAt},refresh:{token:t.payload.newRefreshToken?t.payload.newRefreshToken:e.refresh.token,expiresAt:t.payload.newRefreshTokenExpiresIn?new Date(new Date().getTime()+t.payload.newRefreshTokenExpiresIn*60*1e3):e.refresh.expiresAt},userState:t.payload.newAuthUserState?t.payload.newAuthUserState:e.userState}):e}}function R(e){return{type:k.SignIn,payload:e}}function E(e){return{type:k.RefreshToken,payload:e}}function C(){return{type:k.SignOut}}function P(e,t){var o=l.useRef(e),n=l.useRef(null);return l.useEffect(function(){o.current=e},[e]),l.useEffect(function(){var r=function(){return o.current()};return typeof t=="number"&&(n.current=window.setInterval(r,t*60*1e3)),function(){n.current&&window.clearTimeout(n.current)}},[t]),n}var p=function(e){U(t,e);function t(o){return e.call(this,o)||this}return t}(Error),j=function(e){var t=e.children,o=e.authType,n=e.authName,r=e.cookieDomain,s=e.cookieSecure,i=e.refresh;if(o==="cookie"&&!r)throw new p("authType 'cookie' requires 'cookieDomain' and 'cookieSecure' props in AuthProvider");var h=i?"".concat(n,"_refresh"):null,u=new _(n,o,h,r,s),m=l.useReducer(O,u.initialToken()),c=m[0],g=m[1];return i&&P(function(){var d,v,y,N;i.refreshApiCallback({authToken:(d=c.auth)===null||d===void 0?void 0:d.token,authTokenExpireAt:(v=c.auth)===null||v===void 0?void 0:v.expiresAt,authUserState:c.userState,refreshToken:(y=c.refresh)===null||y===void 0?void 0:y.token,refreshTokenExpiresAt:(N=c.refresh)===null||N===void 0?void 0:N.expiresAt}).then(function(I){I.isSuccess&&g(E(I))}).catch(function(){})},c.isSignIn?i.interval:null),l.useEffect(function(){u.syncTokens(c)},[c]),l.createElement(T.Provider,{value:{authState:c,dispatch:g}},t)};function D(e){return e.auth?new Date(e.auth.expiresAt)>new Date:!1}/**
 *@author Arkadip Bhattacharya <in2arkadipb13@gmail.com>
 *@fileoverview Sign In functionality <hook>
 *@copyright Arkadip Bhattacharya 2020
 *@license Apache-2.0
 *
 * Copyright 2020 Arkadip Bhattacharya
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B(){var e=l.useContext(T);if(e===null)throw new p("Auth Provider is missing. Please add the AuthProvider before Router");return function(t){var o=t.token,n=t.tokenType,r=t.authState,s=t.expiresIn,i=t.refreshToken,h=t.refreshTokenExpireIn,u=new Date(new Date().getTime()+s*60*1e3);if(e.authState.isUsingRefreshToken)if(i&&h){var m=new Date(new Date().getTime()+h*60*1e3);return e.dispatch(R({auth:{token:o,type:n,expiresAt:u},userState:r||null,refresh:{token:i,expiresAt:m}})),!0}else throw new p('Make sure you given "refreshToken" and  "refreshTokenExpireIn" parameter');else{if(i&&h)throw new Error(`The app doesn't implement 'refreshToken' feature.
So you have to implement refresh token feature from 'AuthProvider' before using it.`);return e.dispatch(R({auth:{token:o,type:n,expiresAt:u},userState:r||null,refresh:null})),!0}}}function b(){var e=l.useContext(T);if(e===null)throw new p("Auth Provider is missing. Please add the AuthProvider before Router");return function(){try{return e?(e.dispatch(C()),!0):!1}catch{return!1}}}function F(){var e=l.useContext(T);if(e===null)throw new p("Auth Provider is missing. Please add the AuthProvider before Router");return function(){return D(e.authState)?e.authState.userState:null}}function J(){var e=l.useContext(T);if(e===null)throw new p("Auth Provider is missing. Please add the AuthProvider before Router");return function(){return!!D(e.authState)}}j.defaultProps={cookieDomain:window.location.hostname,cookieSecure:window.location.protocol==="https:"};export{j as A,B as a,J as b,F as c,b as u};
