# Scripts to create tables and procedures

```sql
create table
  public.languages (
    id bigint generated by default as identity not null,
    name text not null,
    alias text null,
    constraint languages_pkey primary key (id),
    constraint languages_name_key unique (name)
  ) tablespace pg_default;
  
```

```sql
create table
  public.qualityprofiles (
    id bigint generated by default as identity not null,
    created_at timestamp with time zone null default now(),
    updated_at timestamp with time zone null default now(),
    key text null,
    name text null,
    language_id bigint null,
    isDefault boolean null,
    constraint qualityprofiles_pkey primary key (id),
    constraint qualityprofiles_language_id_fkey foreign key (language_id) references languages (id)
  ) tablespace pg_default;
```

```sql
create table
  public.rules (
    id bigint generated by default as identity not null,
    key text not null,
    lang_id bigint null,
    name text not null,
    htmlDesc text null,
    severity text null,
    type text null,
    constraint rules_pkey primary key (id),
    constraint rules_key_key unique (key),
    constraint rules_lang_id_fkey foreign key (lang_id) references languages (id)
  ) tablespace pg_default;
```

```sql
create table
  public.status (
    id bigint generated by default as identity not null,
    created_at timestamp with time zone null default now(),
    updated_at timestamp with time zone null default now(),
    isActive boolean null,
    isActiveSonar boolean null,
    qualityProfile_id bigint not null,
    rule_id bigint null,
    lastActualizationSonar timestamp with time zone null,
    constraint status_pkey primary key (id),
    constraint status_qualityProfile_id_fkey foreign key ("qualityProfile_id") references qualityprofiles (id),
    constraint status_rule_id_fkey foreign key (rule_id) references rules (id)
  ) tablespace pg_default;
```

```sql
create or replace function get_changed_q(quality_id bigint) returns 
table(
  created_at timestamptz, updated_at timestamptz, "isActive" boolean, "isActiveSonar" boolean, name text)
as $$
begin
 return query 
  select
   public.status.created_at,
      public.status.updated_at,
      public.status."isActive",
      public.status."isActiveSonar",
      public.qualityprofiles.name
  from
   public.status inner join public.qualityprofiles on public.status."qualityProfile_id" = public.qualityprofiles.id where public.status."qualityProfile_id" = quality_id and public.status."isActive" != public.status."isActiveSonar";
end;$$

language plpgsql;
```
